(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function Qv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bf={exports:{}},zo={},Cf={exports:{}},$={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var es=Symbol.for("react.element"),Jv=Symbol.for("react.portal"),Yv=Symbol.for("react.fragment"),Xv=Symbol.for("react.strict_mode"),Zv=Symbol.for("react.profiler"),ey=Symbol.for("react.provider"),ty=Symbol.for("react.context"),ny=Symbol.for("react.forward_ref"),iy=Symbol.for("react.suspense"),ry=Symbol.for("react.memo"),sy=Symbol.for("react.lazy"),td=Symbol.iterator;function oy(t){return t===null||typeof t!="object"?null:(t=td&&t[td]||t["@@iterator"],typeof t=="function"?t:null)}var wf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ef=Object.assign,Pf={};function Ji(t,e,n){this.props=t,this.context=e,this.refs=Pf,this.updater=n||wf}Ji.prototype.isReactComponent={};Ji.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ji.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function _f(){}_f.prototype=Ji.prototype;function Ul(t,e,n){this.props=t,this.context=e,this.refs=Pf,this.updater=n||wf}var Fl=Ul.prototype=new _f;Fl.constructor=Ul;Ef(Fl,Ji.prototype);Fl.isPureReactComponent=!0;var nd=Array.isArray,Rf=Object.prototype.hasOwnProperty,jl={current:null},If={key:!0,ref:!0,__self:!0,__source:!0};function xf(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Rf.call(e,i)&&!If.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:es,type:t,key:s,ref:o,props:r,_owner:jl.current}}function ay(t,e){return{$$typeof:es,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Bl(t){return typeof t=="object"&&t!==null&&t.$$typeof===es}function cy(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var id=/\/+/g;function ha(t,e){return typeof t=="object"&&t!==null&&t.key!=null?cy(""+t.key):e.toString(36)}function xs(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case es:case Jv:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+ha(o,0):i,nd(r)?(n="",t!=null&&(n=t.replace(id,"$&/")+"/"),xs(r,e,n,"",function(l){return l})):r!=null&&(Bl(r)&&(r=ay(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(id,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",nd(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+ha(s,a);o+=xs(s,e,n,c,r)}else if(c=oy(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+ha(s,a++),o+=xs(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function cs(t,e,n){if(t==null)return t;var i=[],r=0;return xs(t,i,"","",function(s){return e.call(n,s,r++)}),i}function ly(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Be={current:null},Os={transition:null},uy={ReactCurrentDispatcher:Be,ReactCurrentBatchConfig:Os,ReactCurrentOwner:jl};function Of(){throw Error("act(...) is not supported in production builds of React.")}$.Children={map:cs,forEach:function(t,e,n){cs(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return cs(t,function(){e++}),e},toArray:function(t){return cs(t,function(e){return e})||[]},only:function(t){if(!Bl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};$.Component=Ji;$.Fragment=Yv;$.Profiler=Zv;$.PureComponent=Ul;$.StrictMode=Xv;$.Suspense=iy;$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uy;$.act=Of;$.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Ef({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=jl.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Rf.call(e,c)&&!If.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:es,type:t.type,key:r,ref:s,props:i,_owner:o}};$.createContext=function(t){return t={$$typeof:ty,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:ey,_context:t},t.Consumer=t};$.createElement=xf;$.createFactory=function(t){var e=xf.bind(null,t);return e.type=t,e};$.createRef=function(){return{current:null}};$.forwardRef=function(t){return{$$typeof:ny,render:t}};$.isValidElement=Bl;$.lazy=function(t){return{$$typeof:sy,_payload:{_status:-1,_result:t},_init:ly}};$.memo=function(t,e){return{$$typeof:ry,type:t,compare:e===void 0?null:e}};$.startTransition=function(t){var e=Os.transition;Os.transition={};try{t()}finally{Os.transition=e}};$.unstable_act=Of;$.useCallback=function(t,e){return Be.current.useCallback(t,e)};$.useContext=function(t){return Be.current.useContext(t)};$.useDebugValue=function(){};$.useDeferredValue=function(t){return Be.current.useDeferredValue(t)};$.useEffect=function(t,e){return Be.current.useEffect(t,e)};$.useId=function(){return Be.current.useId()};$.useImperativeHandle=function(t,e,n){return Be.current.useImperativeHandle(t,e,n)};$.useInsertionEffect=function(t,e){return Be.current.useInsertionEffect(t,e)};$.useLayoutEffect=function(t,e){return Be.current.useLayoutEffect(t,e)};$.useMemo=function(t,e){return Be.current.useMemo(t,e)};$.useReducer=function(t,e,n){return Be.current.useReducer(t,e,n)};$.useRef=function(t){return Be.current.useRef(t)};$.useState=function(t){return Be.current.useState(t)};$.useSyncExternalStore=function(t,e,n){return Be.current.useSyncExternalStore(t,e,n)};$.useTransition=function(){return Be.current.useTransition()};$.version="18.3.1";Cf.exports=$;var F=Cf.exports;const dy=Qv(F);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hy=F,fy=Symbol.for("react.element"),py=Symbol.for("react.fragment"),my=Object.prototype.hasOwnProperty,gy=hy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,vy={key:!0,ref:!0,__self:!0,__source:!0};function Df(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)my.call(e,i)&&!vy.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:fy,type:t,key:s,ref:o,props:r,_owner:gy.current}}zo.Fragment=py;zo.jsx=Df;zo.jsxs=Df;bf.exports=zo;var he=bf.exports,oc={},Mf={exports:{}},rt={},Nf={exports:{}},Lf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,V){var z=U.length;U.push(V);e:for(;0<z;){var re=z-1>>>1,ce=U[re];if(0<r(ce,V))U[re]=V,U[z]=ce,z=re;else break e}}function n(U){return U.length===0?null:U[0]}function i(U){if(U.length===0)return null;var V=U[0],z=U.pop();if(z!==V){U[0]=z;e:for(var re=0,ce=U.length,Fn=ce>>>1;re<Fn;){var Bt=2*(re+1)-1,er=U[Bt],ft=Bt+1,se=U[ft];if(0>r(er,z))ft<ce&&0>r(se,er)?(U[re]=se,U[ft]=z,re=ft):(U[re]=er,U[Bt]=z,re=Bt);else if(ft<ce&&0>r(se,z))U[re]=se,U[ft]=z,re=ft;else break e}}return V}function r(U,V){var z=U.sortIndex-V.sortIndex;return z!==0?z:U.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,p=!1,v=!1,m=!1,b=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(U){for(var V=n(l);V!==null;){if(V.callback===null)i(l);else if(V.startTime<=U)i(l),V.sortIndex=V.expirationTime,e(c,V);else break;V=n(l)}}function S(U){if(m=!1,k(U),!v)if(n(c)!==null)v=!0,jt(y);else{var V=n(l);V!==null&&Un(S,V.startTime-U)}}function y(U,V){v=!1,m&&(m=!1,f(R),R=-1),p=!0;var z=h;try{for(k(V),d=n(c);d!==null&&(!(d.expirationTime>V)||U&&!N());){var re=d.callback;if(typeof re=="function"){d.callback=null,h=d.priorityLevel;var ce=re(d.expirationTime<=V);V=t.unstable_now(),typeof ce=="function"?d.callback=ce:d===n(c)&&i(c),k(V)}else i(c);d=n(c)}if(d!==null)var Fn=!0;else{var Bt=n(l);Bt!==null&&Un(S,Bt.startTime-V),Fn=!1}return Fn}finally{d=null,h=z,p=!1}}var C=!1,P=null,R=-1,A=5,D=-1;function N(){return!(t.unstable_now()-D<A)}function B(){if(P!==null){var U=t.unstable_now();D=U;var V=!0;try{V=P(!0,U)}finally{V?ie():(C=!1,P=null)}}else C=!1}var ie;if(typeof g=="function")ie=function(){g(B)};else if(typeof MessageChannel<"u"){var De=new MessageChannel,ai=De.port2;De.port1.onmessage=B,ie=function(){ai.postMessage(null)}}else ie=function(){b(B,0)};function jt(U){P=U,C||(C=!0,ie())}function Un(U,V){R=b(function(){U(t.unstable_now())},V)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,jt(y))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(U){switch(h){case 1:case 2:case 3:var V=3;break;default:V=h}var z=h;h=V;try{return U()}finally{h=z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,V){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var z=h;h=U;try{return V()}finally{h=z}},t.unstable_scheduleCallback=function(U,V,z){var re=t.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?re+z:re):z=re,U){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=z+ce,U={id:u++,callback:V,priorityLevel:U,startTime:z,expirationTime:ce,sortIndex:-1},z>re?(U.sortIndex=z,e(l,U),n(c)===null&&U===n(l)&&(m?(f(R),R=-1):m=!0,Un(S,z-re))):(U.sortIndex=ce,e(c,U),v||p||(v=!0,jt(y))),U},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(U){var V=h;return function(){var z=h;h=V;try{return U.apply(this,arguments)}finally{h=z}}}})(Lf);Nf.exports=Lf;var yy=Nf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ky=F,nt=yy;function O(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Af=new Set,Mr={};function ri(t,e){ji(t,e),ji(t+"Capture",e)}function ji(t,e){for(Mr[t]=e,t=0;t<e.length;t++)Af.add(e[t])}var Qt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ac=Object.prototype.hasOwnProperty,Sy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,rd={},sd={};function Ty(t){return ac.call(sd,t)?!0:ac.call(rd,t)?!1:Sy.test(t)?sd[t]=!0:(rd[t]=!0,!1)}function by(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Cy(t,e,n,i){if(e===null||typeof e>"u"||by(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ve(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Oe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Oe[t]=new Ve(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Oe[e]=new Ve(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Oe[t]=new Ve(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Oe[t]=new Ve(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Oe[t]=new Ve(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Oe[t]=new Ve(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Oe[t]=new Ve(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Oe[t]=new Ve(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Oe[t]=new Ve(t,5,!1,t.toLowerCase(),null,!1,!1)});var Vl=/[\-:]([a-z])/g;function zl(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Vl,zl);Oe[e]=new Ve(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Vl,zl);Oe[e]=new Ve(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Vl,zl);Oe[e]=new Ve(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Oe[t]=new Ve(t,1,!1,t.toLowerCase(),null,!1,!1)});Oe.xlinkHref=new Ve("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Oe[t]=new Ve(t,1,!1,t.toLowerCase(),null,!0,!0)});function $l(t,e,n,i){var r=Oe.hasOwnProperty(e)?Oe[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Cy(e,n,r,i)&&(n=null),i||r===null?Ty(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var tn=ky.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ls=Symbol.for("react.element"),hi=Symbol.for("react.portal"),fi=Symbol.for("react.fragment"),Wl=Symbol.for("react.strict_mode"),cc=Symbol.for("react.profiler"),Uf=Symbol.for("react.provider"),Ff=Symbol.for("react.context"),ql=Symbol.for("react.forward_ref"),lc=Symbol.for("react.suspense"),uc=Symbol.for("react.suspense_list"),Hl=Symbol.for("react.memo"),ln=Symbol.for("react.lazy"),jf=Symbol.for("react.offscreen"),od=Symbol.iterator;function nr(t){return t===null||typeof t!="object"?null:(t=od&&t[od]||t["@@iterator"],typeof t=="function"?t:null)}var de=Object.assign,fa;function mr(t){if(fa===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);fa=e&&e[1]||""}return`
`+fa+t}var pa=!1;function ma(t,e){if(!t||pa)return"";pa=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{pa=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?mr(t):""}function wy(t){switch(t.tag){case 5:return mr(t.type);case 16:return mr("Lazy");case 13:return mr("Suspense");case 19:return mr("SuspenseList");case 0:case 2:case 15:return t=ma(t.type,!1),t;case 11:return t=ma(t.type.render,!1),t;case 1:return t=ma(t.type,!0),t;default:return""}}function dc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case fi:return"Fragment";case hi:return"Portal";case cc:return"Profiler";case Wl:return"StrictMode";case lc:return"Suspense";case uc:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Ff:return(t.displayName||"Context")+".Consumer";case Uf:return(t._context.displayName||"Context")+".Provider";case ql:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Hl:return e=t.displayName||null,e!==null?e:dc(t.type)||"Memo";case ln:e=t._payload,t=t._init;try{return dc(t(e))}catch{}}return null}function Ey(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return dc(e);case 8:return e===Wl?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Rn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Bf(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Py(t){var e=Bf(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function us(t){t._valueTracker||(t._valueTracker=Py(t))}function Vf(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Bf(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function ro(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function hc(t,e){var n=e.checked;return de({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ad(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Rn(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function zf(t,e){e=e.checked,e!=null&&$l(t,"checked",e,!1)}function fc(t,e){zf(t,e);var n=Rn(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?pc(t,e.type,n):e.hasOwnProperty("defaultValue")&&pc(t,e.type,Rn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function cd(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function pc(t,e,n){(e!=="number"||ro(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var gr=Array.isArray;function Pi(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Rn(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function mc(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(O(91));return de({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ld(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(O(92));if(gr(n)){if(1<n.length)throw Error(O(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Rn(n)}}function $f(t,e){var n=Rn(e.value),i=Rn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function ud(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Wf(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function gc(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Wf(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ds,qf=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ds=ds||document.createElement("div"),ds.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ds.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Nr(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Sr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_y=["Webkit","ms","Moz","O"];Object.keys(Sr).forEach(function(t){_y.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Sr[e]=Sr[t]})});function Hf(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Sr.hasOwnProperty(t)&&Sr[t]?(""+e).trim():e+"px"}function Kf(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Hf(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var Ry=de({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vc(t,e){if(e){if(Ry[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(O(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(O(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(O(61))}if(e.style!=null&&typeof e.style!="object")throw Error(O(62))}}function yc(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kc=null;function Kl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Sc=null,_i=null,Ri=null;function dd(t){if(t=is(t)){if(typeof Sc!="function")throw Error(O(280));var e=t.stateNode;e&&(e=Ko(e),Sc(t.stateNode,t.type,e))}}function Gf(t){_i?Ri?Ri.push(t):Ri=[t]:_i=t}function Qf(){if(_i){var t=_i,e=Ri;if(Ri=_i=null,dd(t),e)for(t=0;t<e.length;t++)dd(e[t])}}function Jf(t,e){return t(e)}function Yf(){}var ga=!1;function Xf(t,e,n){if(ga)return t(e,n);ga=!0;try{return Jf(t,e,n)}finally{ga=!1,(_i!==null||Ri!==null)&&(Yf(),Qf())}}function Lr(t,e){var n=t.stateNode;if(n===null)return null;var i=Ko(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(O(231,e,typeof n));return n}var Tc=!1;if(Qt)try{var ir={};Object.defineProperty(ir,"passive",{get:function(){Tc=!0}}),window.addEventListener("test",ir,ir),window.removeEventListener("test",ir,ir)}catch{Tc=!1}function Iy(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var Tr=!1,so=null,oo=!1,bc=null,xy={onError:function(t){Tr=!0,so=t}};function Oy(t,e,n,i,r,s,o,a,c){Tr=!1,so=null,Iy.apply(xy,arguments)}function Dy(t,e,n,i,r,s,o,a,c){if(Oy.apply(this,arguments),Tr){if(Tr){var l=so;Tr=!1,so=null}else throw Error(O(198));oo||(oo=!0,bc=l)}}function si(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Zf(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function hd(t){if(si(t)!==t)throw Error(O(188))}function My(t){var e=t.alternate;if(!e){if(e=si(t),e===null)throw Error(O(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return hd(r),t;if(s===i)return hd(r),e;s=s.sibling}throw Error(O(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(O(189))}}if(n.alternate!==i)throw Error(O(190))}if(n.tag!==3)throw Error(O(188));return n.stateNode.current===n?t:e}function ep(t){return t=My(t),t!==null?tp(t):null}function tp(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=tp(t);if(e!==null)return e;t=t.sibling}return null}var np=nt.unstable_scheduleCallback,fd=nt.unstable_cancelCallback,Ny=nt.unstable_shouldYield,Ly=nt.unstable_requestPaint,ve=nt.unstable_now,Ay=nt.unstable_getCurrentPriorityLevel,Gl=nt.unstable_ImmediatePriority,ip=nt.unstable_UserBlockingPriority,ao=nt.unstable_NormalPriority,Uy=nt.unstable_LowPriority,rp=nt.unstable_IdlePriority,$o=null,Lt=null;function Fy(t){if(Lt&&typeof Lt.onCommitFiberRoot=="function")try{Lt.onCommitFiberRoot($o,t,void 0,(t.current.flags&128)===128)}catch{}}var wt=Math.clz32?Math.clz32:Vy,jy=Math.log,By=Math.LN2;function Vy(t){return t>>>=0,t===0?32:31-(jy(t)/By|0)|0}var hs=64,fs=4194304;function vr(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function co(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=vr(a):(s&=o,s!==0&&(i=vr(s)))}else o=n&~r,o!==0?i=vr(o):s!==0&&(i=vr(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-wt(e),r=1<<n,i|=t[n],e&=~r;return i}function zy(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $y(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-wt(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=zy(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function Cc(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function sp(){var t=hs;return hs<<=1,!(hs&4194240)&&(hs=64),t}function va(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ts(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-wt(e),t[e]=n}function Wy(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-wt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Ql(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-wt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var J=0;function op(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ap,Jl,cp,lp,up,wc=!1,ps=[],yn=null,kn=null,Sn=null,Ar=new Map,Ur=new Map,dn=[],qy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pd(t,e){switch(t){case"focusin":case"focusout":yn=null;break;case"dragenter":case"dragleave":kn=null;break;case"mouseover":case"mouseout":Sn=null;break;case"pointerover":case"pointerout":Ar.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ur.delete(e.pointerId)}}function rr(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=is(e),e!==null&&Jl(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Hy(t,e,n,i,r){switch(e){case"focusin":return yn=rr(yn,t,e,n,i,r),!0;case"dragenter":return kn=rr(kn,t,e,n,i,r),!0;case"mouseover":return Sn=rr(Sn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Ar.set(s,rr(Ar.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Ur.set(s,rr(Ur.get(s)||null,t,e,n,i,r)),!0}return!1}function dp(t){var e=$n(t.target);if(e!==null){var n=si(e);if(n!==null){if(e=n.tag,e===13){if(e=Zf(n),e!==null){t.blockedOn=e,up(t.priority,function(){cp(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ds(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ec(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);kc=i,n.target.dispatchEvent(i),kc=null}else return e=is(n),e!==null&&Jl(e),t.blockedOn=n,!1;e.shift()}return!0}function md(t,e,n){Ds(t)&&n.delete(e)}function Ky(){wc=!1,yn!==null&&Ds(yn)&&(yn=null),kn!==null&&Ds(kn)&&(kn=null),Sn!==null&&Ds(Sn)&&(Sn=null),Ar.forEach(md),Ur.forEach(md)}function sr(t,e){t.blockedOn===e&&(t.blockedOn=null,wc||(wc=!0,nt.unstable_scheduleCallback(nt.unstable_NormalPriority,Ky)))}function Fr(t){function e(r){return sr(r,t)}if(0<ps.length){sr(ps[0],t);for(var n=1;n<ps.length;n++){var i=ps[n];i.blockedOn===t&&(i.blockedOn=null)}}for(yn!==null&&sr(yn,t),kn!==null&&sr(kn,t),Sn!==null&&sr(Sn,t),Ar.forEach(e),Ur.forEach(e),n=0;n<dn.length;n++)i=dn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<dn.length&&(n=dn[0],n.blockedOn===null);)dp(n),n.blockedOn===null&&dn.shift()}var Ii=tn.ReactCurrentBatchConfig,lo=!0;function Gy(t,e,n,i){var r=J,s=Ii.transition;Ii.transition=null;try{J=1,Yl(t,e,n,i)}finally{J=r,Ii.transition=s}}function Qy(t,e,n,i){var r=J,s=Ii.transition;Ii.transition=null;try{J=4,Yl(t,e,n,i)}finally{J=r,Ii.transition=s}}function Yl(t,e,n,i){if(lo){var r=Ec(t,e,n,i);if(r===null)_a(t,e,i,uo,n),pd(t,i);else if(Hy(r,t,e,n,i))i.stopPropagation();else if(pd(t,i),e&4&&-1<qy.indexOf(t)){for(;r!==null;){var s=is(r);if(s!==null&&ap(s),s=Ec(t,e,n,i),s===null&&_a(t,e,i,uo,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else _a(t,e,i,null,n)}}var uo=null;function Ec(t,e,n,i){if(uo=null,t=Kl(i),t=$n(t),t!==null)if(e=si(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Zf(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return uo=t,null}function hp(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ay()){case Gl:return 1;case ip:return 4;case ao:case Uy:return 16;case rp:return 536870912;default:return 16}default:return 16}}var mn=null,Xl=null,Ms=null;function fp(){if(Ms)return Ms;var t,e=Xl,n=e.length,i,r="value"in mn?mn.value:mn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Ms=r.slice(t,1<i?1-i:void 0)}function Ns(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ms(){return!0}function gd(){return!1}function st(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?ms:gd,this.isPropagationStopped=gd,this}return de(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ms)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ms)},persist:function(){},isPersistent:ms}),e}var Yi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zl=st(Yi),ns=de({},Yi,{view:0,detail:0}),Jy=st(ns),ya,ka,or,Wo=de({},ns,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eu,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==or&&(or&&t.type==="mousemove"?(ya=t.screenX-or.screenX,ka=t.screenY-or.screenY):ka=ya=0,or=t),ya)},movementY:function(t){return"movementY"in t?t.movementY:ka}}),vd=st(Wo),Yy=de({},Wo,{dataTransfer:0}),Xy=st(Yy),Zy=de({},ns,{relatedTarget:0}),Sa=st(Zy),e0=de({},Yi,{animationName:0,elapsedTime:0,pseudoElement:0}),t0=st(e0),n0=de({},Yi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),i0=st(n0),r0=de({},Yi,{data:0}),yd=st(r0),s0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},o0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function c0(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=a0[t])?!!e[t]:!1}function eu(){return c0}var l0=de({},ns,{key:function(t){if(t.key){var e=s0[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ns(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?o0[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eu,charCode:function(t){return t.type==="keypress"?Ns(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ns(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),u0=st(l0),d0=de({},Wo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kd=st(d0),h0=de({},ns,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eu}),f0=st(h0),p0=de({},Yi,{propertyName:0,elapsedTime:0,pseudoElement:0}),m0=st(p0),g0=de({},Wo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),v0=st(g0),y0=[9,13,27,32],tu=Qt&&"CompositionEvent"in window,br=null;Qt&&"documentMode"in document&&(br=document.documentMode);var k0=Qt&&"TextEvent"in window&&!br,pp=Qt&&(!tu||br&&8<br&&11>=br),Sd=" ",Td=!1;function mp(t,e){switch(t){case"keyup":return y0.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gp(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var pi=!1;function S0(t,e){switch(t){case"compositionend":return gp(e);case"keypress":return e.which!==32?null:(Td=!0,Sd);case"textInput":return t=e.data,t===Sd&&Td?null:t;default:return null}}function T0(t,e){if(pi)return t==="compositionend"||!tu&&mp(t,e)?(t=fp(),Ms=Xl=mn=null,pi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return pp&&e.locale!=="ko"?null:e.data;default:return null}}var b0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!b0[t.type]:e==="textarea"}function vp(t,e,n,i){Gf(i),e=ho(e,"onChange"),0<e.length&&(n=new Zl("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Cr=null,jr=null;function C0(t){Rp(t,0)}function qo(t){var e=vi(t);if(Vf(e))return t}function w0(t,e){if(t==="change")return e}var yp=!1;if(Qt){var Ta;if(Qt){var ba="oninput"in document;if(!ba){var Cd=document.createElement("div");Cd.setAttribute("oninput","return;"),ba=typeof Cd.oninput=="function"}Ta=ba}else Ta=!1;yp=Ta&&(!document.documentMode||9<document.documentMode)}function wd(){Cr&&(Cr.detachEvent("onpropertychange",kp),jr=Cr=null)}function kp(t){if(t.propertyName==="value"&&qo(jr)){var e=[];vp(e,jr,t,Kl(t)),Xf(C0,e)}}function E0(t,e,n){t==="focusin"?(wd(),Cr=e,jr=n,Cr.attachEvent("onpropertychange",kp)):t==="focusout"&&wd()}function P0(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return qo(jr)}function _0(t,e){if(t==="click")return qo(e)}function R0(t,e){if(t==="input"||t==="change")return qo(e)}function I0(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Pt=typeof Object.is=="function"?Object.is:I0;function Br(t,e){if(Pt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!ac.call(e,r)||!Pt(t[r],e[r]))return!1}return!0}function Ed(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Pd(t,e){var n=Ed(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ed(n)}}function Sp(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Sp(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Tp(){for(var t=window,e=ro();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ro(t.document)}return e}function nu(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function x0(t){var e=Tp(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Sp(n.ownerDocument.documentElement,n)){if(i!==null&&nu(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Pd(n,s);var o=Pd(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var O0=Qt&&"documentMode"in document&&11>=document.documentMode,mi=null,Pc=null,wr=null,_c=!1;function _d(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;_c||mi==null||mi!==ro(i)||(i=mi,"selectionStart"in i&&nu(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),wr&&Br(wr,i)||(wr=i,i=ho(Pc,"onSelect"),0<i.length&&(e=new Zl("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=mi)))}function gs(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var gi={animationend:gs("Animation","AnimationEnd"),animationiteration:gs("Animation","AnimationIteration"),animationstart:gs("Animation","AnimationStart"),transitionend:gs("Transition","TransitionEnd")},Ca={},bp={};Qt&&(bp=document.createElement("div").style,"AnimationEvent"in window||(delete gi.animationend.animation,delete gi.animationiteration.animation,delete gi.animationstart.animation),"TransitionEvent"in window||delete gi.transitionend.transition);function Ho(t){if(Ca[t])return Ca[t];if(!gi[t])return t;var e=gi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in bp)return Ca[t]=e[n];return t}var Cp=Ho("animationend"),wp=Ho("animationiteration"),Ep=Ho("animationstart"),Pp=Ho("transitionend"),_p=new Map,Rd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dn(t,e){_p.set(t,e),ri(e,[t])}for(var wa=0;wa<Rd.length;wa++){var Ea=Rd[wa],D0=Ea.toLowerCase(),M0=Ea[0].toUpperCase()+Ea.slice(1);Dn(D0,"on"+M0)}Dn(Cp,"onAnimationEnd");Dn(wp,"onAnimationIteration");Dn(Ep,"onAnimationStart");Dn("dblclick","onDoubleClick");Dn("focusin","onFocus");Dn("focusout","onBlur");Dn(Pp,"onTransitionEnd");ji("onMouseEnter",["mouseout","mouseover"]);ji("onMouseLeave",["mouseout","mouseover"]);ji("onPointerEnter",["pointerout","pointerover"]);ji("onPointerLeave",["pointerout","pointerover"]);ri("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ri("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ri("onBeforeInput",["compositionend","keypress","textInput","paste"]);ri("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ri("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ri("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),N0=new Set("cancel close invalid load scroll toggle".split(" ").concat(yr));function Id(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,Dy(i,e,void 0,t),t.currentTarget=null}function Rp(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;Id(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;Id(r,a,l),s=c}}}if(oo)throw t=bc,oo=!1,bc=null,t}function ee(t,e){var n=e[Dc];n===void 0&&(n=e[Dc]=new Set);var i=t+"__bubble";n.has(i)||(Ip(e,t,2,!1),n.add(i))}function Pa(t,e,n){var i=0;e&&(i|=4),Ip(n,t,i,e)}var vs="_reactListening"+Math.random().toString(36).slice(2);function Vr(t){if(!t[vs]){t[vs]=!0,Af.forEach(function(n){n!=="selectionchange"&&(N0.has(n)||Pa(n,!1,t),Pa(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vs]||(e[vs]=!0,Pa("selectionchange",!1,e))}}function Ip(t,e,n,i){switch(hp(e)){case 1:var r=Gy;break;case 4:r=Qy;break;default:r=Yl}n=r.bind(null,e,n,t),r=void 0,!Tc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function _a(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=$n(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Xf(function(){var l=s,u=Kl(n),d=[];e:{var h=_p.get(t);if(h!==void 0){var p=Zl,v=t;switch(t){case"keypress":if(Ns(n)===0)break e;case"keydown":case"keyup":p=u0;break;case"focusin":v="focus",p=Sa;break;case"focusout":v="blur",p=Sa;break;case"beforeblur":case"afterblur":p=Sa;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=vd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Xy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=f0;break;case Cp:case wp:case Ep:p=t0;break;case Pp:p=m0;break;case"scroll":p=Jy;break;case"wheel":p=v0;break;case"copy":case"cut":case"paste":p=i0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=kd}var m=(e&4)!==0,b=!m&&t==="scroll",f=m?h!==null?h+"Capture":null:h;m=[];for(var g=l,k;g!==null;){k=g;var S=k.stateNode;if(k.tag===5&&S!==null&&(k=S,f!==null&&(S=Lr(g,f),S!=null&&m.push(zr(g,S,k)))),b)break;g=g.return}0<m.length&&(h=new p(h,v,null,n,u),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==kc&&(v=n.relatedTarget||n.fromElement)&&($n(v)||v[Jt]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(v=n.relatedTarget||n.toElement,p=l,v=v?$n(v):null,v!==null&&(b=si(v),v!==b||v.tag!==5&&v.tag!==6)&&(v=null)):(p=null,v=l),p!==v)){if(m=vd,S="onMouseLeave",f="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(m=kd,S="onPointerLeave",f="onPointerEnter",g="pointer"),b=p==null?h:vi(p),k=v==null?h:vi(v),h=new m(S,g+"leave",p,n,u),h.target=b,h.relatedTarget=k,S=null,$n(u)===l&&(m=new m(f,g+"enter",v,n,u),m.target=k,m.relatedTarget=b,S=m),b=S,p&&v)t:{for(m=p,f=v,g=0,k=m;k;k=ci(k))g++;for(k=0,S=f;S;S=ci(S))k++;for(;0<g-k;)m=ci(m),g--;for(;0<k-g;)f=ci(f),k--;for(;g--;){if(m===f||f!==null&&m===f.alternate)break t;m=ci(m),f=ci(f)}m=null}else m=null;p!==null&&xd(d,h,p,m,!1),v!==null&&b!==null&&xd(d,b,v,m,!0)}}e:{if(h=l?vi(l):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var y=w0;else if(bd(h))if(yp)y=R0;else{y=P0;var C=E0}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(y=_0);if(y&&(y=y(t,l))){vp(d,y,n,u);break e}C&&C(t,h,l),t==="focusout"&&(C=h._wrapperState)&&C.controlled&&h.type==="number"&&pc(h,"number",h.value)}switch(C=l?vi(l):window,t){case"focusin":(bd(C)||C.contentEditable==="true")&&(mi=C,Pc=l,wr=null);break;case"focusout":wr=Pc=mi=null;break;case"mousedown":_c=!0;break;case"contextmenu":case"mouseup":case"dragend":_c=!1,_d(d,n,u);break;case"selectionchange":if(O0)break;case"keydown":case"keyup":_d(d,n,u)}var P;if(tu)e:{switch(t){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else pi?mp(t,n)&&(R="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(R="onCompositionStart");R&&(pp&&n.locale!=="ko"&&(pi||R!=="onCompositionStart"?R==="onCompositionEnd"&&pi&&(P=fp()):(mn=u,Xl="value"in mn?mn.value:mn.textContent,pi=!0)),C=ho(l,R),0<C.length&&(R=new yd(R,t,null,n,u),d.push({event:R,listeners:C}),P?R.data=P:(P=gp(n),P!==null&&(R.data=P)))),(P=k0?S0(t,n):T0(t,n))&&(l=ho(l,"onBeforeInput"),0<l.length&&(u=new yd("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=P))}Rp(d,e)})}function zr(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ho(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Lr(t,n),s!=null&&i.unshift(zr(t,s,r)),s=Lr(t,e),s!=null&&i.push(zr(t,s,r))),t=t.return}return i}function ci(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function xd(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=Lr(n,s),c!=null&&o.unshift(zr(n,c,a))):r||(c=Lr(n,s),c!=null&&o.push(zr(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var L0=/\r\n?/g,A0=/\u0000|\uFFFD/g;function Od(t){return(typeof t=="string"?t:""+t).replace(L0,`
`).replace(A0,"")}function ys(t,e,n){if(e=Od(e),Od(t)!==e&&n)throw Error(O(425))}function fo(){}var Rc=null,Ic=null;function xc(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Oc=typeof setTimeout=="function"?setTimeout:void 0,U0=typeof clearTimeout=="function"?clearTimeout:void 0,Dd=typeof Promise=="function"?Promise:void 0,F0=typeof queueMicrotask=="function"?queueMicrotask:typeof Dd<"u"?function(t){return Dd.resolve(null).then(t).catch(j0)}:Oc;function j0(t){setTimeout(function(){throw t})}function Ra(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Fr(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Fr(e)}function Tn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Md(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Xi=Math.random().toString(36).slice(2),Nt="__reactFiber$"+Xi,$r="__reactProps$"+Xi,Jt="__reactContainer$"+Xi,Dc="__reactEvents$"+Xi,B0="__reactListeners$"+Xi,V0="__reactHandles$"+Xi;function $n(t){var e=t[Nt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Jt]||n[Nt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Md(t);t!==null;){if(n=t[Nt])return n;t=Md(t)}return e}t=n,n=t.parentNode}return null}function is(t){return t=t[Nt]||t[Jt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function vi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(O(33))}function Ko(t){return t[$r]||null}var Mc=[],yi=-1;function Mn(t){return{current:t}}function ne(t){0>yi||(t.current=Mc[yi],Mc[yi]=null,yi--)}function Z(t,e){yi++,Mc[yi]=t.current,t.current=e}var In={},Ue=Mn(In),Ge=Mn(!1),Yn=In;function Bi(t,e){var n=t.type.contextTypes;if(!n)return In;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Qe(t){return t=t.childContextTypes,t!=null}function po(){ne(Ge),ne(Ue)}function Nd(t,e,n){if(Ue.current!==In)throw Error(O(168));Z(Ue,e),Z(Ge,n)}function xp(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(O(108,Ey(t)||"Unknown",r));return de({},n,i)}function mo(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||In,Yn=Ue.current,Z(Ue,t),Z(Ge,Ge.current),!0}function Ld(t,e,n){var i=t.stateNode;if(!i)throw Error(O(169));n?(t=xp(t,e,Yn),i.__reactInternalMemoizedMergedChildContext=t,ne(Ge),ne(Ue),Z(Ue,t)):ne(Ge),Z(Ge,n)}var zt=null,Go=!1,Ia=!1;function Op(t){zt===null?zt=[t]:zt.push(t)}function z0(t){Go=!0,Op(t)}function Nn(){if(!Ia&&zt!==null){Ia=!0;var t=0,e=J;try{var n=zt;for(J=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}zt=null,Go=!1}catch(r){throw zt!==null&&(zt=zt.slice(t+1)),np(Gl,Nn),r}finally{J=e,Ia=!1}}return null}var ki=[],Si=0,go=null,vo=0,ot=[],at=0,Xn=null,Ht=1,Kt="";function jn(t,e){ki[Si++]=vo,ki[Si++]=go,go=t,vo=e}function Dp(t,e,n){ot[at++]=Ht,ot[at++]=Kt,ot[at++]=Xn,Xn=t;var i=Ht;t=Kt;var r=32-wt(i)-1;i&=~(1<<r),n+=1;var s=32-wt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Ht=1<<32-wt(e)+r|n<<r|i,Kt=s+t}else Ht=1<<s|n<<r|i,Kt=t}function iu(t){t.return!==null&&(jn(t,1),Dp(t,1,0))}function ru(t){for(;t===go;)go=ki[--Si],ki[Si]=null,vo=ki[--Si],ki[Si]=null;for(;t===Xn;)Xn=ot[--at],ot[at]=null,Kt=ot[--at],ot[at]=null,Ht=ot[--at],ot[at]=null}var tt=null,et=null,oe=!1,St=null;function Mp(t,e){var n=ct(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Ad(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,tt=t,et=Tn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,tt=t,et=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Xn!==null?{id:Ht,overflow:Kt}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ct(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,tt=t,et=null,!0):!1;default:return!1}}function Nc(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Lc(t){if(oe){var e=et;if(e){var n=e;if(!Ad(t,e)){if(Nc(t))throw Error(O(418));e=Tn(n.nextSibling);var i=tt;e&&Ad(t,e)?Mp(i,n):(t.flags=t.flags&-4097|2,oe=!1,tt=t)}}else{if(Nc(t))throw Error(O(418));t.flags=t.flags&-4097|2,oe=!1,tt=t}}}function Ud(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;tt=t}function ks(t){if(t!==tt)return!1;if(!oe)return Ud(t),oe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!xc(t.type,t.memoizedProps)),e&&(e=et)){if(Nc(t))throw Np(),Error(O(418));for(;e;)Mp(t,e),e=Tn(e.nextSibling)}if(Ud(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(O(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){et=Tn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}et=null}}else et=tt?Tn(t.stateNode.nextSibling):null;return!0}function Np(){for(var t=et;t;)t=Tn(t.nextSibling)}function Vi(){et=tt=null,oe=!1}function su(t){St===null?St=[t]:St.push(t)}var $0=tn.ReactCurrentBatchConfig;function ar(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(O(309));var i=n.stateNode}if(!i)throw Error(O(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(O(284));if(!n._owner)throw Error(O(290,t))}return t}function Ss(t,e){throw t=Object.prototype.toString.call(e),Error(O(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Fd(t){var e=t._init;return e(t._payload)}function Lp(t){function e(f,g){if(t){var k=f.deletions;k===null?(f.deletions=[g],f.flags|=16):k.push(g)}}function n(f,g){if(!t)return null;for(;g!==null;)e(f,g),g=g.sibling;return null}function i(f,g){for(f=new Map;g!==null;)g.key!==null?f.set(g.key,g):f.set(g.index,g),g=g.sibling;return f}function r(f,g){return f=En(f,g),f.index=0,f.sibling=null,f}function s(f,g,k){return f.index=k,t?(k=f.alternate,k!==null?(k=k.index,k<g?(f.flags|=2,g):k):(f.flags|=2,g)):(f.flags|=1048576,g)}function o(f){return t&&f.alternate===null&&(f.flags|=2),f}function a(f,g,k,S){return g===null||g.tag!==6?(g=Aa(k,f.mode,S),g.return=f,g):(g=r(g,k),g.return=f,g)}function c(f,g,k,S){var y=k.type;return y===fi?u(f,g,k.props.children,S,k.key):g!==null&&(g.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===ln&&Fd(y)===g.type)?(S=r(g,k.props),S.ref=ar(f,g,k),S.return=f,S):(S=Vs(k.type,k.key,k.props,null,f.mode,S),S.ref=ar(f,g,k),S.return=f,S)}function l(f,g,k,S){return g===null||g.tag!==4||g.stateNode.containerInfo!==k.containerInfo||g.stateNode.implementation!==k.implementation?(g=Ua(k,f.mode,S),g.return=f,g):(g=r(g,k.children||[]),g.return=f,g)}function u(f,g,k,S,y){return g===null||g.tag!==7?(g=Kn(k,f.mode,S,y),g.return=f,g):(g=r(g,k),g.return=f,g)}function d(f,g,k){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Aa(""+g,f.mode,k),g.return=f,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case ls:return k=Vs(g.type,g.key,g.props,null,f.mode,k),k.ref=ar(f,null,g),k.return=f,k;case hi:return g=Ua(g,f.mode,k),g.return=f,g;case ln:var S=g._init;return d(f,S(g._payload),k)}if(gr(g)||nr(g))return g=Kn(g,f.mode,k,null),g.return=f,g;Ss(f,g)}return null}function h(f,g,k,S){var y=g!==null?g.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return y!==null?null:a(f,g,""+k,S);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case ls:return k.key===y?c(f,g,k,S):null;case hi:return k.key===y?l(f,g,k,S):null;case ln:return y=k._init,h(f,g,y(k._payload),S)}if(gr(k)||nr(k))return y!==null?null:u(f,g,k,S,null);Ss(f,k)}return null}function p(f,g,k,S,y){if(typeof S=="string"&&S!==""||typeof S=="number")return f=f.get(k)||null,a(g,f,""+S,y);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case ls:return f=f.get(S.key===null?k:S.key)||null,c(g,f,S,y);case hi:return f=f.get(S.key===null?k:S.key)||null,l(g,f,S,y);case ln:var C=S._init;return p(f,g,k,C(S._payload),y)}if(gr(S)||nr(S))return f=f.get(k)||null,u(g,f,S,y,null);Ss(g,S)}return null}function v(f,g,k,S){for(var y=null,C=null,P=g,R=g=0,A=null;P!==null&&R<k.length;R++){P.index>R?(A=P,P=null):A=P.sibling;var D=h(f,P,k[R],S);if(D===null){P===null&&(P=A);break}t&&P&&D.alternate===null&&e(f,P),g=s(D,g,R),C===null?y=D:C.sibling=D,C=D,P=A}if(R===k.length)return n(f,P),oe&&jn(f,R),y;if(P===null){for(;R<k.length;R++)P=d(f,k[R],S),P!==null&&(g=s(P,g,R),C===null?y=P:C.sibling=P,C=P);return oe&&jn(f,R),y}for(P=i(f,P);R<k.length;R++)A=p(P,f,R,k[R],S),A!==null&&(t&&A.alternate!==null&&P.delete(A.key===null?R:A.key),g=s(A,g,R),C===null?y=A:C.sibling=A,C=A);return t&&P.forEach(function(N){return e(f,N)}),oe&&jn(f,R),y}function m(f,g,k,S){var y=nr(k);if(typeof y!="function")throw Error(O(150));if(k=y.call(k),k==null)throw Error(O(151));for(var C=y=null,P=g,R=g=0,A=null,D=k.next();P!==null&&!D.done;R++,D=k.next()){P.index>R?(A=P,P=null):A=P.sibling;var N=h(f,P,D.value,S);if(N===null){P===null&&(P=A);break}t&&P&&N.alternate===null&&e(f,P),g=s(N,g,R),C===null?y=N:C.sibling=N,C=N,P=A}if(D.done)return n(f,P),oe&&jn(f,R),y;if(P===null){for(;!D.done;R++,D=k.next())D=d(f,D.value,S),D!==null&&(g=s(D,g,R),C===null?y=D:C.sibling=D,C=D);return oe&&jn(f,R),y}for(P=i(f,P);!D.done;R++,D=k.next())D=p(P,f,R,D.value,S),D!==null&&(t&&D.alternate!==null&&P.delete(D.key===null?R:D.key),g=s(D,g,R),C===null?y=D:C.sibling=D,C=D);return t&&P.forEach(function(B){return e(f,B)}),oe&&jn(f,R),y}function b(f,g,k,S){if(typeof k=="object"&&k!==null&&k.type===fi&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case ls:e:{for(var y=k.key,C=g;C!==null;){if(C.key===y){if(y=k.type,y===fi){if(C.tag===7){n(f,C.sibling),g=r(C,k.props.children),g.return=f,f=g;break e}}else if(C.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===ln&&Fd(y)===C.type){n(f,C.sibling),g=r(C,k.props),g.ref=ar(f,C,k),g.return=f,f=g;break e}n(f,C);break}else e(f,C);C=C.sibling}k.type===fi?(g=Kn(k.props.children,f.mode,S,k.key),g.return=f,f=g):(S=Vs(k.type,k.key,k.props,null,f.mode,S),S.ref=ar(f,g,k),S.return=f,f=S)}return o(f);case hi:e:{for(C=k.key;g!==null;){if(g.key===C)if(g.tag===4&&g.stateNode.containerInfo===k.containerInfo&&g.stateNode.implementation===k.implementation){n(f,g.sibling),g=r(g,k.children||[]),g.return=f,f=g;break e}else{n(f,g);break}else e(f,g);g=g.sibling}g=Ua(k,f.mode,S),g.return=f,f=g}return o(f);case ln:return C=k._init,b(f,g,C(k._payload),S)}if(gr(k))return v(f,g,k,S);if(nr(k))return m(f,g,k,S);Ss(f,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,g!==null&&g.tag===6?(n(f,g.sibling),g=r(g,k),g.return=f,f=g):(n(f,g),g=Aa(k,f.mode,S),g.return=f,f=g),o(f)):n(f,g)}return b}var zi=Lp(!0),Ap=Lp(!1),yo=Mn(null),ko=null,Ti=null,ou=null;function au(){ou=Ti=ko=null}function cu(t){var e=yo.current;ne(yo),t._currentValue=e}function Ac(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function xi(t,e){ko=t,ou=Ti=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(qe=!0),t.firstContext=null)}function dt(t){var e=t._currentValue;if(ou!==t)if(t={context:t,memoizedValue:e,next:null},Ti===null){if(ko===null)throw Error(O(308));Ti=t,ko.dependencies={lanes:0,firstContext:t}}else Ti=Ti.next=t;return e}var Wn=null;function lu(t){Wn===null?Wn=[t]:Wn.push(t)}function Up(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,lu(e)):(n.next=r.next,r.next=n),e.interleaved=n,Yt(t,i)}function Yt(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var un=!1;function uu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fp(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Gt(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function bn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,K&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Yt(t,n)}return r=i.interleaved,r===null?(e.next=e,lu(i)):(e.next=r.next,r.next=e),i.interleaved=e,Yt(t,n)}function Ls(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Ql(t,n)}}function jd(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function So(t,e,n,i){var r=t.updateQueue;un=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=r.baseState;o=0,u=l=c=null,a=s;do{var h=a.lane,p=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var v=t,m=a;switch(h=e,p=n,m.tag){case 1:if(v=m.payload,typeof v=="function"){d=v.call(p,d,h);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=m.payload,h=typeof v=="function"?v.call(p,d,h):v,h==null)break e;d=de({},d,h);break e;case 2:un=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=p,c=d):u=u.next=p,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);ei|=o,t.lanes=o,t.memoizedState=d}}function Bd(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(O(191,r));r.call(i)}}}var rs={},At=Mn(rs),Wr=Mn(rs),qr=Mn(rs);function qn(t){if(t===rs)throw Error(O(174));return t}function du(t,e){switch(Z(qr,e),Z(Wr,t),Z(At,rs),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:gc(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=gc(e,t)}ne(At),Z(At,e)}function $i(){ne(At),ne(Wr),ne(qr)}function jp(t){qn(qr.current);var e=qn(At.current),n=gc(e,t.type);e!==n&&(Z(Wr,t),Z(At,n))}function hu(t){Wr.current===t&&(ne(At),ne(Wr))}var le=Mn(0);function To(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xa=[];function fu(){for(var t=0;t<xa.length;t++)xa[t]._workInProgressVersionPrimary=null;xa.length=0}var As=tn.ReactCurrentDispatcher,Oa=tn.ReactCurrentBatchConfig,Zn=0,ue=null,be=null,Ee=null,bo=!1,Er=!1,Hr=0,W0=0;function Me(){throw Error(O(321))}function pu(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Pt(t[n],e[n]))return!1;return!0}function mu(t,e,n,i,r,s){if(Zn=s,ue=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,As.current=t===null||t.memoizedState===null?G0:Q0,t=n(i,r),Er){s=0;do{if(Er=!1,Hr=0,25<=s)throw Error(O(301));s+=1,Ee=be=null,e.updateQueue=null,As.current=J0,t=n(i,r)}while(Er)}if(As.current=Co,e=be!==null&&be.next!==null,Zn=0,Ee=be=ue=null,bo=!1,e)throw Error(O(300));return t}function gu(){var t=Hr!==0;return Hr=0,t}function Ot(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ee===null?ue.memoizedState=Ee=t:Ee=Ee.next=t,Ee}function ht(){if(be===null){var t=ue.alternate;t=t!==null?t.memoizedState:null}else t=be.next;var e=Ee===null?ue.memoizedState:Ee.next;if(e!==null)Ee=e,be=t;else{if(t===null)throw Error(O(310));be=t,t={memoizedState:be.memoizedState,baseState:be.baseState,baseQueue:be.baseQueue,queue:be.queue,next:null},Ee===null?ue.memoizedState=Ee=t:Ee=Ee.next=t}return Ee}function Kr(t,e){return typeof e=="function"?e(t):e}function Da(t){var e=ht(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=be,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((Zn&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=i):c=c.next=d,ue.lanes|=u,ei|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,Pt(i,e.memoizedState)||(qe=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ue.lanes|=s,ei|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ma(t){var e=ht(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Pt(s,e.memoizedState)||(qe=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Bp(){}function Vp(t,e){var n=ue,i=ht(),r=e(),s=!Pt(i.memoizedState,r);if(s&&(i.memoizedState=r,qe=!0),i=i.queue,vu(Wp.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Ee!==null&&Ee.memoizedState.tag&1){if(n.flags|=2048,Gr(9,$p.bind(null,n,i,r,e),void 0,null),_e===null)throw Error(O(349));Zn&30||zp(n,e,r)}return r}function zp(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ue.updateQueue,e===null?(e={lastEffect:null,stores:null},ue.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function $p(t,e,n,i){e.value=n,e.getSnapshot=i,qp(e)&&Hp(t)}function Wp(t,e,n){return n(function(){qp(e)&&Hp(t)})}function qp(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Pt(t,n)}catch{return!0}}function Hp(t){var e=Yt(t,1);e!==null&&Et(e,t,1,-1)}function Vd(t){var e=Ot();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Kr,lastRenderedState:t},e.queue=t,t=t.dispatch=K0.bind(null,ue,t),[e.memoizedState,t]}function Gr(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ue.updateQueue,e===null?(e={lastEffect:null,stores:null},ue.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Kp(){return ht().memoizedState}function Us(t,e,n,i){var r=Ot();ue.flags|=t,r.memoizedState=Gr(1|e,n,void 0,i===void 0?null:i)}function Qo(t,e,n,i){var r=ht();i=i===void 0?null:i;var s=void 0;if(be!==null){var o=be.memoizedState;if(s=o.destroy,i!==null&&pu(i,o.deps)){r.memoizedState=Gr(e,n,s,i);return}}ue.flags|=t,r.memoizedState=Gr(1|e,n,s,i)}function zd(t,e){return Us(8390656,8,t,e)}function vu(t,e){return Qo(2048,8,t,e)}function Gp(t,e){return Qo(4,2,t,e)}function Qp(t,e){return Qo(4,4,t,e)}function Jp(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Yp(t,e,n){return n=n!=null?n.concat([t]):null,Qo(4,4,Jp.bind(null,e,t),n)}function yu(){}function Xp(t,e){var n=ht();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&pu(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Zp(t,e){var n=ht();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&pu(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function em(t,e,n){return Zn&21?(Pt(n,e)||(n=sp(),ue.lanes|=n,ei|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,qe=!0),t.memoizedState=n)}function q0(t,e){var n=J;J=n!==0&&4>n?n:4,t(!0);var i=Oa.transition;Oa.transition={};try{t(!1),e()}finally{J=n,Oa.transition=i}}function tm(){return ht().memoizedState}function H0(t,e,n){var i=wn(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},nm(t))im(e,n);else if(n=Up(t,e,n,i),n!==null){var r=je();Et(n,t,i,r),rm(n,e,i)}}function K0(t,e,n){var i=wn(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(nm(t))im(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Pt(a,o)){var c=e.interleaved;c===null?(r.next=r,lu(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=Up(t,e,r,i),n!==null&&(r=je(),Et(n,t,i,r),rm(n,e,i))}}function nm(t){var e=t.alternate;return t===ue||e!==null&&e===ue}function im(t,e){Er=bo=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function rm(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Ql(t,n)}}var Co={readContext:dt,useCallback:Me,useContext:Me,useEffect:Me,useImperativeHandle:Me,useInsertionEffect:Me,useLayoutEffect:Me,useMemo:Me,useReducer:Me,useRef:Me,useState:Me,useDebugValue:Me,useDeferredValue:Me,useTransition:Me,useMutableSource:Me,useSyncExternalStore:Me,useId:Me,unstable_isNewReconciler:!1},G0={readContext:dt,useCallback:function(t,e){return Ot().memoizedState=[t,e===void 0?null:e],t},useContext:dt,useEffect:zd,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Us(4194308,4,Jp.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Us(4194308,4,t,e)},useInsertionEffect:function(t,e){return Us(4,2,t,e)},useMemo:function(t,e){var n=Ot();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Ot();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=H0.bind(null,ue,t),[i.memoizedState,t]},useRef:function(t){var e=Ot();return t={current:t},e.memoizedState=t},useState:Vd,useDebugValue:yu,useDeferredValue:function(t){return Ot().memoizedState=t},useTransition:function(){var t=Vd(!1),e=t[0];return t=q0.bind(null,t[1]),Ot().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ue,r=Ot();if(oe){if(n===void 0)throw Error(O(407));n=n()}else{if(n=e(),_e===null)throw Error(O(349));Zn&30||zp(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,zd(Wp.bind(null,i,s,t),[t]),i.flags|=2048,Gr(9,$p.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Ot(),e=_e.identifierPrefix;if(oe){var n=Kt,i=Ht;n=(i&~(1<<32-wt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Hr++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=W0++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Q0={readContext:dt,useCallback:Xp,useContext:dt,useEffect:vu,useImperativeHandle:Yp,useInsertionEffect:Gp,useLayoutEffect:Qp,useMemo:Zp,useReducer:Da,useRef:Kp,useState:function(){return Da(Kr)},useDebugValue:yu,useDeferredValue:function(t){var e=ht();return em(e,be.memoizedState,t)},useTransition:function(){var t=Da(Kr)[0],e=ht().memoizedState;return[t,e]},useMutableSource:Bp,useSyncExternalStore:Vp,useId:tm,unstable_isNewReconciler:!1},J0={readContext:dt,useCallback:Xp,useContext:dt,useEffect:vu,useImperativeHandle:Yp,useInsertionEffect:Gp,useLayoutEffect:Qp,useMemo:Zp,useReducer:Ma,useRef:Kp,useState:function(){return Ma(Kr)},useDebugValue:yu,useDeferredValue:function(t){var e=ht();return be===null?e.memoizedState=t:em(e,be.memoizedState,t)},useTransition:function(){var t=Ma(Kr)[0],e=ht().memoizedState;return[t,e]},useMutableSource:Bp,useSyncExternalStore:Vp,useId:tm,unstable_isNewReconciler:!1};function vt(t,e){if(t&&t.defaultProps){e=de({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Uc(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:de({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Jo={isMounted:function(t){return(t=t._reactInternals)?si(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=je(),r=wn(t),s=Gt(i,r);s.payload=e,n!=null&&(s.callback=n),e=bn(t,s,r),e!==null&&(Et(e,t,r,i),Ls(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=je(),r=wn(t),s=Gt(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=bn(t,s,r),e!==null&&(Et(e,t,r,i),Ls(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=je(),i=wn(t),r=Gt(n,i);r.tag=2,e!=null&&(r.callback=e),e=bn(t,r,i),e!==null&&(Et(e,t,i,n),Ls(e,t,i))}};function $d(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Br(n,i)||!Br(r,s):!0}function sm(t,e,n){var i=!1,r=In,s=e.contextType;return typeof s=="object"&&s!==null?s=dt(s):(r=Qe(e)?Yn:Ue.current,i=e.contextTypes,s=(i=i!=null)?Bi(t,r):In),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jo,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Wd(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Jo.enqueueReplaceState(e,e.state,null)}function Fc(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},uu(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=dt(s):(s=Qe(e)?Yn:Ue.current,r.context=Bi(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Uc(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Jo.enqueueReplaceState(r,r.state,null),So(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Wi(t,e){try{var n="",i=e;do n+=wy(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Na(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function jc(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Y0=typeof WeakMap=="function"?WeakMap:Map;function om(t,e,n){n=Gt(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Eo||(Eo=!0,Qc=i),jc(t,e)},n}function am(t,e,n){n=Gt(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){jc(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){jc(t,e),typeof i!="function"&&(Cn===null?Cn=new Set([this]):Cn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function qd(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Y0;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=dk.bind(null,t,e,n),e.then(t,t))}function Hd(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Kd(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Gt(-1,1),e.tag=2,bn(n,e,1))),n.lanes|=1),t)}var X0=tn.ReactCurrentOwner,qe=!1;function Fe(t,e,n,i){e.child=t===null?Ap(e,null,n,i):zi(e,t.child,n,i)}function Gd(t,e,n,i,r){n=n.render;var s=e.ref;return xi(e,r),i=mu(t,e,n,i,s,r),n=gu(),t!==null&&!qe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Xt(t,e,r)):(oe&&n&&iu(e),e.flags|=1,Fe(t,e,i,r),e.child)}function Qd(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Pu(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,cm(t,e,s,i,r)):(t=Vs(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Br,n(o,i)&&t.ref===e.ref)return Xt(t,e,r)}return e.flags|=1,t=En(s,i),t.ref=e.ref,t.return=e,e.child=t}function cm(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Br(s,i)&&t.ref===e.ref)if(qe=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(qe=!0);else return e.lanes=t.lanes,Xt(t,e,r)}return Bc(t,e,n,i,r)}function lm(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Z(Ci,Xe),Xe|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Z(Ci,Xe),Xe|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,Z(Ci,Xe),Xe|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,Z(Ci,Xe),Xe|=i;return Fe(t,e,r,n),e.child}function um(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Bc(t,e,n,i,r){var s=Qe(n)?Yn:Ue.current;return s=Bi(e,s),xi(e,r),n=mu(t,e,n,i,s,r),i=gu(),t!==null&&!qe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Xt(t,e,r)):(oe&&i&&iu(e),e.flags|=1,Fe(t,e,n,r),e.child)}function Jd(t,e,n,i,r){if(Qe(n)){var s=!0;mo(e)}else s=!1;if(xi(e,r),e.stateNode===null)Fs(t,e),sm(e,n,i),Fc(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=dt(l):(l=Qe(n)?Yn:Ue.current,l=Bi(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&Wd(e,o,i,l),un=!1;var h=e.memoizedState;o.state=h,So(e,i,o,r),c=e.memoizedState,a!==i||h!==c||Ge.current||un?(typeof u=="function"&&(Uc(e,n,u,i),c=e.memoizedState),(a=un||$d(e,n,a,i,h,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Fp(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:vt(e.type,a),o.props=l,d=e.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=dt(c):(c=Qe(n)?Yn:Ue.current,c=Bi(e,c));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==c)&&Wd(e,o,i,c),un=!1,h=e.memoizedState,o.state=h,So(e,i,o,r);var v=e.memoizedState;a!==d||h!==v||Ge.current||un?(typeof p=="function"&&(Uc(e,n,p,i),v=e.memoizedState),(l=un||$d(e,n,l,i,h,v,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,v,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,v,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=v),o.props=i,o.state=v,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return Vc(t,e,n,i,s,r)}function Vc(t,e,n,i,r,s){um(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Ld(e,n,!1),Xt(t,e,s);i=e.stateNode,X0.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=zi(e,t.child,null,s),e.child=zi(e,null,a,s)):Fe(t,e,a,s),e.memoizedState=i.state,r&&Ld(e,n,!0),e.child}function dm(t){var e=t.stateNode;e.pendingContext?Nd(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Nd(t,e.context,!1),du(t,e.containerInfo)}function Yd(t,e,n,i,r){return Vi(),su(r),e.flags|=256,Fe(t,e,n,i),e.child}var zc={dehydrated:null,treeContext:null,retryLane:0};function $c(t){return{baseLanes:t,cachePool:null,transitions:null}}function hm(t,e,n){var i=e.pendingProps,r=le.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Z(le,r&1),t===null)return Lc(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Zo(o,i,0,null),t=Kn(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=$c(n),e.memoizedState=zc,t):ku(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Z0(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=En(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=En(a,s):(s=Kn(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?$c(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=zc,i}return s=t.child,t=s.sibling,i=En(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function ku(t,e){return e=Zo({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ts(t,e,n,i){return i!==null&&su(i),zi(e,t.child,null,n),t=ku(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Z0(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Na(Error(O(422))),Ts(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Zo({mode:"visible",children:i.children},r,0,null),s=Kn(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&zi(e,t.child,null,o),e.child.memoizedState=$c(o),e.memoizedState=zc,s);if(!(e.mode&1))return Ts(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(O(419)),i=Na(s,i,void 0),Ts(t,e,o,i)}if(a=(o&t.childLanes)!==0,qe||a){if(i=_e,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Yt(t,r),Et(i,t,r,-1))}return Eu(),i=Na(Error(O(421))),Ts(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=hk.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,et=Tn(r.nextSibling),tt=e,oe=!0,St=null,t!==null&&(ot[at++]=Ht,ot[at++]=Kt,ot[at++]=Xn,Ht=t.id,Kt=t.overflow,Xn=e),e=ku(e,i.children),e.flags|=4096,e)}function Xd(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Ac(t.return,e,n)}function La(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function fm(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Fe(t,e,i.children,n),i=le.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Xd(t,n,e);else if(t.tag===19)Xd(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Z(le,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&To(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),La(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&To(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}La(e,!0,n,null,s);break;case"together":La(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Fs(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ei|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(O(153));if(e.child!==null){for(t=e.child,n=En(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=En(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function ek(t,e,n){switch(e.tag){case 3:dm(e),Vi();break;case 5:jp(e);break;case 1:Qe(e.type)&&mo(e);break;case 4:du(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Z(yo,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Z(le,le.current&1),e.flags|=128,null):n&e.child.childLanes?hm(t,e,n):(Z(le,le.current&1),t=Xt(t,e,n),t!==null?t.sibling:null);Z(le,le.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return fm(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Z(le,le.current),i)break;return null;case 22:case 23:return e.lanes=0,lm(t,e,n)}return Xt(t,e,n)}var pm,Wc,mm,gm;pm=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Wc=function(){};mm=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,qn(At.current);var s=null;switch(n){case"input":r=hc(t,r),i=hc(t,i),s=[];break;case"select":r=de({},r,{value:void 0}),i=de({},i,{value:void 0}),s=[];break;case"textarea":r=mc(t,r),i=mc(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=fo)}vc(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Mr.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Mr.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&ee("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};gm=function(t,e,n,i){n!==i&&(e.flags|=4)};function cr(t,e){if(!oe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Ne(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function tk(t,e,n){var i=e.pendingProps;switch(ru(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ne(e),null;case 1:return Qe(e.type)&&po(),Ne(e),null;case 3:return i=e.stateNode,$i(),ne(Ge),ne(Ue),fu(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(ks(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,St!==null&&(Xc(St),St=null))),Wc(t,e),Ne(e),null;case 5:hu(e);var r=qn(qr.current);if(n=e.type,t!==null&&e.stateNode!=null)mm(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(O(166));return Ne(e),null}if(t=qn(At.current),ks(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Nt]=e,i[$r]=s,t=(e.mode&1)!==0,n){case"dialog":ee("cancel",i),ee("close",i);break;case"iframe":case"object":case"embed":ee("load",i);break;case"video":case"audio":for(r=0;r<yr.length;r++)ee(yr[r],i);break;case"source":ee("error",i);break;case"img":case"image":case"link":ee("error",i),ee("load",i);break;case"details":ee("toggle",i);break;case"input":ad(i,s),ee("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ee("invalid",i);break;case"textarea":ld(i,s),ee("invalid",i)}vc(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&ys(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&ys(i.textContent,a,t),r=["children",""+a]):Mr.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ee("scroll",i)}switch(n){case"input":us(i),cd(i,s,!0);break;case"textarea":us(i),ud(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=fo)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Wf(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Nt]=e,t[$r]=i,pm(t,e,!1,!1),e.stateNode=t;e:{switch(o=yc(n,i),n){case"dialog":ee("cancel",t),ee("close",t),r=i;break;case"iframe":case"object":case"embed":ee("load",t),r=i;break;case"video":case"audio":for(r=0;r<yr.length;r++)ee(yr[r],t);r=i;break;case"source":ee("error",t),r=i;break;case"img":case"image":case"link":ee("error",t),ee("load",t),r=i;break;case"details":ee("toggle",t),r=i;break;case"input":ad(t,i),r=hc(t,i),ee("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=de({},i,{value:void 0}),ee("invalid",t);break;case"textarea":ld(t,i),r=mc(t,i),ee("invalid",t);break;default:r=i}vc(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?Kf(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&qf(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Nr(t,c):typeof c=="number"&&Nr(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Mr.hasOwnProperty(s)?c!=null&&s==="onScroll"&&ee("scroll",t):c!=null&&$l(t,s,c,o))}switch(n){case"input":us(t),cd(t,i,!1);break;case"textarea":us(t),ud(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Rn(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Pi(t,!!i.multiple,s,!1):i.defaultValue!=null&&Pi(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=fo)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ne(e),null;case 6:if(t&&e.stateNode!=null)gm(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(O(166));if(n=qn(qr.current),qn(At.current),ks(e)){if(i=e.stateNode,n=e.memoizedProps,i[Nt]=e,(s=i.nodeValue!==n)&&(t=tt,t!==null))switch(t.tag){case 3:ys(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ys(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Nt]=e,e.stateNode=i}return Ne(e),null;case 13:if(ne(le),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(oe&&et!==null&&e.mode&1&&!(e.flags&128))Np(),Vi(),e.flags|=98560,s=!1;else if(s=ks(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(O(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(O(317));s[Nt]=e}else Vi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ne(e),s=!1}else St!==null&&(Xc(St),St=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||le.current&1?Ce===0&&(Ce=3):Eu())),e.updateQueue!==null&&(e.flags|=4),Ne(e),null);case 4:return $i(),Wc(t,e),t===null&&Vr(e.stateNode.containerInfo),Ne(e),null;case 10:return cu(e.type._context),Ne(e),null;case 17:return Qe(e.type)&&po(),Ne(e),null;case 19:if(ne(le),s=e.memoizedState,s===null)return Ne(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)cr(s,!1);else{if(Ce!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=To(t),o!==null){for(e.flags|=128,cr(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Z(le,le.current&1|2),e.child}t=t.sibling}s.tail!==null&&ve()>qi&&(e.flags|=128,i=!0,cr(s,!1),e.lanes=4194304)}else{if(!i)if(t=To(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),cr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!oe)return Ne(e),null}else 2*ve()-s.renderingStartTime>qi&&n!==1073741824&&(e.flags|=128,i=!0,cr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ve(),e.sibling=null,n=le.current,Z(le,i?n&1|2:n&1),e):(Ne(e),null);case 22:case 23:return wu(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Xe&1073741824&&(Ne(e),e.subtreeFlags&6&&(e.flags|=8192)):Ne(e),null;case 24:return null;case 25:return null}throw Error(O(156,e.tag))}function nk(t,e){switch(ru(e),e.tag){case 1:return Qe(e.type)&&po(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return $i(),ne(Ge),ne(Ue),fu(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return hu(e),null;case 13:if(ne(le),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(O(340));Vi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ne(le),null;case 4:return $i(),null;case 10:return cu(e.type._context),null;case 22:case 23:return wu(),null;case 24:return null;default:return null}}var bs=!1,Ae=!1,ik=typeof WeakSet=="function"?WeakSet:Set,j=null;function bi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){pe(t,e,i)}else n.current=null}function qc(t,e,n){try{n()}catch(i){pe(t,e,i)}}var Zd=!1;function rk(t,e){if(Rc=lo,t=Tp(),nu(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var p;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(c=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===t)break t;if(h===n&&++l===r&&(a=o),h===s&&++u===i&&(c=o),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ic={focusedElem:t,selectionRange:n},lo=!1,j=e;j!==null;)if(e=j,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,j=t;else for(;j!==null;){e=j;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var m=v.memoizedProps,b=v.memoizedState,f=e.stateNode,g=f.getSnapshotBeforeUpdate(e.elementType===e.type?m:vt(e.type,m),b);f.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(S){pe(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,j=t;break}j=e.return}return v=Zd,Zd=!1,v}function Pr(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&qc(e,n,s)}r=r.next}while(r!==i)}}function Yo(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Hc(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function vm(t){var e=t.alternate;e!==null&&(t.alternate=null,vm(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Nt],delete e[$r],delete e[Dc],delete e[B0],delete e[V0])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ym(t){return t.tag===5||t.tag===3||t.tag===4}function eh(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||ym(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Kc(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=fo));else if(i!==4&&(t=t.child,t!==null))for(Kc(t,e,n),t=t.sibling;t!==null;)Kc(t,e,n),t=t.sibling}function Gc(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Gc(t,e,n),t=t.sibling;t!==null;)Gc(t,e,n),t=t.sibling}var Re=null,yt=!1;function sn(t,e,n){for(n=n.child;n!==null;)km(t,e,n),n=n.sibling}function km(t,e,n){if(Lt&&typeof Lt.onCommitFiberUnmount=="function")try{Lt.onCommitFiberUnmount($o,n)}catch{}switch(n.tag){case 5:Ae||bi(n,e);case 6:var i=Re,r=yt;Re=null,sn(t,e,n),Re=i,yt=r,Re!==null&&(yt?(t=Re,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Re.removeChild(n.stateNode));break;case 18:Re!==null&&(yt?(t=Re,n=n.stateNode,t.nodeType===8?Ra(t.parentNode,n):t.nodeType===1&&Ra(t,n),Fr(t)):Ra(Re,n.stateNode));break;case 4:i=Re,r=yt,Re=n.stateNode.containerInfo,yt=!0,sn(t,e,n),Re=i,yt=r;break;case 0:case 11:case 14:case 15:if(!Ae&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&qc(n,e,o),r=r.next}while(r!==i)}sn(t,e,n);break;case 1:if(!Ae&&(bi(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){pe(n,e,a)}sn(t,e,n);break;case 21:sn(t,e,n);break;case 22:n.mode&1?(Ae=(i=Ae)||n.memoizedState!==null,sn(t,e,n),Ae=i):sn(t,e,n);break;default:sn(t,e,n)}}function th(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new ik),e.forEach(function(i){var r=fk.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function pt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Re=a.stateNode,yt=!1;break e;case 3:Re=a.stateNode.containerInfo,yt=!0;break e;case 4:Re=a.stateNode.containerInfo,yt=!0;break e}a=a.return}if(Re===null)throw Error(O(160));km(s,o,r),Re=null,yt=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){pe(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Sm(e,t),e=e.sibling}function Sm(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(pt(e,t),It(t),i&4){try{Pr(3,t,t.return),Yo(3,t)}catch(m){pe(t,t.return,m)}try{Pr(5,t,t.return)}catch(m){pe(t,t.return,m)}}break;case 1:pt(e,t),It(t),i&512&&n!==null&&bi(n,n.return);break;case 5:if(pt(e,t),It(t),i&512&&n!==null&&bi(n,n.return),t.flags&32){var r=t.stateNode;try{Nr(r,"")}catch(m){pe(t,t.return,m)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&zf(r,s),yc(a,o);var l=yc(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?Kf(r,d):u==="dangerouslySetInnerHTML"?qf(r,d):u==="children"?Nr(r,d):$l(r,u,d,l)}switch(a){case"input":fc(r,s);break;case"textarea":$f(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Pi(r,!!s.multiple,p,!1):h!==!!s.multiple&&(s.defaultValue!=null?Pi(r,!!s.multiple,s.defaultValue,!0):Pi(r,!!s.multiple,s.multiple?[]:"",!1))}r[$r]=s}catch(m){pe(t,t.return,m)}}break;case 6:if(pt(e,t),It(t),i&4){if(t.stateNode===null)throw Error(O(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(m){pe(t,t.return,m)}}break;case 3:if(pt(e,t),It(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Fr(e.containerInfo)}catch(m){pe(t,t.return,m)}break;case 4:pt(e,t),It(t);break;case 13:pt(e,t),It(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(bu=ve())),i&4&&th(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ae=(l=Ae)||u,pt(e,t),Ae=l):pt(e,t),It(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(j=t,u=t.child;u!==null;){for(d=j=u;j!==null;){switch(h=j,p=h.child,h.tag){case 0:case 11:case 14:case 15:Pr(4,h,h.return);break;case 1:bi(h,h.return);var v=h.stateNode;if(typeof v.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(m){pe(i,n,m)}}break;case 5:bi(h,h.return);break;case 22:if(h.memoizedState!==null){ih(d);continue}}p!==null?(p.return=h,j=p):ih(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Hf("display",o))}catch(m){pe(t,t.return,m)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(m){pe(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:pt(e,t),It(t),i&4&&th(t);break;case 21:break;default:pt(e,t),It(t)}}function It(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(ym(n)){var i=n;break e}n=n.return}throw Error(O(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Nr(r,""),i.flags&=-33);var s=eh(t);Gc(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=eh(t);Kc(t,a,o);break;default:throw Error(O(161))}}catch(c){pe(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function sk(t,e,n){j=t,Tm(t)}function Tm(t,e,n){for(var i=(t.mode&1)!==0;j!==null;){var r=j,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||bs;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Ae;a=bs;var l=Ae;if(bs=o,(Ae=c)&&!l)for(j=r;j!==null;)o=j,c=o.child,o.tag===22&&o.memoizedState!==null?rh(r):c!==null?(c.return=o,j=c):rh(r);for(;s!==null;)j=s,Tm(s),s=s.sibling;j=r,bs=a,Ae=l}nh(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,j=s):nh(t)}}function nh(t){for(;j!==null;){var e=j;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ae||Yo(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ae)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:vt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Bd(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Bd(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Fr(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}Ae||e.flags&512&&Hc(e)}catch(h){pe(e,e.return,h)}}if(e===t){j=null;break}if(n=e.sibling,n!==null){n.return=e.return,j=n;break}j=e.return}}function ih(t){for(;j!==null;){var e=j;if(e===t){j=null;break}var n=e.sibling;if(n!==null){n.return=e.return,j=n;break}j=e.return}}function rh(t){for(;j!==null;){var e=j;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Yo(4,e)}catch(c){pe(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){pe(e,r,c)}}var s=e.return;try{Hc(e)}catch(c){pe(e,s,c)}break;case 5:var o=e.return;try{Hc(e)}catch(c){pe(e,o,c)}}}catch(c){pe(e,e.return,c)}if(e===t){j=null;break}var a=e.sibling;if(a!==null){a.return=e.return,j=a;break}j=e.return}}var ok=Math.ceil,wo=tn.ReactCurrentDispatcher,Su=tn.ReactCurrentOwner,ut=tn.ReactCurrentBatchConfig,K=0,_e=null,Se=null,xe=0,Xe=0,Ci=Mn(0),Ce=0,Qr=null,ei=0,Xo=0,Tu=0,_r=null,$e=null,bu=0,qi=1/0,Vt=null,Eo=!1,Qc=null,Cn=null,Cs=!1,gn=null,Po=0,Rr=0,Jc=null,js=-1,Bs=0;function je(){return K&6?ve():js!==-1?js:js=ve()}function wn(t){return t.mode&1?K&2&&xe!==0?xe&-xe:$0.transition!==null?(Bs===0&&(Bs=sp()),Bs):(t=J,t!==0||(t=window.event,t=t===void 0?16:hp(t.type)),t):1}function Et(t,e,n,i){if(50<Rr)throw Rr=0,Jc=null,Error(O(185));ts(t,n,i),(!(K&2)||t!==_e)&&(t===_e&&(!(K&2)&&(Xo|=n),Ce===4&&hn(t,xe)),Je(t,i),n===1&&K===0&&!(e.mode&1)&&(qi=ve()+500,Go&&Nn()))}function Je(t,e){var n=t.callbackNode;$y(t,e);var i=co(t,t===_e?xe:0);if(i===0)n!==null&&fd(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&fd(n),e===1)t.tag===0?z0(sh.bind(null,t)):Op(sh.bind(null,t)),F0(function(){!(K&6)&&Nn()}),n=null;else{switch(op(i)){case 1:n=Gl;break;case 4:n=ip;break;case 16:n=ao;break;case 536870912:n=rp;break;default:n=ao}n=Im(n,bm.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function bm(t,e){if(js=-1,Bs=0,K&6)throw Error(O(327));var n=t.callbackNode;if(Oi()&&t.callbackNode!==n)return null;var i=co(t,t===_e?xe:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=_o(t,i);else{e=i;var r=K;K|=2;var s=wm();(_e!==t||xe!==e)&&(Vt=null,qi=ve()+500,Hn(t,e));do try{lk();break}catch(a){Cm(t,a)}while(!0);au(),wo.current=s,K=r,Se!==null?e=0:(_e=null,xe=0,e=Ce)}if(e!==0){if(e===2&&(r=Cc(t),r!==0&&(i=r,e=Yc(t,r))),e===1)throw n=Qr,Hn(t,0),hn(t,i),Je(t,ve()),n;if(e===6)hn(t,i);else{if(r=t.current.alternate,!(i&30)&&!ak(r)&&(e=_o(t,i),e===2&&(s=Cc(t),s!==0&&(i=s,e=Yc(t,s))),e===1))throw n=Qr,Hn(t,0),hn(t,i),Je(t,ve()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(O(345));case 2:Bn(t,$e,Vt);break;case 3:if(hn(t,i),(i&130023424)===i&&(e=bu+500-ve(),10<e)){if(co(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){je(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Oc(Bn.bind(null,t,$e,Vt),e);break}Bn(t,$e,Vt);break;case 4:if(hn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-wt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=ve()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*ok(i/1960))-i,10<i){t.timeoutHandle=Oc(Bn.bind(null,t,$e,Vt),i);break}Bn(t,$e,Vt);break;case 5:Bn(t,$e,Vt);break;default:throw Error(O(329))}}}return Je(t,ve()),t.callbackNode===n?bm.bind(null,t):null}function Yc(t,e){var n=_r;return t.current.memoizedState.isDehydrated&&(Hn(t,e).flags|=256),t=_o(t,e),t!==2&&(e=$e,$e=n,e!==null&&Xc(e)),t}function Xc(t){$e===null?$e=t:$e.push.apply($e,t)}function ak(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Pt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function hn(t,e){for(e&=~Tu,e&=~Xo,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-wt(e),i=1<<n;t[n]=-1,e&=~i}}function sh(t){if(K&6)throw Error(O(327));Oi();var e=co(t,0);if(!(e&1))return Je(t,ve()),null;var n=_o(t,e);if(t.tag!==0&&n===2){var i=Cc(t);i!==0&&(e=i,n=Yc(t,i))}if(n===1)throw n=Qr,Hn(t,0),hn(t,e),Je(t,ve()),n;if(n===6)throw Error(O(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Bn(t,$e,Vt),Je(t,ve()),null}function Cu(t,e){var n=K;K|=1;try{return t(e)}finally{K=n,K===0&&(qi=ve()+500,Go&&Nn())}}function ti(t){gn!==null&&gn.tag===0&&!(K&6)&&Oi();var e=K;K|=1;var n=ut.transition,i=J;try{if(ut.transition=null,J=1,t)return t()}finally{J=i,ut.transition=n,K=e,!(K&6)&&Nn()}}function wu(){Xe=Ci.current,ne(Ci)}function Hn(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,U0(n)),Se!==null)for(n=Se.return;n!==null;){var i=n;switch(ru(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&po();break;case 3:$i(),ne(Ge),ne(Ue),fu();break;case 5:hu(i);break;case 4:$i();break;case 13:ne(le);break;case 19:ne(le);break;case 10:cu(i.type._context);break;case 22:case 23:wu()}n=n.return}if(_e=t,Se=t=En(t.current,null),xe=Xe=e,Ce=0,Qr=null,Tu=Xo=ei=0,$e=_r=null,Wn!==null){for(e=0;e<Wn.length;e++)if(n=Wn[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Wn=null}return t}function Cm(t,e){do{var n=Se;try{if(au(),As.current=Co,bo){for(var i=ue.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}bo=!1}if(Zn=0,Ee=be=ue=null,Er=!1,Hr=0,Su.current=null,n===null||n.return===null){Ce=1,Qr=e,Se=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=xe,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Hd(o);if(p!==null){p.flags&=-257,Kd(p,o,a,s,e),p.mode&1&&qd(s,l,e),e=p,c=l;var v=e.updateQueue;if(v===null){var m=new Set;m.add(c),e.updateQueue=m}else v.add(c);break e}else{if(!(e&1)){qd(s,l,e),Eu();break e}c=Error(O(426))}}else if(oe&&a.mode&1){var b=Hd(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),Kd(b,o,a,s,e),su(Wi(c,a));break e}}s=c=Wi(c,a),Ce!==4&&(Ce=2),_r===null?_r=[s]:_r.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var f=om(s,c,e);jd(s,f);break e;case 1:a=c;var g=s.type,k=s.stateNode;if(!(s.flags&128)&&(typeof g.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Cn===null||!Cn.has(k)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=am(s,a,e);jd(s,S);break e}}s=s.return}while(s!==null)}Pm(n)}catch(y){e=y,Se===n&&n!==null&&(Se=n=n.return);continue}break}while(!0)}function wm(){var t=wo.current;return wo.current=Co,t===null?Co:t}function Eu(){(Ce===0||Ce===3||Ce===2)&&(Ce=4),_e===null||!(ei&268435455)&&!(Xo&268435455)||hn(_e,xe)}function _o(t,e){var n=K;K|=2;var i=wm();(_e!==t||xe!==e)&&(Vt=null,Hn(t,e));do try{ck();break}catch(r){Cm(t,r)}while(!0);if(au(),K=n,wo.current=i,Se!==null)throw Error(O(261));return _e=null,xe=0,Ce}function ck(){for(;Se!==null;)Em(Se)}function lk(){for(;Se!==null&&!Ny();)Em(Se)}function Em(t){var e=Rm(t.alternate,t,Xe);t.memoizedProps=t.pendingProps,e===null?Pm(t):Se=e,Su.current=null}function Pm(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=nk(n,e),n!==null){n.flags&=32767,Se=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ce=6,Se=null;return}}else if(n=tk(n,e,Xe),n!==null){Se=n;return}if(e=e.sibling,e!==null){Se=e;return}Se=e=t}while(e!==null);Ce===0&&(Ce=5)}function Bn(t,e,n){var i=J,r=ut.transition;try{ut.transition=null,J=1,uk(t,e,n,i)}finally{ut.transition=r,J=i}return null}function uk(t,e,n,i){do Oi();while(gn!==null);if(K&6)throw Error(O(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(O(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Wy(t,s),t===_e&&(Se=_e=null,xe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Cs||(Cs=!0,Im(ao,function(){return Oi(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=ut.transition,ut.transition=null;var o=J;J=1;var a=K;K|=4,Su.current=null,rk(t,n),Sm(n,t),x0(Ic),lo=!!Rc,Ic=Rc=null,t.current=n,sk(n),Ly(),K=a,J=o,ut.transition=s}else t.current=n;if(Cs&&(Cs=!1,gn=t,Po=r),s=t.pendingLanes,s===0&&(Cn=null),Fy(n.stateNode),Je(t,ve()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Eo)throw Eo=!1,t=Qc,Qc=null,t;return Po&1&&t.tag!==0&&Oi(),s=t.pendingLanes,s&1?t===Jc?Rr++:(Rr=0,Jc=t):Rr=0,Nn(),null}function Oi(){if(gn!==null){var t=op(Po),e=ut.transition,n=J;try{if(ut.transition=null,J=16>t?16:t,gn===null)var i=!1;else{if(t=gn,gn=null,Po=0,K&6)throw Error(O(331));var r=K;for(K|=4,j=t.current;j!==null;){var s=j,o=s.child;if(j.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(j=l;j!==null;){var u=j;switch(u.tag){case 0:case 11:case 15:Pr(8,u,s)}var d=u.child;if(d!==null)d.return=u,j=d;else for(;j!==null;){u=j;var h=u.sibling,p=u.return;if(vm(u),u===l){j=null;break}if(h!==null){h.return=p,j=h;break}j=p}}}var v=s.alternate;if(v!==null){var m=v.child;if(m!==null){v.child=null;do{var b=m.sibling;m.sibling=null,m=b}while(m!==null)}}j=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,j=o;else e:for(;j!==null;){if(s=j,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Pr(9,s,s.return)}var f=s.sibling;if(f!==null){f.return=s.return,j=f;break e}j=s.return}}var g=t.current;for(j=g;j!==null;){o=j;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,j=k;else e:for(o=g;j!==null;){if(a=j,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Yo(9,a)}}catch(y){pe(a,a.return,y)}if(a===o){j=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,j=S;break e}j=a.return}}if(K=r,Nn(),Lt&&typeof Lt.onPostCommitFiberRoot=="function")try{Lt.onPostCommitFiberRoot($o,t)}catch{}i=!0}return i}finally{J=n,ut.transition=e}}return!1}function oh(t,e,n){e=Wi(n,e),e=om(t,e,1),t=bn(t,e,1),e=je(),t!==null&&(ts(t,1,e),Je(t,e))}function pe(t,e,n){if(t.tag===3)oh(t,t,n);else for(;e!==null;){if(e.tag===3){oh(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Cn===null||!Cn.has(i))){t=Wi(n,t),t=am(e,t,1),e=bn(e,t,1),t=je(),e!==null&&(ts(e,1,t),Je(e,t));break}}e=e.return}}function dk(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=je(),t.pingedLanes|=t.suspendedLanes&n,_e===t&&(xe&n)===n&&(Ce===4||Ce===3&&(xe&130023424)===xe&&500>ve()-bu?Hn(t,0):Tu|=n),Je(t,e)}function _m(t,e){e===0&&(t.mode&1?(e=fs,fs<<=1,!(fs&130023424)&&(fs=4194304)):e=1);var n=je();t=Yt(t,e),t!==null&&(ts(t,e,n),Je(t,n))}function hk(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),_m(t,n)}function fk(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(O(314))}i!==null&&i.delete(e),_m(t,n)}var Rm;Rm=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ge.current)qe=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return qe=!1,ek(t,e,n);qe=!!(t.flags&131072)}else qe=!1,oe&&e.flags&1048576&&Dp(e,vo,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Fs(t,e),t=e.pendingProps;var r=Bi(e,Ue.current);xi(e,n),r=mu(null,e,i,t,r,n);var s=gu();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qe(i)?(s=!0,mo(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,uu(e),r.updater=Jo,e.stateNode=r,r._reactInternals=e,Fc(e,i,t,n),e=Vc(null,e,i,!0,s,n)):(e.tag=0,oe&&s&&iu(e),Fe(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Fs(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=mk(i),t=vt(i,t),r){case 0:e=Bc(null,e,i,t,n);break e;case 1:e=Jd(null,e,i,t,n);break e;case 11:e=Gd(null,e,i,t,n);break e;case 14:e=Qd(null,e,i,vt(i.type,t),n);break e}throw Error(O(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:vt(i,r),Bc(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:vt(i,r),Jd(t,e,i,r,n);case 3:e:{if(dm(e),t===null)throw Error(O(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Fp(t,e),So(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Wi(Error(O(423)),e),e=Yd(t,e,i,n,r);break e}else if(i!==r){r=Wi(Error(O(424)),e),e=Yd(t,e,i,n,r);break e}else for(et=Tn(e.stateNode.containerInfo.firstChild),tt=e,oe=!0,St=null,n=Ap(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Vi(),i===r){e=Xt(t,e,n);break e}Fe(t,e,i,n)}e=e.child}return e;case 5:return jp(e),t===null&&Lc(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,xc(i,r)?o=null:s!==null&&xc(i,s)&&(e.flags|=32),um(t,e),Fe(t,e,o,n),e.child;case 6:return t===null&&Lc(e),null;case 13:return hm(t,e,n);case 4:return du(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=zi(e,null,i,n):Fe(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:vt(i,r),Gd(t,e,i,r,n);case 7:return Fe(t,e,e.pendingProps,n),e.child;case 8:return Fe(t,e,e.pendingProps.children,n),e.child;case 12:return Fe(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Z(yo,i._currentValue),i._currentValue=o,s!==null)if(Pt(s.value,o)){if(s.children===r.children&&!Ge.current){e=Xt(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=Gt(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),Ac(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(O(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Ac(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Fe(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,xi(e,n),r=dt(r),i=i(r),e.flags|=1,Fe(t,e,i,n),e.child;case 14:return i=e.type,r=vt(i,e.pendingProps),r=vt(i.type,r),Qd(t,e,i,r,n);case 15:return cm(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:vt(i,r),Fs(t,e),e.tag=1,Qe(i)?(t=!0,mo(e)):t=!1,xi(e,n),sm(e,i,r),Fc(e,i,r,n),Vc(null,e,i,!0,t,n);case 19:return fm(t,e,n);case 22:return lm(t,e,n)}throw Error(O(156,e.tag))};function Im(t,e){return np(t,e)}function pk(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ct(t,e,n,i){return new pk(t,e,n,i)}function Pu(t){return t=t.prototype,!(!t||!t.isReactComponent)}function mk(t){if(typeof t=="function")return Pu(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ql)return 11;if(t===Hl)return 14}return 2}function En(t,e){var n=t.alternate;return n===null?(n=ct(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Vs(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Pu(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case fi:return Kn(n.children,r,s,e);case Wl:o=8,r|=8;break;case cc:return t=ct(12,n,e,r|2),t.elementType=cc,t.lanes=s,t;case lc:return t=ct(13,n,e,r),t.elementType=lc,t.lanes=s,t;case uc:return t=ct(19,n,e,r),t.elementType=uc,t.lanes=s,t;case jf:return Zo(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Uf:o=10;break e;case Ff:o=9;break e;case ql:o=11;break e;case Hl:o=14;break e;case ln:o=16,i=null;break e}throw Error(O(130,t==null?t:typeof t,""))}return e=ct(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Kn(t,e,n,i){return t=ct(7,t,i,e),t.lanes=n,t}function Zo(t,e,n,i){return t=ct(22,t,i,e),t.elementType=jf,t.lanes=n,t.stateNode={isHidden:!1},t}function Aa(t,e,n){return t=ct(6,t,null,e),t.lanes=n,t}function Ua(t,e,n){return e=ct(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function gk(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=va(0),this.expirationTimes=va(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=va(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function _u(t,e,n,i,r,s,o,a,c){return t=new gk(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=ct(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},uu(s),t}function vk(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:hi,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function xm(t){if(!t)return In;t=t._reactInternals;e:{if(si(t)!==t||t.tag!==1)throw Error(O(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(O(171))}if(t.tag===1){var n=t.type;if(Qe(n))return xp(t,n,e)}return e}function Om(t,e,n,i,r,s,o,a,c){return t=_u(n,i,!0,t,r,s,o,a,c),t.context=xm(null),n=t.current,i=je(),r=wn(n),s=Gt(i,r),s.callback=e??null,bn(n,s,r),t.current.lanes=r,ts(t,r,i),Je(t,i),t}function ea(t,e,n,i){var r=e.current,s=je(),o=wn(r);return n=xm(n),e.context===null?e.context=n:e.pendingContext=n,e=Gt(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=bn(r,e,o),t!==null&&(Et(t,r,o,s),Ls(t,r,o)),o}function Ro(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ah(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ru(t,e){ah(t,e),(t=t.alternate)&&ah(t,e)}function yk(){return null}var Dm=typeof reportError=="function"?reportError:function(t){console.error(t)};function Iu(t){this._internalRoot=t}ta.prototype.render=Iu.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(O(409));ea(t,e,null,null)};ta.prototype.unmount=Iu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ti(function(){ea(null,t,null,null)}),e[Jt]=null}};function ta(t){this._internalRoot=t}ta.prototype.unstable_scheduleHydration=function(t){if(t){var e=lp();t={blockedOn:null,target:t,priority:e};for(var n=0;n<dn.length&&e!==0&&e<dn[n].priority;n++);dn.splice(n,0,t),n===0&&dp(t)}};function xu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function na(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function ch(){}function kk(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=Ro(o);s.call(l)}}var o=Om(e,i,t,0,null,!1,!1,"",ch);return t._reactRootContainer=o,t[Jt]=o.current,Vr(t.nodeType===8?t.parentNode:t),ti(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=Ro(c);a.call(l)}}var c=_u(t,0,!1,null,null,!1,!1,"",ch);return t._reactRootContainer=c,t[Jt]=c.current,Vr(t.nodeType===8?t.parentNode:t),ti(function(){ea(e,c,n,i)}),c}function ia(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=Ro(o);a.call(c)}}ea(e,o,t,r)}else o=kk(n,e,t,r,i);return Ro(o)}ap=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=vr(e.pendingLanes);n!==0&&(Ql(e,n|1),Je(e,ve()),!(K&6)&&(qi=ve()+500,Nn()))}break;case 13:ti(function(){var i=Yt(t,1);if(i!==null){var r=je();Et(i,t,1,r)}}),Ru(t,1)}};Jl=function(t){if(t.tag===13){var e=Yt(t,134217728);if(e!==null){var n=je();Et(e,t,134217728,n)}Ru(t,134217728)}};cp=function(t){if(t.tag===13){var e=wn(t),n=Yt(t,e);if(n!==null){var i=je();Et(n,t,e,i)}Ru(t,e)}};lp=function(){return J};up=function(t,e){var n=J;try{return J=t,e()}finally{J=n}};Sc=function(t,e,n){switch(e){case"input":if(fc(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Ko(i);if(!r)throw Error(O(90));Vf(i),fc(i,r)}}}break;case"textarea":$f(t,n);break;case"select":e=n.value,e!=null&&Pi(t,!!n.multiple,e,!1)}};Jf=Cu;Yf=ti;var Sk={usingClientEntryPoint:!1,Events:[is,vi,Ko,Gf,Qf,Cu]},lr={findFiberByHostInstance:$n,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Tk={bundleType:lr.bundleType,version:lr.version,rendererPackageName:lr.rendererPackageName,rendererConfig:lr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ep(t),t===null?null:t.stateNode},findFiberByHostInstance:lr.findFiberByHostInstance||yk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ws=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ws.isDisabled&&ws.supportsFiber)try{$o=ws.inject(Tk),Lt=ws}catch{}}rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sk;rt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xu(e))throw Error(O(200));return vk(t,e,null,n)};rt.createRoot=function(t,e){if(!xu(t))throw Error(O(299));var n=!1,i="",r=Dm;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=_u(t,1,!1,null,null,n,!1,i,r),t[Jt]=e.current,Vr(t.nodeType===8?t.parentNode:t),new Iu(e)};rt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(O(188)):(t=Object.keys(t).join(","),Error(O(268,t)));return t=ep(e),t=t===null?null:t.stateNode,t};rt.flushSync=function(t){return ti(t)};rt.hydrate=function(t,e,n){if(!na(e))throw Error(O(200));return ia(null,t,e,!0,n)};rt.hydrateRoot=function(t,e,n){if(!xu(t))throw Error(O(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Dm;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Om(e,null,t,1,n??null,r,!1,s,o),t[Jt]=e.current,Vr(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new ta(e)};rt.render=function(t,e,n){if(!na(e))throw Error(O(200));return ia(null,t,e,!1,n)};rt.unmountComponentAtNode=function(t){if(!na(t))throw Error(O(40));return t._reactRootContainer?(ti(function(){ia(null,null,t,!1,function(){t._reactRootContainer=null,t[Jt]=null})}),!0):!1};rt.unstable_batchedUpdates=Cu;rt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!na(n))throw Error(O(200));if(t==null||t._reactInternals===void 0)throw Error(O(38));return ia(t,e,n,!1,i)};rt.version="18.3.1-next-f1338f8080-20240426";function Mm(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Mm)}catch(t){console.error(t)}}Mm(),Mf.exports=rt;var bk=Mf.exports,lh=bk;oc.createRoot=lh.createRoot,oc.hydrateRoot=lh.hydrateRoot;var uh={};function Ck(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var wk=Object.defineProperty,Ek=(t,e,n)=>e in t?wk(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,dh=(t,e,n)=>Ek(t,typeof e!="symbol"?e+"":e,n);let He=class{constructor(){dh(this,"_locking"),dh(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function me(t,e){if(!t)throw new Error(e)}const Pk=34028234663852886e22,_k=-34028234663852886e22,Rk=4294967295,Ik=2147483647,xk=-2147483648;function zs(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>Ik||t<xk)throw new Error("invalid int 32: "+t)}function Zc(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>Rk||t<0)throw new Error("invalid uint 32: "+t)}function Nm(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>Pk||t<_k))throw new Error("invalid float 32: "+t)}const Lm=Symbol("@bufbuild/protobuf/enum-type");function Ok(t){const e=t[Lm];return me(e,"missing enum type on enum object"),e}function Am(t,e,n,i){t[Lm]=Um(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function Um(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=Fm(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function Dk(t,e,n){const i={};for(const r of e){const s=Fm(r);i[s.localName]=s.no,i[s.no]=s.localName}return Am(i,t,e),i}function Fm(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Ou{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Mk(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new Ou),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function Nk(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Fa(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const $s=4294967296;function hh(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=$s&&(r=r+(i/$s|0),i=i%$s)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?Bm(i,r):Du(i,r)}function Lk(t,e){let n=Du(t,e);const i=n.hi&2147483648;i&&(n=Bm(n.lo,n.hi));const r=jm(n.lo,n.hi);return i?"-"+r:r}function jm(t,e){if({lo:t,hi:e}=Ak(t,e),e<=2097151)return String($s*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+fh(o)+fh(s)}function Ak(t,e){return{lo:t>>>0,hi:e>>>0}}function Du(t,e){return{lo:t|0,hi:e|0}}function Bm(t,e){return e=~e,t?t=~t+1:e+=1,Du(t,e)}const fh=t=>{const e=String(t);return"0000000".slice(e.length)+e};function ph(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function Uk(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Fk(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof uh!="object"||uh.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>me(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>me(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),hh(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),hh(r)},dec(r,s){return Lk(r,s)},uDec(r,s){return jm(r,s)}}}const ae=Fk();var I;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(I||(I={}));var xn;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(xn||(xn={}));function on(t,e,n){if(e===n)return!0;if(t==I.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==n}return!1}function Hi(t,e){switch(t){case I.BOOL:return!1;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==0?ae.zero:"0";case I.DOUBLE:case I.FLOAT:return 0;case I.BYTES:return new Uint8Array(0);case I.STRING:return"";default:return 0}}function Vm(t,e){switch(t){case I.BOOL:return e===!1;case I.STRING:return e==="";case I.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var ye;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(ye||(ye={}));class jk{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Zc(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return zs(e),ph(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Nm(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Zc(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){zs(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return zs(e),e=(e<<1^e>>31)>>>0,ph(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=ae.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=ae.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=ae.enc(e);return Fa(n.lo,n.hi,this.buf),this}sint64(e){let n=ae.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Fa(r,s,this.buf),this}uint64(e){let n=ae.uEnc(e);return Fa(n.lo,n.hi,this.buf),this}}class Bk{constructor(e,n){this.varint64=Nk,this.uint32=Uk,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case ye.Varint:for(;this.buf[this.pos++]&128;);break;case ye.Bit64:this.pos+=4;case ye.Bit32:this.pos+=4;break;case ye.LengthDelimited:let r=this.uint32();this.pos+=r;break;case ye.StartGroup:for(;;){const[s,o]=this.tag();if(o===ye.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ae.dec(...this.varint64())}uint64(){return ae.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,ae.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ae.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ae.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function Vk(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function zm(t){const e=t.field.localName,n=Object.create(null);return n[e]=zk(t),[n,()=>n[e]]}function zk(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Hi(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function $k(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ra=[];for(let t=0;t<Wt.length;t++)ra[Wt[t].charCodeAt(0)]=t;ra[45]=Wt.indexOf("+");ra[95]=Wt.indexOf("/");const $m={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=ra[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=Wt[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Wt[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Wt[r|i>>6],e+=Wt[i&63],n=0;break}return n&&(e+=Wt[r],e+="=",n==1&&(e+="=")),e}};function Wk(t,e,n){qm(e,t);const i=e.runtime.bin.makeReadOptions(n),r=$k(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=zm(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function qk(t,e,n,i){qm(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(Wm(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function Wm(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function qm(t,e){me(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function Hm(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Vm(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function mh(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Hi(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Gn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Ou.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Km(t,e){return Gn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}I.DOUBLE,I.FLOAT,I.INT64,I.UINT64,I.INT32,I.UINT32,I.BOOL,I.STRING,I.BYTES;const gh={ignoreUnknownFields:!1},vh={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Hk(t){return t?Object.assign(Object.assign({},gh),t):gh}function Kk(t){return t?Object.assign(Object.assign({},vh),t):vh}const Io=Symbol(),Ws=Symbol();function Gk(){return{makeReadOptions:Hk,makeWriteOptions:Kk,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Dt(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}yh(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,h]=zm(u);yh(d,a,u.field,n,u),qk(i,u,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!Hm(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!Jk(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=kh(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&Wm(t,a)){const c=Wk(t,a,e),l=kh(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Ir(t,e,n??xn.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Vm(t,e)))return qs(t,e)},debug:Dt}}function Dt(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function yh(t,e,n,i,r){let s=n.localName;if(n.repeated){if(me(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Dt(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Dt(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=ja(n.T,a,i.ignoreUnknownFields,!0);c!==Ws&&o.push(c);break;case"scalar":try{o.push(Ir(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Dt(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Dt(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=Qk(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Dt(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const u=ja(n.V.T,c,i.ignoreUnknownFields,!0);u!==Ws&&(o[l]=u);break;case"scalar":try{o[l]=Ir(n.V.T,c,xn.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Dt(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];Gn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=ja(n.T,e,i.ignoreUnknownFields,!1);switch(c){case Io:mh(n,t);break;case Ws:break;default:t[s]=c;break}break;case"scalar":try{const l=Ir(n.T,e,n.L,!1);switch(l){case Io:mh(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Dt(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function Qk(t,e){if(t===I.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Ir(t,e,xn.BIGINT,!0).toString()}function Ir(t,e,n,i){if(e===null)return i?Hi(t,n):Io;switch(t){case I.DOUBLE:case I.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==I.FLOAT&&Nm(r),r;case I.INT32:case I.FIXED32:case I.SFIXED32:case I.SINT32:case I.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==I.UINT32||t==I.FIXED32?Zc(s):zs(s),s;case I.INT64:case I.SFIXED64:case I.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=ae.parse(e);return n?o.toString():o;case I.FIXED64:case I.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=ae.uParse(e);return n?a.toString():a;case I.BOOL:if(typeof e!="boolean")break;return e;case I.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case I.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return $m.dec(e)}throw new Error}function ja(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Io;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Ws;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Dt(e)))}function Jk(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function kh(t,e,n){if(t.kind=="map"){me(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=qs(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Ba(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){me(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(qs(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Ba(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return qs(t.T,e);case"enum":return Ba(t.T,e,n.enumAsInteger);case"message":return Km(t.T,e).toJson(n)}}function Ba(t,e,n){var i;if(me(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function qs(t,e){switch(t){case I.INT32:case I.SFIXED32:case I.SINT32:case I.FIXED32:case I.UINT32:return me(typeof e=="number"),e;case I.FLOAT:case I.DOUBLE:return me(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case I.STRING:return me(typeof e=="string"),e;case I.BOOL:return me(typeof e=="boolean"),e;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return me(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case I.BYTES:return me(e instanceof Uint8Array),$m.enc(e)}}const li=Symbol("@bufbuild/protobuf/unknown-fields"),Sh={readUnknownFields:!0,readerFactory:t=>new Bk(t)},Th={writeUnknownFields:!0,writerFactory:()=>new jk};function Yk(t){return t?Object.assign(Object.assign({},Sh),t):Sh}function Xk(t){return t?Object.assign(Object.assign({},Th),t):Th}function Zk(){return{makeReadOptions:Yk,makeWriteOptions:Xk,listUnknownFields(t){var e;return(e=t[li])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[li]},writeUnknownFields(t,e){const i=t[li];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[li])||(r[li]=[]),r[li].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==ye.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}bh(t,e,l,c,i)}if(r&&(c!=ye.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:bh,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!Hm(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Ch(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Ch(t,e,n,i)}}}function bh(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?I.INT32:n.T;let c=xo;if(n.kind=="scalar"&&n.L>0&&(c=tS),s){let h=t[o];if(i==ye.LengthDelimited&&a!=I.STRING&&a!=I.BYTES){let v=e.uint32()+e.pos;for(;e.pos<v;)h.push(c(e,a))}else h.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(Hs(e,new l,r,n)):Gn(t[o])?Hs(e,t[o],r,n):(t[o]=Hs(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=eS(n,e,r);t[o][u]=d;break}}function Hs(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function eS(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=xo(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=xo(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=Hs(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Hi(t.K,xn.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Hi(t.V.T,xn.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function tS(t,e){const n=xo(t,e);return typeof n=="bigint"?n.toString():n}function xo(t,e){switch(e){case I.STRING:return t.string();case I.BOOL:return t.bool();case I.DOUBLE:return t.double();case I.FLOAT:return t.float();case I.INT32:return t.int32();case I.INT64:return t.int64();case I.UINT64:return t.uint64();case I.FIXED64:return t.fixed64();case I.BYTES:return t.bytes();case I.FIXED32:return t.fixed32();case I.SFIXED32:return t.sfixed32();case I.SFIXED64:return t.sfixed64();case I.SINT64:return t.sint64();case I.UINT32:return t.uint32();case I.SINT32:return t.sint32()}}function Ch(t,e,n,i){me(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?I.INT32:t.T;if(r)if(me(Array.isArray(e)),t.packed)iS(n,s,t.no,e);else for(const o of e)xr(n,s,t.no,o);else xr(n,s,t.no,e);break;case"message":if(r){me(Array.isArray(e));for(const o of e)wh(n,i,t,o)}else wh(n,i,t,e);break;case"map":me(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))nS(n,i,t,o,a);break}}function nS(t,e,n,i,r){t.tag(n.no,ye.LengthDelimited),t.fork();let s=i;switch(n.K){case I.INT32:case I.FIXED32:case I.UINT32:case I.SFIXED32:case I.SINT32:s=Number.parseInt(i);break;case I.BOOL:me(i=="true"||i=="false"),s=i=="true";break}switch(xr(t,n.K,1,s),n.V.kind){case"scalar":xr(t,n.V.T,2,r);break;case"enum":xr(t,I.INT32,2,r);break;case"message":me(r!==void 0),t.tag(2,ye.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function wh(t,e,n,i){const r=Km(n.T,i);n.delimited?t.tag(n.no,ye.StartGroup).raw(r.toBinary(e)).tag(n.no,ye.EndGroup):t.tag(n.no,ye.LengthDelimited).bytes(r.toBinary(e))}function xr(t,e,n,i){me(i!==void 0);let[r,s]=Gm(e);t.tag(n,r)[s](i)}function iS(t,e,n,i){if(!i.length)return;t.tag(n,ye.LengthDelimited).fork();let[,r]=Gm(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function Gm(t){let e=ye.Varint;switch(t){case I.BYTES:case I.STRING:e=ye.LengthDelimited;break;case I.DOUBLE:case I.FIXED64:case I.SFIXED64:e=ye.Bit64;break;case I.FIXED32:case I.SFIXED32:case I.FLOAT:e=ye.Bit32;break}const n=I[t].toLowerCase();return[e,n]}function rS(){return{setEnumType:Am,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!Gn(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===I.BYTES&&(l=ur(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let u=o[r];i.T===I.BYTES&&(u=i.repeated?u.map(ur):ur(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===I.BYTES)for(const[p,v]of Object.entries(o[r]))s[r][p]=ur(v);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const p of Object.keys(o[r])){let v=o[r][p];h.fieldWrapper||(v=new h(v)),s[r][p]=v}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>Gn(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=ur(h):s[r]=h:s[r]=Gn(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>on(i.T,o,s[a]));case"enum":return r.every((o,a)=>on(I.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":return i.T.equals(r,s);case"enum":return on(I.INT32,r,s);case"scalar":return on(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const o=i.findField(r.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(r.value,s.value);case"enum":return on(I.INT32,r.value,s.value);case"scalar":return on(o.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const a=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const c=i.V.T;return a.every(u=>c.equals(r[u],s[u]));case"enum":return a.every(u=>on(I.INT32,r[u],s[u]));case"scalar":const l=i.V.T;return a.every(u=>on(l,r[u],s[u]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(Es);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=Es(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:Es(s.value)}:{case:void 0}:o=Es(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function Es(t){if(t===void 0)return t;if(Gn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function ur(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function sS(t,e,n){return{syntax:t,json:Gk(),bin:Zk(),util:Object.assign(Object.assign({},rS()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return Mk(this,i,r,s)},makeEnum:Dk,makeEnumType:Um,getEnumType:Ok,makeExtension(i,r,s){return Vk(this,i,r,s)}}}class oS{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Qm(t,e){const n=Jm(t);return e?n:hS(dS(n))}function aS(t){return Qm(t,!1)}const cS=Jm;function Jm(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const lS=new Set(["constructor","toString","toJSON","valueOf"]),uS=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Ym=t=>"".concat(t,"$"),dS=t=>uS.has(t)?Ym(t):t,hS=t=>lS.has(t)?Ym(t):t;class fS{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=aS(e)}addField(e){me(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function pS(t,e){var n,i,r,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=Qm(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:cS(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:xn.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=I.BYTES&&u.T!=I.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=h)&&(l=new fS(h)),d.oneof=l,l.addField(d)}c.push(d)}return c}const E=sS("proto3",t=>new oS(t,e=>pS(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Hi(e.T,e.L);break}}});class We extends Ou{constructor(e){super(),this.seconds=ae.zero,this.nanos=0,E.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(E.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ae.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return We.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new We({seconds:ae.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new We().fromBinary(e,n)}static fromJson(e,n){return new We().fromJson(e,n)}static fromJsonString(e,n){return new We().fromJsonString(e,n)}static equals(e,n){return E.util.equals(We,e,n)}}We.runtime=E;We.typeName="google.protobuf.Timestamp";We.fields=E.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const mS=E.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:We},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:gS,repeated:!0},{no:5,name:"events",kind:"message",T:yS,repeated:!0}]),gS=E.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:vS,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),vS=E.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:We},{no:3,name:"value",kind:"scalar",T:2}]),yS=E.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:We},{no:7,name:"normalized_end_timestamp",kind:"message",T:We,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Xm=E.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Tt=E.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),ke=E.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Di=E.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),kr=E.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Jr=E.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Ct=E.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),ui=E.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),kS=E.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Mt=E.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),Mu=E.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Oo,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:ug}]),Oo=E.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),SS=E.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:E.getEnumType(ke),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Yr=E.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:E.getEnumType(el)},{no:4,name:"tracks",kind:"message",T:wi,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:SS},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:E.getEnumType(Do)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:E.getEnumType(Ct)},{no:18,name:"kind_details",kind:"enum",T:E.getEnumType(TS),repeated:!0}]),el=E.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Do=E.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),TS=E.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Ze=E.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),bS=E.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Qn,repeated:!0}]),wi=E.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:E.getEnumType(Tt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:E.getEnumType(ke)},{no:10,name:"layers",kind:"message",T:Qn,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:bS,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:E.getEnumType(Ze)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:ug},{no:19,name:"audio_features",kind:"enum",T:E.getEnumType(Mt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:E.getEnumType(Xm)}]),Qn=E.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:E.getEnumType(Di)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),ze=E.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:E.getEnumType(H)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:eg,oneof:"value"},{no:3,name:"speaker",kind:"message",T:CS,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:tg,oneof:"value"},{no:7,name:"transcription",kind:"message",T:wS,oneof:"value"},{no:8,name:"metrics",kind:"message",T:mS,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:tl,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:ng,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:ig,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:rg,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:il,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:rl,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:sl,oneof:"value"}]),H=E.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),CS=E.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Zm,repeated:!0}]),Zm=E.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),eg=E.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),tg=E.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),wS=E.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:ES,repeated:!0}]),ES=E.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),tl=E.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),ng=E.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),ig=E.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),rg=E.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:sg,oneof:"value"}]),sg=E.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),og=E.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),PS=E.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:E.getEnumType(ag)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ag=E.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),_S=E.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:E.getEnumType(cg)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),cg=E.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),lg=E.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Eh},{no:2,name:"screen",kind:"message",T:Eh},{no:3,name:"resume_connection",kind:"enum",T:E.getEnumType(Jr)},{no:4,name:"disabled_codecs",kind:"message",T:RS},{no:5,name:"force_relay",kind:"enum",T:E.getEnumType(Jr)}]),Eh=E.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:E.getEnumType(Jr)}]),RS=E.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Oo,repeated:!0},{no:2,name:"publish",kind:"message",T:Oo,repeated:!0}]),ug=E.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),nl=E.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),dg=E.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:E.getEnumType(nl)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),hg=E.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),il=E.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:E.getEnumType(Ze)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:dg,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:hg,oneof:"content_header"}],{localName:"DataStream_Header"}),rl=E.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),sl=E.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),bt=E.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),ol=E.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),IS=E.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),xS=E.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:ni,oneof:"message"},{no:2,name:"answer",kind:"message",T:ni,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Nu,oneof:"message"},{no:4,name:"add_track",kind:"message",T:cl,oneof:"message"},{no:5,name:"mute",kind:"message",T:Lu,oneof:"message"},{no:6,name:"subscription",kind:"message",T:sa,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:fg,oneof:"message"},{no:8,name:"leave",kind:"message",T:oa,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:mg,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:kg,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Sg,oneof:"message"},{no:13,name:"simulate",kind:"message",T:xt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:gg,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:bg,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:pg,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:LS,oneof:"message"}]),Ph=E.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:OS,oneof:"message"},{no:2,name:"answer",kind:"message",T:ni,oneof:"message"},{no:3,name:"offer",kind:"message",T:ni,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Nu,oneof:"message"},{no:5,name:"update",kind:"message",T:NS,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Au,oneof:"message"},{no:8,name:"leave",kind:"message",T:oa,oneof:"message"},{no:9,name:"mute",kind:"message",T:Lu,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:AS,oneof:"message"},{no:11,name:"room_update",kind:"message",T:US,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:jS,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:VS,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:$S,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:WS,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:MS,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:DS,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:qS,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:GS,oneof:"message"},{no:22,name:"request_response",kind:"message",T:QS,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:JS,oneof:"message"}]),al=E.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),cl=E.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:E.getEnumType(Tt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:E.getEnumType(ke)},{no:9,name:"layers",kind:"message",T:Qn,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:al,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:E.getEnumType(Ze)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:E.getEnumType(Xm)}]),Nu=E.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:E.getEnumType(bt)},{no:3,name:"final",kind:"scalar",T:8}]),Lu=E.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),OS=E.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Mu},{no:2,name:"participant",kind:"message",T:Yr},{no:3,name:"other_participants",kind:"message",T:Yr,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:vg,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:lg},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:PS},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Oo,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),DS=E.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:vg,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:lg}]),Au=E.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:wi}]),MS=E.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),ni=E.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),NS=E.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Yr,repeated:!0}]),sa=E.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:og,repeated:!0}]),fg=E.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:E.getEnumType(Di)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),pg=E.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:E.getEnumType(Mt),repeated:!0}]),LS=E.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),oa=E.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:E.getEnumType(Ct)},{no:3,name:"action",kind:"enum",T:E.getEnumType(Mi)},{no:4,name:"regions",kind:"message",T:HS}]),Mi=E.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),mg=E.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Qn,repeated:!0}]),gg=E.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),vg=E.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),AS=E.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Zm,repeated:!0}]),US=E.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Mu}]),FS=E.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:E.getEnumType(kr)},{no:3,name:"score",kind:"scalar",T:2}]),jS=E.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:FS,repeated:!0}]),BS=E.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:E.getEnumType(ol)}]),VS=E.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:BS,repeated:!0}]),Uu=E.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:E.getEnumType(Di)},{no:2,name:"enabled",kind:"scalar",T:8}]),zS=E.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Uu,repeated:!0}]),$S=E.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Uu,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:zS,repeated:!0}]),yg=E.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),kg=E.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:yg,repeated:!0}]),WS=E.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Sg=E.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:ni},{no:2,name:"subscription",kind:"message",T:sa},{no:3,name:"publish_tracks",kind:"message",T:Au,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Tg,repeated:!0},{no:5,name:"offer",kind:"message",T:ni},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),Tg=E.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:E.getEnumType(bt)}]),xt=E.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:E.getEnumType(IS),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),bg=E.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),qS=E.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),HS=E.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:KS,repeated:!0}]),KS=E.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),GS=E.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:E.getEnumType(kS)}]),QS=E.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:E.getEnumType(Fu)},{no:3,name:"message",kind:"scalar",T:9}]),Fu=E.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),JS=E.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function YS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ks={exports:{}},XS=Ks.exports,_h;function ZS(){return _h||(_h=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(XS,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(m,b){var f=m[b];if(typeof f.bind=="function")return f.bind(m);try{return Function.prototype.bind.call(f,m)}catch{return function(){return Function.prototype.apply.apply(f,[m,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(m){return m==="debug"&&(m="log"),typeof console===n?!1:m==="trace"&&i?c:console[m]!==void 0?a(console,m):console.log!==void 0?a(console,"log"):e}function u(){for(var m=this.getLevel(),b=0;b<r.length;b++){var f=r[b];this[f]=b<m?e:this.methodFactory(f,m,this.name)}if(this.log=this.debug,typeof console===n&&m<this.levels.SILENT)return"No console available for logging"}function d(m){return function(){typeof console!==n&&(u.call(this),this[m].apply(this,arguments))}}function h(m,b,f){return l(m)||d.apply(this,arguments)}function p(m,b){var f=this,g,k,S,y="loglevel";typeof m=="string"?y+=":"+m:typeof m=="symbol"&&(y=void 0);function C(N){var B=(r[N]||"silent").toUpperCase();if(!(typeof window===n||!y)){try{window.localStorage[y]=B;return}catch{}try{window.document.cookie=encodeURIComponent(y)+"="+B+";"}catch{}}}function P(){var N;if(!(typeof window===n||!y)){try{N=window.localStorage[y]}catch{}if(typeof N===n)try{var B=window.document.cookie,ie=encodeURIComponent(y),De=B.indexOf(ie+"=");De!==-1&&(N=/^([^;]+)/.exec(B.slice(De+ie.length+1))[1])}catch{}return f.levels[N]===void 0&&(N=void 0),N}}function R(){if(!(typeof window===n||!y)){try{window.localStorage.removeItem(y)}catch{}try{window.document.cookie=encodeURIComponent(y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function A(N){var B=N;if(typeof B=="string"&&f.levels[B.toUpperCase()]!==void 0&&(B=f.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=f.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+N)}f.name=m,f.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},f.methodFactory=b||h,f.getLevel=function(){return S??k??g},f.setLevel=function(N,B){return S=A(N),B!==!1&&C(S),u.call(f)},f.setDefaultLevel=function(N){k=A(N),P()||f.setLevel(N,!1)},f.resetLevel=function(){S=null,R(),u.call(f)},f.enableAll=function(N){f.setLevel(f.levels.TRACE,N)},f.disableAll=function(N){f.setLevel(f.levels.SILENT,N)},f.rebuild=function(){if(o!==f&&(g=A(o.getLevel())),u.call(f),o===f)for(var N in s)s[N].rebuild()},g=A(o?o.getLevel():"WARN");var D=P();D!=null&&(S=A(D)),u.call(f)}o=new p,o.getLogger=function(b){if(typeof b!="symbol"&&typeof b!="string"||b==="")throw new TypeError("You must supply a name when creating a logger.");var f=s[b];return f||(f=s[b]=new p(b,o.methodFactory)),f};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(Ks)),Ks.exports}var aa=ZS(),ll;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(ll||(ll={}));var _t;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(_t||(_t={}));let W=aa.getLogger("livekit");Object.values(_t).map(t=>aa.getLogger(t));W.setDefaultLevel(ll.info);function Zt(t){const e=aa.getLogger(t);return e.setDefaultLevel(W.getLevel()),e}const eT=aa.getLogger("lk-e2ee"),dr=7e3,tT=[0,300,2*2*300,3*3*300,4*4*300,dr,dr,dr,dr,dr];class nT{constructor(e){this._retryDelays=e!==void 0?[...e]:tT}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function iT(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function T(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Rh(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Rh=="function"?Rh(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var Ps={exports:{}},Ih;function rT(){if(Ih)return Ps.exports;Ih=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(y,C,P){return Function.prototype.apply.call(y,C,P)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:n=function(y){return Object.getOwnPropertyNames(y)};function i(S){console&&console.warn&&console.warn(S)}var r=Number.isNaN||function(y){return y!==y};function s(){s.init.call(this)}Ps.exports=s,Ps.exports.once=f,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(S){if(typeof S!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(S){if(typeof S!="number"||S<0||r(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");o=S}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function c(S){return S._maxListeners===void 0?s.defaultMaxListeners:S._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(y){for(var C=[],P=1;P<arguments.length;P++)C.push(arguments[P]);var R=y==="error",A=this._events;if(A!==void 0)R=R&&A.error===void 0;else if(!R)return!1;if(R){var D;if(C.length>0&&(D=C[0]),D instanceof Error)throw D;var N=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw N.context=D,N}var B=A[y];if(B===void 0)return!1;if(typeof B=="function")e(B,this,C);else for(var ie=B.length,De=v(B,ie),P=0;P<ie;++P)e(De[P],this,C);return!0};function l(S,y,C,P){var R,A,D;if(a(C),A=S._events,A===void 0?(A=S._events=Object.create(null),S._eventsCount=0):(A.newListener!==void 0&&(S.emit("newListener",y,C.listener?C.listener:C),A=S._events),D=A[y]),D===void 0)D=A[y]=C,++S._eventsCount;else if(typeof D=="function"?D=A[y]=P?[C,D]:[D,C]:P?D.unshift(C):D.push(C),R=c(S),R>0&&D.length>R&&!D.warned){D.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=S,N.type=y,N.count=D.length,i(N)}return S}s.prototype.addListener=function(y,C){return l(this,y,C,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(y,C){return l(this,y,C,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(S,y,C){var P={fired:!1,wrapFn:void 0,target:S,type:y,listener:C},R=u.bind(P);return R.listener=C,P.wrapFn=R,R}s.prototype.once=function(y,C){return a(C),this.on(y,d(this,y,C)),this},s.prototype.prependOnceListener=function(y,C){return a(C),this.prependListener(y,d(this,y,C)),this},s.prototype.removeListener=function(y,C){var P,R,A,D,N;if(a(C),R=this._events,R===void 0)return this;if(P=R[y],P===void 0)return this;if(P===C||P.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete R[y],R.removeListener&&this.emit("removeListener",y,P.listener||C));else if(typeof P!="function"){for(A=-1,D=P.length-1;D>=0;D--)if(P[D]===C||P[D].listener===C){N=P[D].listener,A=D;break}if(A<0)return this;A===0?P.shift():m(P,A),P.length===1&&(R[y]=P[0]),R.removeListener!==void 0&&this.emit("removeListener",y,N||C)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(y){var C,P,R;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[y]),this;if(arguments.length===0){var A=Object.keys(P),D;for(R=0;R<A.length;++R)D=A[R],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=P[y],typeof C=="function")this.removeListener(y,C);else if(C!==void 0)for(R=C.length-1;R>=0;R--)this.removeListener(y,C[R]);return this};function h(S,y,C){var P=S._events;if(P===void 0)return[];var R=P[y];return R===void 0?[]:typeof R=="function"?C?[R.listener||R]:[R]:C?b(R):v(R,R.length)}s.prototype.listeners=function(y){return h(this,y,!0)},s.prototype.rawListeners=function(y){return h(this,y,!1)},s.listenerCount=function(S,y){return typeof S.listenerCount=="function"?S.listenerCount(y):p.call(S,y)},s.prototype.listenerCount=p;function p(S){var y=this._events;if(y!==void 0){var C=y[S];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(S,y){for(var C=new Array(y),P=0;P<y;++P)C[P]=S[P];return C}function m(S,y){for(;y+1<S.length;y++)S[y]=S[y+1];S.pop()}function b(S){for(var y=new Array(S.length),C=0;C<y.length;++C)y[C]=S[C].listener||S[C];return y}function f(S,y){return new Promise(function(C,P){function R(D){S.removeListener(y,A),P(D)}function A(){typeof S.removeListener=="function"&&S.removeListener("error",R),C([].slice.call(arguments))}k(S,y,A,{once:!0}),y!=="error"&&g(S,R,{once:!0})})}function g(S,y,C){typeof S.on=="function"&&k(S,"error",y,C)}function k(S,y,C,P){if(typeof S.on=="function")P.once?S.once(y,C):S.on(y,C);else if(typeof S.addEventListener=="function")S.addEventListener(y,function R(A){P.once&&S.removeEventListener(y,R),C(A)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S)}return Ps.exports}var Ft=rT();let Cg=!0,wg=!0;function Gs(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function oi(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function sT(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Cg=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function oT(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(wg=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Eg(){if(typeof window=="object"){if(Cg)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ju(t,e){wg&&console.warn(t+" is deprecated, please use "+e+" instead.")}function aT(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=Gs(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=Gs(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Gs(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function xh(t){return Object.prototype.toString.call(t)==="[object Object]"}function Pg(t){return xh(t)?Object.keys(t).reduce(function(e,n){const i=xh(t[n]),r=i?Pg(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function ul(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?ul(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{ul(t,t.get(r),n)})}))}function Oh(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&ul(t,a,r)})}),r}const Dh=Eg;function _g(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,p){return h?h+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(v=>v.kind==="videoinput");let p=h.find(v=>d.some(m=>v.label.toLowerCase().includes(m)));return!p&&h.length&&d.includes("back")&&(p=h[h.length-1]),p&&(a.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),Dh("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return Dh("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function Rg(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Ig(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else oi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function xg(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Og(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>Oh(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),oi(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>Oh(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Dg(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function Mg(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Dg(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[d.id];if(v)v.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new t.MediaStream([u]);this._streams[d.id]=m,this._reverseStreams[m.id]=d,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const p=l._reverseStreams[h],v=l._streams[p.id];d=d.replace(new RegExp(v.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const p=l._reverseStreams[h],v=l._streams[p.id];d=d.replace(new RegExp(p.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const m=s(this,v);h[0].apply(null,[m])},v=>{h[1]&&h[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>s(this,v))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>u.track===m)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function dl(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function Ng(t,e){oi(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Mh=Object.freeze({__proto__:null,fixNegotiationNeeded:Ng,shimAddTrackRemoveTrack:Mg,shimAddTrackRemoveTrackWithNative:Dg,shimGetSendersWithDtmf:xg,shimGetUserMedia:_g,shimMediaStream:Rg,shimOnTrack:Ig,shimPeerConnection:dl,shimSenderReceiverGetStats:Og});function Lg(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){ju("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function cT(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function Ag(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function hl(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function Ug(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Fg(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),oi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function jg(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){ju("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function Bg(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Vg(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function zg(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function $g(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Wg(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Nh=Object.freeze({__proto__:null,shimAddTransceiver:Vg,shimCreateAnswer:Wg,shimCreateOffer:$g,shimGetDisplayMedia:cT,shimGetParameters:zg,shimGetUserMedia:Lg,shimOnTrack:Ag,shimPeerConnection:hl,shimRTCDataChannel:Bg,shimReceiverGetStats:Fg,shimRemoveStream:jg,shimSenderGetStats:Ug});function qg(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function Hg(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function Kg(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h};let a=function(c,l,u){const d=r.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function Gg(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(Qg(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function Qg(t){return t&&t.video!==void 0?Object.assign({},t,{video:Pg(t.video)}):t}function Jg(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(ju("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Yg(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xg(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Zg(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Lh=Object.freeze({__proto__:null,shimAudioContext:Zg,shimCallbacksAPI:Kg,shimConstraints:Qg,shimCreateOfferLegacy:Xg,shimGetUserMedia:Gg,shimLocalStreamsAPI:qg,shimRTCIceServerUrls:Jg,shimRemoteStreamsAPI:Hg,shimTrackEventTransceiver:Yg}),Va={exports:{}},Ah;function lT(){return Ah||(Ah=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(v=>parseInt(v,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),i.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&c&&i.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Va)),Va.exports}var ev=lT(),Ni=YS(ev),uT=Ck({__proto__:null,default:Ni},[ev]);function Qs(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=Ni.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,oi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function fl(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||oi(t,"icecandidate",e=>{if(e.candidate){const n=Ni.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Js(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Ni.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=Ni.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Ni.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function Ys(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},oi(t,"datachannel",i=>(e(i.channel,i.target),i))}function pl(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function ml(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Xs(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Zs(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var dT=Object.freeze({__proto__:null,removeExtmapAllowMixed:ml,shimAddIceCandidateNullOrEmpty:Xs,shimConnectionState:pl,shimMaxMessageSize:Js,shimParameterlessSetLocalDescription:Zs,shimRTCIceCandidate:Qs,shimRTCIceCandidateRelayProtocol:fl,shimSendThrowTypeError:Ys});function hT(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Eg,i=aT(t),r={browserDetails:i,commonShim:dT,extractVersion:Gs,disableLog:sT,disableWarnings:oT,sdp:uT};switch(i.browser){case"chrome":if(!Mh||!dl||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Mh,Xs(t,i),Zs(t),_g(t,i),Rg(t),dl(t,i),Ig(t),Mg(t,i),xg(t),Og(t),Ng(t,i),Qs(t),fl(t),pl(t),Js(t,i),Ys(t),ml(t,i);break;case"firefox":if(!Nh||!hl||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Nh,Xs(t,i),Zs(t),Lg(t,i),hl(t,i),Ag(t),jg(t),Ug(t),Fg(t),Bg(t),Vg(t),zg(t),$g(t),Wg(t),Qs(t),pl(t),Js(t,i),Ys(t);break;case"safari":if(!Lh||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Lh,Xs(t,i),Zs(t),Jg(t),Xg(t),Kg(t),qg(t),Hg(t),Yg(t),Gg(t),Zg(t),Qs(t),fl(t),Js(t,i),Ys(t),ml(t,i);break;default:n("Unsupported browser!");break}return r}hT({window:typeof window>"u"?void 0:window});const fT=10,_s="lk_e2ee",pT="LKFrameEncryptionKey",mT={sharedKey:!1,ratchetSalt:pT,ratchetWindowSize:8,failureTolerance:fT,keyringSize:16};var Pn;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Pn||(Pn={}));var Uh;(function(t){t.KeyRatcheted="keyRatcheted"})(Uh||(Uh={}));var vn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(vn||(vn={}));var Fh;(function(t){t.Error="cryptorError"})(Fh||(Fh={}));function gT(){return vT()||gl()}function gl(){return typeof window.RTCRtpScriptTransform<"u"}function vT(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class _w extends Ft.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i)=>{W.debug("key ratcheted event received",{material:n,keyIndex:i})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},mT),e),this.on(Pn.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Pn.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Pn.RatchetRequest,e,n)}}class Ln extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var q;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest"})(q||(q={}));class X extends Ln{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=q[n]}}class Bu extends Ln{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class qt extends Ln{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class yT extends Ln{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Te extends Ln{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class vl extends Ln{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class za extends Ln{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class jh extends Ln{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Fu[n]}}var Xr;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Xr||(Xr={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Xr||(Xr={}));var Bh;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(Bh||(Bh={}));var w;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(w||(w={}));var x;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage"})(x||(x={}));var L;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected"})(L||(L={}));var M;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate"})(M||(M={}));function kT(t){return typeof t>"u"?t:typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}const ST=/version\/(\d+(\.?_?\d+)+)/i;let $a;function Rt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if($a===void 0||e){const i=TT.find(r=>{let{test:s}=r;return s.test(n)});$a=i==null?void 0:i.describe(n)}return $a}const TT=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:eo(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Wa(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:eo(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Wa(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:eo(ST,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Wa(t)}}}];function eo(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Wa(t){return t.includes("mac os")?eo(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var bT="2.11.4";const CT=bT,wT=15;class Ie{}Ie.setTimeout=function(){return setTimeout(...arguments)};Ie.setInterval=function(){return setInterval(...arguments)};Ie.clearTimeout=function(){return clearTimeout(...arguments)};Ie.clearInterval=function(){return clearInterval(...arguments)};const ET=5e3,hr=[];var lt;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(lt||(lt={}));class _ extends Ft.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=_.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=W,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),ET):this.handleAppVisibilityChanged()},this.log=Zt((r=i.loggerName)!==null&&r!==void 0?r:_t.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=_.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Q(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===_.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===_.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(hr.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&hr.splice(hr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ei(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?M.AudioPlaybackStarted:M.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?M.AudioPlaybackFailed:M.VideoPlaybackFailed,s):s.name==="AbortError"?W.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):W.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(M.ElementAttached,e),e}detach(e){try{if(e){Li(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(M.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Li(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(M.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Zt(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),hr.forEach(i=>{i.parentElement||(n=!1)}),n&&hr.push(e)}}handleAppVisibilityChanged(){return T(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===_.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Ke()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Ke()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ei(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!On()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(On()||Ki())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Li(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return Tt.AUDIO;case e.Video:return Tt.VIDEO;default:return Tt.DATA}}t.kindToProto=r;function s(l){switch(l){case Tt.AUDIO:return e.Audio;case Tt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return ke.CAMERA;case n.Microphone:return ke.MICROPHONE;case n.ScreenShare:return ke.SCREEN_SHARE;case n.ScreenShareAudio:return ke.SCREEN_SHARE_AUDIO;default:return ke.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case ke.CAMERA:return n.Camera;case ke.MICROPHONE:return n.Microphone;case ke.SCREEN_SHARE:return n.ScreenShare;case ke.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case ol.ACTIVE:return i.Active;case ol.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(_||(_={}));class Y{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const PT=["vp8","h264"],_T=["vp8","h264","vp9","av1"];function RT(t){return!!PT.find(e=>e===t)}var Vh;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Vh||(Vh={}));var yl;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(yl||(yl={}));const Zr={h90:new Y(160,90,9e4,20),h180:new Y(320,180,16e4,20),h216:new Y(384,216,18e4,20),h360:new Y(640,360,45e4,20),h540:new Y(960,540,8e5,25),h720:new Y(1280,720,17e5,30),h1080:new Y(1920,1080,3e6,30),h1440:new Y(2560,1440,5e6,30),h2160:new Y(3840,2160,8e6,30)},kl={h120:new Y(160,120,7e4,20),h180:new Y(240,180,125e3,20),h240:new Y(320,240,14e4,20),h360:new Y(480,360,33e4,20),h480:new Y(640,480,5e5,20),h540:new Y(720,540,6e5,25),h720:new Y(960,720,13e5,30),h1080:new Y(1440,1080,23e5,30),h1440:new Y(1920,1440,38e5,30)},Vu={h360fps3:new Y(640,360,2e5,3,"medium"),h360fps15:new Y(640,360,4e5,15,"medium"),h720fps5:new Y(1280,720,8e5,5,"medium"),h720fps15:new Y(1280,720,15e5,15,"medium"),h720fps30:new Y(1280,720,2e6,30,"medium"),h1080fps15:new Y(1920,1080,25e5,15,"medium"),h1080fps30:new Y(1920,1080,5e6,30,"medium"),original:new Y(0,0,7e6,30,"medium")},IT="|",zh="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function xT(t){const e=t.split(IT);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ye(t){return T(this,void 0,void 0,function*(){return new Promise(e=>Ie.setTimeout(e,t))})}function Sl(){return"addTransceiver"in RTCPeerConnection.prototype}function Tl(){return"addTrack"in RTCPeerConnection.prototype}function OT(){if(!("getCapabilities"in RTCRtpSender)||On())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function DT(){if(!("getCapabilities"in RTCRtpSender)||Ki())return!1;if(On()){const n=Rt();if(n!=null&&n.version&&ii(n.version,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function Or(t){return t==="av1"||t==="vp9"}function bl(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}function MT(){return typeof RTCPeerConnection>"u"?!1:Sl()||Tl()}function Ki(){var t;return((t=Rt())===null||t===void 0?void 0:t.name)==="Firefox"}function On(){var t;return((t=Rt())===null||t===void 0?void 0:t.name)==="Safari"}function NT(){const t=Rt();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")}function tv(){var t,e;return Ke()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function LT(){const t=Rt(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&ii(e,t.osVersion)>=0?!0:t.name==="Safari"&&ii(e,t.version)>=0}function Ke(){return typeof document<"u"}function Ut(){return navigator.product=="ReactNative"}function Cl(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function nv(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function iv(){if(!Ut())return;let t=nv();if(t)return t.platform}function $h(){if(Ke())return window.devicePixelRatio;if(Ut()){let t=nv();if(t)return t.devicePixelRatio}return 1}function ii(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function AT(t){for(const e of t)e.target.handleResize(e)}function UT(t){for(const e of t)e.target.handleVisibilityChanged(e)}let qa=null;const Wh=()=>(qa||(qa=new ResizeObserver(AT)),qa);let Ha=null;const qh=()=>(Ha||(Ha=new IntersectionObserver(UT,{root:null,rootMargin:"0px"})),Ha);function FT(){var t;const e=new _S({sdk:cg.JS,protocol:wT,version:CT});return Ut()&&(e.os=(t=iv())!==null&&t!==void 0?t:""),e}function Hh(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let fr;function Ka(){if(!fr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[fr]=i.stream.getAudioTracks(),!fr)throw Error("Could not get empty media stream audio track");fr.enabled=!1}return fr.clone()}class rv{constructor(e,n){this.onFinally=n,this.promise=new Promise((i,r)=>T(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;return(i=this.onFinally)===null||i===void 0?void 0:i.call(this)})}}function jT(t){return _T.includes(t)}function _n(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function BT(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function wl(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function VT(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function zT(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Kh(t){switch(t.reason){case q.LeaveRequest:return t.context;case q.Cancelled:return Ct.CLIENT_INITIATED;case q.NotAllowed:return Ct.USER_REJECTED;case q.ServerUnreachable:return Ct.JOIN_FAILURE;default:return Ct.UNKNOWN_REASON}}function to(t){return t!==void 0?Number(t):void 0}function Vn(t){return t!==void 0?BigInt(t):void 0}function Ai(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function en(t){return!!t&&t.kind==_.Kind.Audio}function Zi(t){return!!t&&t.kind==_.Kind.Video}function an(t){return Ai(t)&&Zi(t)}function zn(t){return Ai(t)&&en(t)}function El(t){return!!t&&!t.isLocal}function $T(t){return!!t&&!t.isLocal}function Ga(t){return El(t)&&Zi(t)}function WT(t){return t.isLocal}function qT(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function sv(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=cv(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(Pl(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=c??u)),h.video&&(Pl(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=l??d)),h}function Pl(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function zu(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":Pl(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function ov(t){return T(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=av();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Ye(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function av(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>T(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)});window.document.body.addEventListener("click",i)}return n}}function HT(t){return t==="audioinput"?_.Source.Microphone:t==="videoinput"?_.Source.Camera:_.Source.Unknown}function Gh(t){return t===_.Source.Microphone?"audioinput":t===_.Source.Camera?"videoinput":void 0}function KT(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,On()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function no(t){return t.split("/")[1].toLowerCase()}function GT(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Au({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Q(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Q(t.track):{})}}function QT(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function JT(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function cv(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:kT(e)}}function YT(t){switch(t){case ke.CAMERA:return _.Source.Camera;case ke.MICROPHONE:return _.Source.Microphone;case ke.SCREEN_SHARE:return _.Source.ScreenShare;case ke.SCREEN_SHARE_AUDIO:return _.Source.ScreenShareAudio;default:return _.Source.Unknown}}class XT extends Ft.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var i,r;const{kind:s,data:o}=n.data;switch(s){case"error":W.error(o.error.message),this.emit(vn.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(vn.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(vn.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(Pn.KeyRatcheted,o.material,o.keyIndex);break}},this.onWorkerError=n=>{W.error("e2ee worker encountered an error:",{error:n.error}),this.emit(vn.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!gT())throw new Bu("tried to setup end-to-end encryption on an unsupported browser");if(W.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:eT.getLevel()}};this.worker&&(W.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){W.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?W.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(L.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(w.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Ze.NONE,r.identity)),e.on(w.ConnectionStateChanged,i=>{i===G.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Ze.NONE,r.identity)})})}).on(w.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(w.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(w.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(x.LocalTrackPublished,i=>T(this,void 0,void 0,function*(){this.setupE2EESender(i.track,i.track.sender)})),n.on(Pn.SetKey,i=>this.postKey(i)).on(Pn.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?no(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Ai(e)||!n){n||W.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return T(this,void 0,void 0,function*(){if(this.worker){if(gl()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(_s in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(a,[o,s])}e[_s]=!0}})}handleSender(e,n,i){var r;if(!(_s in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(gl()){W.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{W.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o,[s.readable,s.writable])}e[_s]=!0}}}const Qa="default";class Pe{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Pe),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Pe.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){W.debug("awaiting getUserMedia promise");try{n?yield Pe.userMediaPromiseMap.get(n):yield Promise.all(Pe.userMediaPromiseMap.values())}catch{W.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(On()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return T(this,void 0,void 0,function*(){if(n!==Qa)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===Qa);if(!s){W.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==Qa&&a.groupId===(i??s.groupId));if(!o){W.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Pe.userMediaPromiseMap.has(e):Pe.userMediaPromiseMap.size>0}}Pe.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Pe.userMediaPromiseMap=new Map;var Dr;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Dr||(Dr={}));class ZT{constructor(){this.pendingTasks=new Map,this.taskMutex=new He,this.nextTaskIndex=0}run(e){return T(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Dr.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Dr.RUNNING,yield e()}finally{n.status=Dr.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return T(this,void 0,void 0,function*(){return this.run(()=>T(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function eb(t,e){const n=new URL(BT(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),lv(n,"rtc")}function tb(t){const e=new URL(wl(t));return lv(e,"validate")}function nb(t){return t.endsWith("/")?t:"".concat(t,"/")}function lv(t,e){return t.pathname="".concat(nb(t.pathname)).concat(e),t.toString()}const ib=["syncState","trickle","offer","answer","simulate","leave"];function rb(t){const e=ib.indexOf(t.case)>=0;return W.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var te;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(te||(te={}));class $u{get currentState(){return this.state}get isDisconnected(){return this.state===te.DISCONNECTING||this.state===te.DISCONNECTED}get isEstablishingConnection(){return this.state===te.CONNECTING||this.state===te.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=te.DISCONNECTED,this.log=W,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Zt((i=n.loggerName)!==null&&i!==void 0?i:_t.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new ZT,this.queuedRequests=[],this.closingLock=new He,this.connectionLock=new He,this.state=te.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return T(this,void 0,void 0,function*(){return this.state=te.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return T(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=te.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const s=FT(),o=sb(n,s,i),a=eb(e,o),c=tb(a);return new Promise((l,u)=>T(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const h=()=>T(this,void 0,void 0,function*(){this.close(),clearTimeout(p),u(new X("room connection has been cancelled (signal)",q.Cancelled))}),p=setTimeout(()=>{this.close(),u(new X("room connection has timed out (signal)",q.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&h(),r==null||r.addEventListener("abort",h);const v=new URL(a);v.searchParams.has("access_token")&&v.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(v),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(p)},this.ws.onerror=m=>T(this,void 0,void 0,function*(){if(this.state!==te.CONNECTED){this.state=te.DISCONNECTED,clearTimeout(p);try{const b=yield fetch(c);if(b.status.toFixed(0).startsWith("4")){const f=yield b.text();u(new X(f,q.NotAllowed,b.status))}else u(new X("Encountered unknown websocket error during connection: ".concat(m.toString()),q.InternalError,b.status))}catch(b){u(new X(b instanceof Error?b.message:"server was not reachable",q.ServerUnreachable))}return}this.handleWSError(m)}),this.ws.onmessage=m=>T(this,void 0,void 0,function*(){var b,f,g;let k;if(typeof m.data=="string"){const S=JSON.parse(m.data);k=Ph.fromJson(S,{ignoreUnknownFields:!0})}else if(m.data instanceof ArrayBuffer)k=Ph.fromBinary(new Uint8Array(m.data));else{this.log.error("could not decode websocket message: ".concat(typeof m.data),this.logContext);return}if(this.state!==te.CONNECTED){let S=!1;if(((b=k.message)===null||b===void 0?void 0:b.case)==="join"?(this.state=te.CONNECTED,r==null||r.removeEventListener("abort",h),this.pingTimeoutDuration=k.message.value.pingTimeout,this.pingIntervalDuration=k.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(k.message.value)):this.state===te.RECONNECTING&&k.message.case!=="leave"?(this.state=te.CONNECTED,r==null||r.removeEventListener("abort",h),this.startPingInterval(),((f=k.message)===null||f===void 0?void 0:f.case)==="reconnect"?l(k.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),S=!0)):this.isEstablishingConnection&&k.message.case==="leave"?u(new X("Received leave request while trying to (re)connect",q.LeaveRequest,void 0,k.message.value.reason)):i.reconnect||u(new X("did not receive join response, got ".concat((g=k.message)===null||g===void 0?void 0:g.case," instead"),q.InternalError)),!S)return}this.signalLatency&&(yield Ye(this.signalLatency)),this.handleSignalResponse(k)}),this.ws.onclose=m=>{this.isEstablishingConnection&&u(new X("Websocket got closed during a (re)connection attempt",q.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:m.reason,code:m.code,wasClean:m.wasClean,state:this.state})),this.handleOnClose(m.reason)}}finally{d()}}))}close(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=te.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,Ye(250)])),e.ws=void 0}}finally{n&&(e.state=te.DISCONNECTED),i()}}()})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Mo(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Mo(e)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Nu({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Lu({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new gg({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new mg({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new kg({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ae.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new bg({timestamp:ae.parse(Date.now()),rtt:ae.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new pg({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new oa({reason:Ct.CLIENT_INITIATED,action:Mi.DISCONNECT})})}sendRequest(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!rb(n)&&i.state===te.RECONNECTING){i.queuedRequests.push(()=>T(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ye(i.signalLatency)),!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new xS({message:n});try{i.useJSON?i.ws.send(o.toJsonString()):i.ws.send(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=Qh(r.value);this.onAnswer&&this.onAnswer(o)}else if(r.case==="offer"){const o=Qh(r.value);this.onOffer&&this.onOffer(o)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return T(this,void 0,void 0,function*(){if(this.state===te.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Ie.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Ie.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Ie.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ie.clearInterval(this.pingInterval)}}function Qh(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Mo(t){return new ni({sdp:t.sdp,type:t.type})}function sb(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Ut()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}var mt={},Ja={},Ya={exports:{}},Jh;function Wu(){if(Jh)return Ya.exports;Jh=1;var t=Ya.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Ya.exports}var Yh;function ob(){return Yh||(Yh=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},i=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},r=Wu(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],p=d.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var v=0;v<(r[h]||[]).length;v+=1){var m=r[h][v];if(m.reg.test(p))return i(m,u,p)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(Ja)),Ja}var Xa,Xh;function ab(){if(Xh)return Xa;Xh=1;var t=Wu(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var d=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(c[a.name][h]):u.push(c[a.names[d]])}else u.push(c[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Xa=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,u=[];return c.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(p){u.push(i(d,h,p))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),l.forEach(function(h){t[h].forEach(function(p){p.name in d&&d[p.name]!=null?u.push(i(h,p,d)):p.push in d&&d[p.push]!=null&&d[p.push].forEach(function(v){u.push(i(h,p,v))})})})}),u.join(`\r
`)+`\r
`},Xa}var Zh;function cb(){if(Zh)return mt;Zh=1;var t=ob(),e=ab(),n=Wu();return mt.grammar=n,mt.write=e,mt.parse=t.parse,mt.parseParams=t.parseParams,mt.parseFmtpConfig=t.parseFmtpConfig,mt.parsePayloads=t.parsePayloads,mt.parseRemoteCandidates=t.parseRemoteCandidates,mt.parseImageAttributes=t.parseImageAttributes,mt.parseSimulcastStreamList=t.parseSimulcastStreamList,mt}var cn=cb();function qu(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var p=Date.now()-l;if(p+e>=c)return c-p}return e}var h=function(){var p=[].slice.call(arguments),v=this;return new Promise(function(m,b){var f=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var k=t.apply(v,p);a&&a(k),u.forEach(function(S){return(0,S.resolve)(k)}),u=[]}},d()),f){var g=t.apply(v,p);return a&&a(g),m(g)}u.push({resolve:m,reject:b})})};return h.cancel=function(p){s!==void 0&&clearTimeout(s),u.forEach(function(v){return(0,v.reject)(p)}),u=[]},h}const lb=.7,ub=20,Ui={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class ef extends Ft.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=W,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=qu(r=>T(this,void 0,void 0,function*(){this.emit(Ui.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),ub),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Zt((i=n.loggerName)!==null&&i!==void 0?i:_t.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return T(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){return T(this,void 0,void 0,function*(){var n;let i;if(e.type==="offer"){let{stereoMids:r,nackMids:s}=db(e);this.remoteStereoMids=r,this.remoteNackMids=s}else if(e.type==="answer"){const r=cn.parse((n=e.sdp)!==null&&n!==void 0?n:"");r.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(o=>{if(!o.transceiver||s.mid!=o.transceiver.mid)return!1;let a=0;if(s.rtp.some(l=>l.codec.toUpperCase()===o.codec.toUpperCase()?(a=l.payload,!0):!1),a===0)return!0;let c=!1;for(const l of s.fmtp)if(l.payload===a){l.config=l.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),o.maxbr>0&&(l.config+=";maxaveragebitrate=".concat(o.maxbr*1e3)),c=!0;break}return c||o.maxbr>0&&s.fmtp.push({payload:a,config:"maxaveragebitrate=".concat(o.maxbr*1e3)}),!0})}),i=cn.write(r)}yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(r=>{this.pc.addIceCandidate(r)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Ui.NegotiationComplete),e.sdp&&cn.parse(e.sdp).media.forEach(s=>{s.type==="video"&&this.emit(Ui.RTPVideoPayloadTypes,s.rtp)}))})}createAndSendOffer(e){return T(this,void 0,void 0,function*(){var n;if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const s=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&s)yield this._pc.setRemoteDescription(s);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const i=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:i.sdp},this.logContext));const r=cn.parse((n=i.sdp)!==null&&n!==void 0?n:"");r.media.forEach(s=>{nf(s),s.type==="audio"?tf(s,[],[]):s.type==="video"&&this.trackBitrates.some(o=>{if(!s.msid||!o.cid||!s.msid.includes(o.cid))return!1;let a=0;if(s.rtp.some(l=>l.codec.toUpperCase()===o.codec.toUpperCase()?(a=l.payload,!0):!1),a===0||(Or(o.codec)&&this.ensureVideoDDExtensionForSVC(s,r),o.codec!=="av1"))return!0;const c=Math.round(o.maxbr*lb);for(const l of s.fmtp)if(l.payload===a){l.config.includes("x-google-start-bitrate")||(l.config+=";x-google-start-bitrate=".concat(c));break}return!0})}),yield this.setMungedSDP(i,cn.write(r)),this.onOffer(i)})}createAndSetAnswer(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=cn.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{nf(r),r.type==="audio"&&tf(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,cn.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Te("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Te("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return T(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return T(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new vl(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===zh))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:zh})}}}function tf(t,e,n){let i=0;t.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function db(t){var e;const n=[],i=[],r=cn.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(o.mid),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:i}}function nf(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const _l="vp8",hb={audioPreset:yl.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Vu.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:_l,backupCodec:!0},uv={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},dv={deviceId:{ideal:"default"},resolution:Zr.h720.resolution},fb={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new nT,disconnectOnPageLeave:!0,webAudioMix:!1},Hu={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var fe;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(fe||(fe={}));class pb{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Hu.peerConnectionTimeout,this.log=W,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=fe.CONNECTED:a.some(c=>c==="failed")?this.state=fe.FAILED:a.some(c=>c==="connecting")?this.state=fe.CONNECTING:a.every(c=>c==="closed")?this.state=fe.CLOSED:a.some(c=>c==="closed")?this.state=fe.CLOSING:a.every(c=>c==="new")&&(this.state=fe.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(fe[o]," to ").concat(fe[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Zt((r=i.loggerName)!==null&&r!==void 0?r:_t.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new ef(e,i),this.subscriber=new ef(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,bt.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,bt.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=s=>{var o;(o=this.onPublisherOffer)===null||o===void 0||o.call(this,s)},this.state=fe.NEW,this.connectionLock=new He,this.remoteOfferLock=new He}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return T(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return T(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return T(this,void 0,void 0,function*(){n===bt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return T(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return T(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return T(this,void 0,void 0,function*(){return new Promise((n,i)=>T(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Ui.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Ui.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===bt.PUBLISHER?this.publisher.getConnectedAddress():e===bt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>T(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Ie.clearTimeout(d),l(new X("room connection has been cancelled",q.Cancelled))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Ie.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),l(new X("could not establish pc connection",q.InternalError))},o);for(;this.state!==fe.CONNECTED;)if(yield Ye(50),r!=null&&r.signal.aborted){l(new X("room connection has been cancelled",q.Cancelled));return}Ie.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),c()}))}()})}}class ge extends Error{constructor(e,n,i){super(n),this.code=e,this.message=rf(n,ge.MAX_MESSAGE_BYTES),this.data=i?rf(i,ge.MAX_DATA_BYTES):void 0}static fromProto(e){return new ge(e.code,e.message,e.data)}toProto(){return new sg({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new ge(ge.ErrorCode[e],ge.ErrorMessage[e],n)}}ge.MAX_MESSAGE_BYTES=256;ge.MAX_DATA_BYTES=15360;ge.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};ge.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const hv=15360;function Ku(t){return new TextEncoder().encode(t).length}function rf(t,e){if(Ku(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const Gu=2e3;function ca(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const mb=1e3;class fv extends _{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=qu(()=>T(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>T(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(M.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new He,this.pauseUpstreamLock=new He,this.processorLock=new He,this.restartLock=new He,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==_.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return T(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Li(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){const s=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ei(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}finally{s()}}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Ei(r??e,s)}))})}waitForDimensions(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mb;return function*(){var i;if(e.kind===_.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=Rt())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ye(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield Ye(50)}throw new qt("unable to get track dimensions after timeout")}()})}setDeviceId(e){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===_n(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),_n(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===_.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===_.Kind.Audio?"audioinput":"videoinput";return n?Pe.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return T(this,void 0,void 0,function*(){if(!this.sender)throw new qt("unable to replace an unpublished track");let i,r;return typeof n=="boolean"?i=n:n!==void 0&&(i=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return T(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=iT(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===_.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{Li(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield c.applyConstraints(s),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(M.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?M.Muted:M.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),tv()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(M.UpstreamPaused,this);const i=Rt();if((i==null?void 0:i.name)==="Safari"&&ii(i.version,"12.0")<0)throw new Bu("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(M.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.processorLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.stopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Ei(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(Li(i._mediaStreamTrack,l),Ei(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(M.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(M.TrackProcessorUpdate))}()})}}class No extends fv{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,_.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=ca(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(M.AudioTrackFeatureUpdate,this,Mt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(M.AudioTrackFeatureUpdate,this,Mt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===_.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==_n(this._constraints.deviceId);return this.source===_.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return T(this,void 0,void 0,function*(){let n;if(e){const i=zu({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return T(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){Ke()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Gu)))}setProcessor(e){return T(this,void 0,void 0,function*(){var n;const i=yield this.processorLock.lock();try{if(!Ut()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(M.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return T(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return T(this,void 0,void 0,function*(){const e=yield ov(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(M.AudioSilenceDetected)),e})}}function gb(t,e,n){switch(t.kind){case"audio":return new No(t,e,!1,void 0,n);case"video":return new Ao(t,e,!1,n);default:throw new qt("unsupported track type: ".concat(t.kind))}}const vb=Object.values(Zr),yb=Object.values(kl),kb=Object.values(Vu),Sb=[Zr.h180,Zr.h360],Tb=[kl.h180,kl.h360],bb=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new Y(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),Rl=["q","h","f"];function Il(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=wb(t,e,n,l),W.debug("using video encoding",o));const u=o.maxFramerate,d=new Y(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Or(l)){const v=new Lo(c),m=[];if(v.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const b=Rt();if(On()||Ut()||(b==null?void 0:b.name)==="Chrome"&&ii(b==null?void 0:b.version,"113")<0){const f=v.suffix=="h"?2:3;for(let g=0;g<v.spatial;g+=1)m.push({rid:Rl[2-g],maxBitrate:o.maxBitrate/Math.pow(f,g),maxFramerate:d.encoding.maxFramerate});m[0].scalabilityMode=c}else m.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(m[0].priority=d.encoding.priority,m[0].networkPriority=d.encoding.priority),W.debug("using svc encoding",{encodings:m}),m}if(!a)return[o];let h=[];t?h=(r=of(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:sf(t,d):h=(s=of(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:sf(t,d);let p;if(h.length>0){const v=h[0];h.length>1&&([,p]=h);const m=Math.max(e,n);if(m>=960&&p)return Za(e,n,[v,p,d],u);if(m>=480)return Za(e,n,[v,d],u)}return Za(e,n,[d])}function Cb(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&W.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===_.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Il(t.source===_.Source.ScreenShare,c,l,n)}function wb(t,e,n,i){const r=Eb(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function Eb(t,e,n){if(t)return kb;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?vb:yb}function sf(t,e){if(t)return bb(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?Sb:Tb}function Za(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=Rl.length)return;const a=Math.min(t,e),l={rid:Rl[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const d=Ki()||o===0;s.encoding.priority&&d&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),Ut()&&iv()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,W.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),W.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function of(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class Lo{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function Pb(t){return t.source===_.Source.ScreenShare||t.constraints.height&&_n(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const _b=5e3;class Ao extends fv{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,_.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}const o=new Map(s.map(a=>[a.rid,a]));if(this.prevStats){let a=0;o.forEach((c,l)=>{var u;const d=(u=this.prevStats)===null||u===void 0?void 0:u.get(l);a+=ca(c,d)}),this._currentBitrate=a}this.prevStats=o}),this.senderLock=new He}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Ke())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Gu))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return T(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=fn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return T(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=fn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===_.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===_.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return T(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=lt.LOW;i<=lt.HIGH;i+=1)n.push(new Uu({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(n)}restartTrack(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=zu({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a);try{for(var c=!0,l=fn(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){s=u.value,c=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return T(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,p=fn(r.simulcastCodecs.values()),v;v=yield p.next(),o=v.done,!o;h=!0)l=v.value,h=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(m){a={error:m}}finally{try{!h&&!o&&(c=p.return)&&(yield c.call(p))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return T(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},_b))}setPublishingCodecs(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=fn(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield af(d.sender,d.encodings,u.qualities,this.senderLock,this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e){return T(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield af(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),tv()&&this.isInBackground&&this.source===_.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function af(t,e,n,i,r,s){return T(this,void 0,void 0,function*(){const o=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:t,qualities:n,senderEncodings:e}));try{const a=t.getParameters(),{encodings:c}=a;if(!c)return;if(c.length!==e.length){r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:c,senderEncodings:e}));return}let l=!1;const u=Rt();if((u==null?void 0:u.name)==="Chrome"&&ii(u==null?void 0:u.version,"133")>0&&c[0].scalabilityMode){const h=c[0],p=new Lo(h.scalabilityMode);let v=Di.OFF;if(n.forEach(m=>{m.enabled&&(v===Di.OFF||m.quality>v)&&(v=m.quality)}),v===Di.OFF)h.active&&(h.active=!1,l=!0);else if(!h.active||p.spatial!==v+1){l=!0,h.active=!0;const m=new Lo(e[0].scalabilityMode);p.spatial=v+1,p.suffix=m.suffix,p.spatial===1&&(p.suffix=void 0),h.scalabilityMode=p.toString(),h.scaleResolutionDownBy=Math.pow(2,2-v),e[0].maxBitrate&&(h.maxBitrate=e[0].maxBitrate/(h.scaleResolutionDownBy*h.scaleResolutionDownBy))}}else c.forEach((h,p)=>{var v;let m=(v=h.rid)!==null&&v!==void 0?v:"";m===""&&(m="q");const b=pv(m),f=n.find(g=>g.quality===b);f&&h.active!==f.enabled&&(l=!0,h.active=f.enabled,r.debug("setting layer ".concat(f.quality," to ").concat(h.active?"enabled":"disabled"),s),Ki()&&(f.enabled?(h.scaleResolutionDownBy=e[p].scaleResolutionDownBy,h.maxBitrate=e[p].maxBitrate,h.maxFrameRate=e[p].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))});l&&(a.encodings=c,r.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:a.encodings})),yield t.setParameters(a))}finally{o()}})}function pv(t){switch(t){case"f":return lt.HIGH;case"h":return lt.MEDIUM;case"q":return lt.LOW;default:return lt.HIGH}}function cf(t,e,n,i){if(!n)return[new Qn({quality:lt.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new Lo(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new Qn({quality:Math.min(lt.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=pv((o=r.rid)!==null&&o!==void 0?o:"");return new Qn({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const lf="_lossy",uf="_reliable",Rb=2*1e3,ec="leave-reconnect";var gt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(gt||(gt={}));class Ib extends Ft.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Hu.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=gt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=W,this.handleDataChannel=i=>T(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===uf)s.reliableDCSub=o;else if(o.label===lf)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>T(this,void 0,void 0,function*(){var r,s;const o=yield this.dataProcessLock.lock();try{let a;if(i.data instanceof ArrayBuffer)a=i.data;else if(i.data instanceof Blob)a=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const c=ze.fromBinary(new Uint8Array(a));((r=c.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(L.ActiveSpeakersUpdate,c.value.value.speakers):(((s=c.value)===null||s===void 0?void 0:s.case)==="user"&&Ob(c,c.value.value),this.emit(L.DataPacketReceived,c))}finally{o()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?H.LOSSY:H.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(L.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===ec&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ie.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===gt.Connected&&i();const s=()=>{this.off(L.Disconnected,o),i()},o=()=>{this.off(L.Restarted,s),r()};this.once(L.Restarted,s),this.once(L.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(L.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===te.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ui.RR_SIGNAL_DISCONNECTED))},this.log=Zt((n=e.loggerName)!==null&&n!==void 0?n:_t.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new $u(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new He,this.dataProcessLock=new He,this.dcBufferStatus=new Map([[H.LOSSY,!0],[H.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(L.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(L.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(L.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(L.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(L.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(L.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(L.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(L.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o,a,c;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:(c=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.participant)===null||c===void 0?void 0:c.sid}}join(e,n,i,r){return T(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,setTimeout(()=>{this.emit(L.SignalConnected)},10),s}catch(s){if(s instanceof X&&s.reason===q.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return T(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(L.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return T(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return T(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new qt("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new X("publication of local track timed out, no response from server",q.InternalError))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return T(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return T(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==fe.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new pb(r,e.subscriberPrimary,this.loggerOptions),this.emit(L.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=s=>{this.client.sendOffer(s)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>T(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===fe.CONNECTED){const u=this.pcState===gt.New;this.pcState=gt.Connected,u&&this.emit(L.Connected,e)}else s===fe.FAILED&&this.pcState===gt.Connected&&(this.pcState=gt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?ui.RR_SUBSCRIBER_FAILED:ui.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===te.RECONNECTING,l=[fe.FAILED,fe.CLOSING,fe.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(L.Offline)}),this.pcManager.onTrack=s=>{this.emit(L.MediaTrackAdded,s.track,s.streams[0],s.receiver)},xb((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>T(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=e=>T(this,void 0,void 0,function*(){if(!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(L.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(L.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(L.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(L.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",ui.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Mi.DISCONNECT:this.emit(L.Disconnected,e==null?void 0:e.reason),this.close();break;case Mi.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(ec);break;case Mi.RESUME:this.handleDisconnect(ec)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Jr.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(lf,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(uf,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return T(this,void 0,void 0,function*(){if(Sl())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Tl())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Te("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return T(this,void 0,void 0,function*(){if(Sl())return this.createSimulcastTransceiverSender(e,n,i,r);if(Tl())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Te("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new Te("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Zi(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new Te("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new Te("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return T(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){W.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Jr.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:fe.NEW)===fe.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Te?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof di||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",ui.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(L.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return T(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Te("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(L.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new di;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof X&&o.reason===q.NotAllowed?new Te("could not reconnect, token might be expired"):new di}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(L.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==te.CONNECTED)throw new di("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(L.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return T(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Te("could not reconnect, url or token not saved");if(!this.pcManager)throw new Te("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(L.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof X&&r.reason===q.NotAllowed?new Te("could not reconnect, token might be expired"):r instanceof X&&r.reason===q.LeaveRequest?r:new di(s)}if(this.emit(L.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==te.CONNECTED)throw new di("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(L.Resumed)})}waitForPCInitialConnection(e,n){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new Te("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return T(this,void 0,void 0,function*(){this.pcState=gt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ye(Rb),!this.pcManager)throw new Te("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=gt.Connected}catch(e){throw this.pcState=gt.Disconnected,new X("could not establish PC connection, ".concat(e.message),q.InternalError)}})}publishRpcResponse(e,n,i,r){return T(this,void 0,void 0,function*(){const s=new ze({destinationIdentities:[e],kind:H.RELIABLE,value:{case:"rpcResponse",value:new rg({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,H.RELIABLE)})}publishRpcAck(e,n){return T(this,void 0,void 0,function*(){const i=new ze({destinationIdentities:[e],kind:H.RELIABLE,value:{case:"rpcAck",value:new ig({requestId:n})}});yield this.sendDataPacket(i,H.RELIABLE)})}sendDataPacket(e,n){return T(this,void 0,void 0,function*(){const i=e.toBinary();yield this.ensurePublisherConnected(n);const r=this.dataChannelForKind(n);r&&r.send(i),this.updateAndEmitDCBufferStatus(n)})}waitForBufferStatusLow(e){return new Promise((n,i)=>T(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(L.Closing,r);!this.dcBufferStatus.get(e);)yield Ye(10);this.off(L.Closing,r),n()}}))}ensureDataTransportConnected(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Te("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw new X("".concat(a," connection not set"),q.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate();const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield Ye(50)}throw new X("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),q.InternalError)}()})}ensurePublisherConnected(e){return T(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==fe.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return T(this,void 0,void 0,function*(){return new Promise((e,n)=>T(this,void 0,void 0,function*(){if(!this.pcManager){n(new vl("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(L.Closing,r),this.pcManager.publisher.once(Ui.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();jT(c)&&o.set(a.payload,c)}),this.emit(L.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof vl&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ui.RR_UNKNOWN),n(s)}finally{this.off(L.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===H.LOSSY)return this.lossyDCSub;if(e===H.RELIABLE)return this.reliableDCSub}else{if(e===H.LOSSY)return this.lossyDC;if(e===H.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,c=new Array,l=new Array;e.forEach(u=>{u.isDesired!==a&&c.push(u.trackSid),u.isEnabled||l.push(u.trackSid)}),this.client.sendSyncState(new Sg({answer:s?Mo({sdp:s.sdp,type:s.type}):void 0,offer:o?Mo({sdp:o.sdp,type:o.type}):void 0,subscription:new sa({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:GT(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new Tg({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(H.LOSSY),bt.PUBLISHER),n(this.dataChannelForKind(H.RELIABLE),bt.PUBLISHER),n(this.dataChannelForKind(H.LOSSY,!0),bt.SUBSCRIBER),n(this.dataChannelForKind(H.RELIABLE,!0),bt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ie.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Ke()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Ke()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class di extends Error{}function xb(t){return t!==void 0&&t>13}function Ob(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class xl{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Cl(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return T(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),W.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return T(this,void 0,void 0,function*(){const n=yield fetch("".concat(Db(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new X("Could not fetch region settings: ".concat(n.statusText),n.status===401?q.NotAllowed:q.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function Db(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class mv{get info(){return this._info}constructor(e,n,i){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0}}class Mb extends mv{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>T(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:i.content})}catch{return{done:!0,value:void 0}}}),return(){return T(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return T(this,void 0,void 0,function*(){var e,n,i,r;let s=new Set;try{for(var o=!0,a=fn(this),c;c=yield a.next(),e=c.done,!e;o=!0){r=c.value,o=!1;const l=r;s.add(l)}}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return Array.from(s)})}}class Nb extends mv{constructor(e,n,i){super(e,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=to(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength;const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>T(this,void 0,void 0,function*(){try{const{done:i,value:r}=yield e.read();return i?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:n.decode(r.content)})}catch{return{done:!0,value:void 0}}}),return(){return T(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return T(this,void 0,void 0,function*(){var e,n,i,r;let s="";try{for(var o=!0,a=fn(this),c;c=yield a.next(),e=c.done,!e;o=!0)r=c.value,o=!1,s+=r}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return s})}}class gv{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return T(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class Lb extends gv{}class Ab extends gv{}class vv extends _{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?M.Muted:M.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(M.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Gu)),QT()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(M.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class yv extends vv{constructor(e,n,i,r,s,o){super(e,n,_.Kind.Audio,i,o),this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=ca(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;Ut()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Ut())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return T(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(bl(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&bl(e)&&e.setSinkId(this.sinkId),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(M.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(M.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const tc=100;class Ub extends vv{constructor(e,n,i,r,s){super(e,n,_.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=ca(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=qu(()=>{this.updateDimensions()},tc),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Li(this._mediaStreamTrack,n):Ei(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new Fb(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const i=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),r=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!r||s;if(this.lastVisible!==o){if(!o&&Date.now()-i<tc){Ie.setTimeout(()=>{this.updateVisibility()},tc);return}this.lastVisible=o,this.emit(M.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(M.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?$h():n||($h()>2?2:1)}}class Fb{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=pr(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=pr(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=pr(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Ol(e),this.isPiP=Ke()&&pr(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Ol(this.element),this.isPiP=pr(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,qh().observe(this.element),Wh().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=qh())===null||e===void 0||e.unobserve(this.element),(n=Wh())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function pr(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Ol(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Ol(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class $t extends Ft.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=Ze.NONE,this.log=W,this.handleMuted=()=>{this.emit(M.Muted)},this.handleUnmuted=()=>{this.emit(M.Unmuted)},this.log=Zt((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:_t.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=_.Source.Unknown}setTrack(e){this.track&&(this.track.off(M.Muted,this.handleMuted),this.track.off(M.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(M.Muted,this.handleMuted),e.on(M.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Q(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Ze.NONE}get audioTrack(){if(en(this.track))return this.track}get videoTrack(){if(Zi(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=_.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===_.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})($t||($t={}));class Dl extends $t{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(M.Ended)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&this.track.off(M.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(M.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return T(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return T(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return T(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return T(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(en(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Mt.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Mt.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Mt.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Mt.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Mt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Mt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function la(t,e){return T(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=cv(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),(s.video===!0||typeof s.video=="object"&&!s.video.deviceId)&&(s.video={deviceId:"default"});const c=sv(s,uv,dv),l=zu(c),u=navigator.mediaDevices.getUserMedia(l);s.audio&&(Pe.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Pe.userMediaPromiseMap.delete("audioinput"))),s.video&&(Pe.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Pe.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>T(this,void 0,void 0,function*(){const p=h.kind==="audio";let v=p?c.audio:c.video;(typeof v=="boolean"||!v)&&(v={});let m;const b=p?l.audio:l.video;typeof b!="boolean"&&(m=b);const f=h.getSettings().deviceId;m!=null&&m.deviceId&&_n(m.deviceId)!==f?m.deviceId=f:m||(m={deviceId:f});const g=gb(h,m,e);return g.kind===_.Kind.Video?g.source=_.Source.Camera:g.kind===_.Kind.Audio&&(g.source=_.Source.Microphone),g.mediaStream=d,en(g)&&i?yield g.setProcessor(i):Zi(g)&&r&&(yield g.setProcessor(r)),g})))}catch(d){if(!n)throw d;return la(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function jb(t){return T(this,void 0,void 0,function*(){return(yield la({audio:!1,video:!0}))[0]})}function Bb(t){return T(this,void 0,void 0,function*(){return(yield la({audio:!0,video:!1}))[0]})}var pn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(pn||(pn={}));function Vb(t){switch(t){case kr.EXCELLENT:return pn.Excellent;case kr.GOOD:return pn.Good;case kr.POOR:return pn.Poor;case kr.LOST:return pn.Lost;default:return pn.Unknown}}class kv extends Ft.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Do.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Do.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=pn.Unknown,this.log=W,this.log=Zt((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:_t.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(_.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(_.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(_.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(x.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(x.ParticipantNameChanged,e)}_setAttributes(e){const n=JT(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(x.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(x.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(x.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=Vb(e),n!==this._connectionQuality&&this.emit(x.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>en(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(M.Muted,()=>{this.emit(x.TrackMuted,e)}),e.on(M.Unmuted,()=>{this.emit(x.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case _.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case _.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function zb(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new yg({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}const df=15e3;class $b extends kv{constructor(e,n,i,r,s){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Ze.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new rv)},this.handleReconnected=()=>{var o,a;(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||a===void 0||a.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,a;this.reconnectFuture&&(this.reconnectFuture.promise.catch(c=>this.log.warn(c.message,this.logContext)),(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||a===void 0||a.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=o=>{const{requestId:a,reason:c,message:l}=o,u=this.pendingSignalRequests.get(a);u&&(c!==Fu.OK&&u.reject(new jh(l,c)),this.pendingSignalRequests.delete(a))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let a=o.value.value,c=null,l=null;a.value.case==="payload"?c=a.value.value:a.value.case==="error"&&(l=ge.fromProto(a.value.value)),this.handleIncomingRpcResponse(a.requestId,c,l);break;case"rpcAck":let u=o.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>zb(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,a)=>{if(a===void 0&&(a=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Q(o)));return}this.engine.updateMuteStatus(o.sid,a)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Q(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Q(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const a=this.audioTrackPublications.get(o.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.handleSubscribedQualityUpdate=o=>T(this,void 0,void 0,function*(){var a,c,l,u,d,h;if(!(!((d=this.roomOptions)===null||d===void 0)&&d.dynacast))return;const p=this.videoTrackPublications.get(o.trackSid);if(!p){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(o.subscribedCodecs.length>0){if(!p.videoTrack)return;const f=yield p.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var v=!0,m=fn(f),b;b=yield m.next(),a=b.done,!a;v=!0){u=b.value,v=!1;const g=u;RT(g)&&(this.log.debug("publish ".concat(g," for ").concat(p.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Q(p))),yield this.publishAdditionalCodecForTrack(p.videoTrack,g,p.options))}}catch(g){c={error:g}}finally{try{!v&&!a&&(l=m.return)&&(yield l.call(m))}finally{if(c)throw c.error}}}else o.subscribedQualities.length>0&&(yield(h=p.videoTrack)===null||h===void 0?void 0:h.setPublishingLayers(o.subscribedQualities))}),this.handleLocalTrackUnpublished=o=>{const a=this.trackPublications.get(o.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=o=>T(this,void 0,void 0,function*(){if(o.source===_.Source.ScreenShare||o.source===_.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Q(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(zn(o)||an(o))try{if(Ke())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:o.source===_.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),Q(o))),a.onchange=()=>{a.state!=="denied"&&(o.isMuted||o.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Q(o))),zn(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Q(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Ze.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){this.engine=e,this.engine.on(L.RemoteMute,(n,i)=>{const r=this.trackPublications.get(n);!r||!r.track||(i?r.mute():r.unmute())}),this.engine.on(L.Connected,this.handleReconnected).on(L.SignalRestarted,this.handleReconnected).on(L.SignalResumed,this.handleReconnected).on(L.Restarting,this.handleReconnecting).on(L.Resuming,this.handleReconnecting).on(L.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(L.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(L.Disconnected,this.handleDisconnected).on(L.SignalRequestResponse,this.handleSignalRequestResponse).on(L.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return T(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>T(i,void 0,void 0,function*(){var l,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),p=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:v=>{c(v),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-p<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(v=>{let[m,b]=v;return this.attributes[m]===b||b===""&&!this.attributes[m]}))){this.pendingSignalRequests.delete(h),a();return}yield Ye(50)}c(new jh("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(_.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(_.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(_.Source.ScreenShare,e,n,i)}setPermissions(e){const n=this.permissions,i=super.setPermissions(e);return i&&n&&this.emit(x.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return T(this,void 0,void 0,function*(){this.encryptionType=e?Ze.GCM:Ze.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return T(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case _.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case _.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case _.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new qt(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(x.MediaDevicesError,l),this.pendingPublishing.delete(e),l}try{const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Q(d))),l.push(this.publishTrack(d,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===_.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(_.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return T(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(_.Source.Camera)||this.pendingPublishing.has(_.Source.Microphone))){this.pendingPublishing.add(_.Source.Camera),this.pendingPublishing.add(_.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(_.Source.Camera),this.pendingPublishing.delete(_.Source.Microphone)}}})}createTracks(e){return T(this,void 0,void 0,function*(){var n,i;e??(e={});const r=sv(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield la(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(en(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=_.Source.Microphone,this.emit(x.AudioStreamAcquired)),Zi(a)&&(this.cameraError=void 0,a.source=_.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return T(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Bu("getDisplayMedia not supported");e.resolution===void 0&&!NT()&&(e.resolution=Vu.h1080fps30.resolution);const n=KT(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new qt("no video track found");const s=new Ao(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=_.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(x.AudioStreamAcquired);const a=new No(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=_.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return T(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;zn(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Ai(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let f;switch(i.source){case _.Source.Microphone:f="audioinput";break;case _.Source.Camera:f="videoinput"}f&&s.activeDeviceMap.has(f)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(f)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new No(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Ao(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new qt("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(f=>{f.track&&f.track===i&&(h=f)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),Q(h))),h;const p="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,v=(c=r==null?void 0:r.forceStereo)!==null&&c!==void 0?c:p;v&&(r||(r={}),r.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),Q(i))),r.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=r.dtx)!==null&&l!==void 0||(r.dtx=!1),(u=r.red)!==null&&u!==void 0||(r.red=!1));const m=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r);!LT()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),m.simulcast=!1),m.source&&(i.source=m.source);const b=new Promise((f,g)=>T(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==te.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Q(i)}));const k=()=>T(this,void 0,void 0,function*(){try{const S=yield this.publish(i,m,v);f(S)}catch(S){g(S)}});setTimeout(()=>{this.engine.off(L.SignalConnected,k),g(new za("publishing rejected as engine not connected within timeout",408))},15e3),this.engine.once(L.SignalConnected,k),this.engine.on(L.Closing,()=>{this.engine.off(L.SignalConnected,k),g(new za("publishing rejected as engine closed",499))})}else try{const k=yield this.publish(i,m,v);f(k)}catch(k){g(k)}}catch(k){g(k)}}));s.pendingPublishPromises.set(i,b);try{return yield b}catch(f){throw f}finally{s.pendingPublishPromises.delete(i)}}()})}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Q(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>YT(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Q(e))),!1)}publish(e,n,i){return T(this,void 0,void 0,function*(){var r,s,o,a,c,l,u,d,h,p;if(!this.hasPermissionsToPublish(e))throw new za("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(y=>Ai(e)&&y.source===e.source)&&e.source!==_.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Q(e))),n.stopMicTrackOnMute&&en(e)&&(e.stopOnMute=!0),e.source===_.Source.ScreenShare&&Ki()&&(n.simulcast=!1),n.videoCodec==="av1"&&!OT()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!DT()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=_l),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(y=>n.videoCodec===no(y.mime))||(n.videoCodec=no(this.enabledPublishVideoCodecs[0].mime)));const m=n.videoCodec;e.on(M.Muted,this.onTrackMuted),e.on(M.Unmuted,this.onTrackUnmuted),e.on(M.Ended,this.handleTrackEnded),e.on(M.UpstreamPaused,this.onTrackUpstreamPaused),e.on(M.UpstreamResumed,this.onTrackUpstreamResumed),e.on(M.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const b=new cl({cid:e.mediaStreamTrack.id,name:n.name,type:_.kindToProto(e.kind),muted:e.isMuted,source:_.sourceToProto(e.source),disableDtx:!(!((r=n.dtx)!==null&&r!==void 0)||r),encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy});let f;if(e.kind===_.Kind.Video){let y={width:0,height:0};try{y=yield e.waitForDimensions()}catch{const P=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Zr.h720.resolution;y={width:P.width,height:P.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Q(e)),{dims:y}))}b.width=y.width,b.height=y.height,an(e)&&(Or(m)&&(e.source===_.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Q(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),b.simulcastCodecs=[new al({codec:m,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:_l}),n.backupCodec&&m!==n.backupCodec.codec&&b.encryption===Ze.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),b.simulcastCodecs.push(new al({codec:n.backupCodec.codec,cid:""})))),f=Il(e.source===_.Source.ScreenShare,b.width,b.height,n),b.layers=cf(b.width,b.height,f,Or(n.videoCodec))}else e.kind===_.Kind.Audio&&(f=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(p=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&p!==void 0?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new Te("cannot publish track when not connected");const g=()=>T(this,void 0,void 0,function*(){var y,C,P;if(!this.engine.pcManager)throw new Te("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,f),an(e)&&((y=n.degradationPreference)!==null&&y!==void 0||(n.degradationPreference=Pb(e)),e.setDegradationPreference(n.degradationPreference)),f)if(Ki()&&e.kind===_.Kind.Audio){let R;for(const A of this.engine.pcManager.publisher.getTransceivers())if(A.sender===e.sender){R=A;break}R&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:R,codec:"opus",maxbr:!((C=f[0])===null||C===void 0)&&C.maxBitrate?f[0].maxBitrate/1e3:0})}else e.codec&&Or(e.codec)&&(!((P=f[0])===null||P===void 0)&&P.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:b.cid,codec:e.codec,maxbr:f[0].maxBitrate/1e3});yield this.engine.negotiate()});let k;if(this.enabledPublishVideoCodecs.length>0)k=(yield Promise.all([this.engine.addTrack(b),g()]))[0];else{k=yield this.engine.addTrack(b);let y;if(k.codecs.forEach(C=>{y===void 0&&(y=C.mimeType)}),y&&e.kind===_.Kind.Video){const C=no(y);C!==m&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Q(e)),{codec:C})),n.videoCodec=C,f=Il(e.source===_.Source.ScreenShare,b.width,b.height,n))}yield g()}const S=new Dl(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return S.options=n,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:f,trackInfo:k})),an(e)?e.startMonitor(this.engine.client):zn(e)&&e.startMonitor(),this.addTrackPublication(S),this.emit(x.LocalTrackPublished,S),S})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return T(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Ze.NONE)return;let s;if(this.trackPublications.forEach(p=>{p.track&&p.track===e&&(s=p)}),!s)throw new qt("track is not published");if(!an(e))throw new qt("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=Cb(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Q(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new cl({cid:c.mediaStreamTrack.id,type:_.kindToProto(e.kind),muted:e.isMuted,source:_.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=cf(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Te("cannot publish track when not connected");const u=()=>T(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return T(this,void 0,void 0,function*(){var i,r;if(Ai(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Q(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?Q(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(M.Muted,this.onTrackMuted),e.off(M.Unmuted,this.onTrackUnmuted),e.off(M.Ended,this.handleTrackEnded),e.off(M.UpstreamPaused,this.onTrackUpstreamPaused),e.off(M.UpstreamResumed,this.onTrackUpstreamResumed),e.off(M.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<fe.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),an(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case _.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case _.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(x.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return T(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>T(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>T(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==_.Source.ScreenShare&&l.source!==_.Source.ScreenShareAudio&&(zn(l)||an(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?H.RELIABLE:H.LOSSY,o=r.destinationIdentities,a=r.topic,c=new ze({kind:s,value:{case:"user",value:new eg({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a})}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return T(this,void 0,void 0,function*(){const i=new ze({kind:H.RELIABLE,value:{case:"sipDtmf",value:new tg({code:e,digit:n})}});yield this.engine.sendDataPacket(i,H.RELIABLE)})}sendChatMessage(e,n){return T(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new ze({value:{case:"chatMessage",value:new tl(Object.assign(Object.assign({},i),{timestamp:ae.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,H.RELIABLE),this.emit(x.ChatMessage,i),i})}editChatMessage(e,n){return T(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new ze({value:{case:"chatMessage",value:new tl(Object.assign(Object.assign({},i),{timestamp:ae.parse(i.timestamp),editTimestamp:ae.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,H.RELIABLE),this.emit(x.ChatMessage,i),i})}sendText(e,n){return T(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(d,h)=>{var p;c[h]=d;const v=c.reduce((m,b)=>m+b,0);(p=n==null?void 0:n.onProgress)===null||p===void 0||p.call(n,v)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),l(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>T(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:p=>{l(p,h+1)}})})))),u.info})}streamText(e){return T(this,void 0,void 0,function*(){var n,i;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),s={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},o=new il({streamId:r,mimeType:s.mimeType,topic:s.topic,timestamp:Vn(s.timestamp),totalLength:Vn(e==null?void 0:e.totalSize),attributes:s.attributes,contentHeader:{case:"textHeader",value:new dg({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?nl.UPDATE:nl.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new ze({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,H.RELIABLE);let l=0;const u=this,d=new WritableStream({write(v){return T(this,void 0,void 0,function*(){for(const m of qT(v,df)){yield u.engine.waitForBufferStatusLow(H.RELIABLE);const b=new rl({content:m,streamId:r,chunkIndex:Vn(l)}),f=new ze({destinationIdentities:a,value:{case:"streamChunk",value:b}});yield u.engine.sendDataPacket(f,H.RELIABLE),l+=1}})},close(){return T(this,void 0,void 0,function*(){const v=new sl({streamId:r}),m=new ze({destinationIdentities:a,value:{case:"streamTrailer",value:v}});yield u.engine.sendDataPacket(m,H.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let h=()=>T(this,void 0,void 0,function*(){yield p.close()});u.engine.once(L.Closing,h);const p=new Lb(d,s,()=>this.engine.off(L.Closing,h));return p})}sendFile(e,n){return T(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return T(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,l={id:a,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown"},u=new il({totalLength:Vn((o=l.size)!==null&&o!==void 0?o:0),mimeType:l.mimeType,streamId:a,topic:l.topic,timestamp:Vn(Date.now()),contentHeader:{case:"byteHeader",value:new hg({name:l.name})}}),d=new ze({destinationIdentities:c,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(d,H.RELIABLE);let h=0;const p=new He,v=this.engine,m=this.log,b=new WritableStream({write(g){return T(this,void 0,void 0,function*(){const k=yield p.lock();let S=0;try{for(;S<g.byteLength;){const y=g.slice(S,S+df);yield v.waitForBufferStatusLow(H.RELIABLE);const C=new ze({destinationIdentities:c,value:{case:"streamChunk",value:new rl({content:y,streamId:a,chunkIndex:Vn(h)})}});yield v.sendDataPacket(C,H.RELIABLE),h+=1,S+=y.byteLength}}finally{k()}})},close(){return T(this,void 0,void 0,function*(){const g=new sl({streamId:a}),k=new ze({destinationIdentities:c,value:{case:"streamTrailer",value:g}});yield v.sendDataPacket(k,H.RELIABLE)})},abort(g){m.error("Sink error:",g)}});return new Ab(b,l)})}performRpc(e){return T(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=1e4}=n;return function*(){return new Promise((l,u)=>T(i,void 0,void 0,function*(){var d,h,p,v;if(Ku(o)>hv){u(ge.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(d=this.engine.latestJoinResponse)===null||d===void 0?void 0:d.serverInfo)===null||h===void 0)&&h.version&&ii((v=(p=this.engine.latestJoinResponse)===null||p===void 0?void 0:p.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){u(ge.builtIn("UNSUPPORTED_SERVER"));return}const m=crypto.randomUUID();yield this.publishRpcRequest(r,m,s,o,a-2e3);const b=setTimeout(()=>{this.pendingAcks.delete(m),u(ge.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(m),clearTimeout(f)},2e3);this.pendingAcks.set(m,{resolve:()=>{clearTimeout(b)},participantIdentity:r});const f=setTimeout(()=>{this.pendingResponses.delete(m),u(ge.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(m,{resolve:(g,k)=>{clearTimeout(f),this.pendingAcks.has(m)&&(console.warn("RPC response received before ack",m),this.pendingAcks.delete(m),clearTimeout(b)),k?u(k):l(g??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return T(this,void 0,void 0,function*(){const o=new ze({destinationIdentities:[e],kind:H.RELIABLE,value:{case:"rpcRequest",value:new ng({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,H.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,ge.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Q(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(zn(r)||an(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return T(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield Ye(20)}})}}class Sv extends $t{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=lt.HIGH,this.handleEnded=s=>{this.setTrack(void 0),this.emit(M.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.disabled=!s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensions=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new sa({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new og({participantSid:"",trackSids:[this.trackSid]})]});this.emit(M.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?$t.SubscriptionStatus.Unsubscribed:super.isSubscribed?$t.SubscriptionStatus.Subscribed:$t.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?$t.PermissionStatus.Allowed:$t.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.videoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Ga(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Ga(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(M.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(M.VisibilityChanged,this.handleVisibilityChange),r.off(M.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(M.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(M.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(M.VisibilityChanged,this.handleVisibilityChange),e.on(M.Ended,this.handleEnded),this.emit(M.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(M.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?M.Muted:M.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(M.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(M.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===_.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Ga(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new fg({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=lt.HIGH,this.emit(M.UpdateSettings,e)}}class Uo extends kv{static fromParticipantInfo(e,n,i){return new Uo(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Do.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(M.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),Q(e))),this.signalClient.sendUpdateTrackSettings(n)}),e.on(M.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(M.SubscriptionPermissionChanged,n=>{this.emit(x.TrackSubscriptionPermissionChanged,e,n)}),e.on(M.SubscriptionStatusChanged,n=>{this.emit(x.TrackSubscriptionStatusChanged,e,n)}),e.on(M.Subscribed,n=>{this.emit(x.TrackSubscribed,n,e)}),e.on(M.Unsubscribed,n=>{this.emit(x.TrackUnsubscribed,n,e)}),e.on(M.SubscriptionFailed,n=>{this.emit(x.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(x.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Q(a))),this.emit(x.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new Ub(e,n,r,s):l=new yv(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&El(l)&&en(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=_.kindFromProto(r.type);if(!c)return;a=new Sv(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==_.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Q(l),newTrack:Q(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Q(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(x.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case _.Kind.Audio:this.audioTrackPublications.delete(e);break;case _.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(x.TrackUnpublished,i)}setAudioOutput(e){return T(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;en(i.track)&&El(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var G;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(G||(G={}));const Wb=4*1e3;class Gi extends Ft.EventEmitter{constructor(e){var n,i,r,s;if(super(),n=this,this.state=G.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=W,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(o,a,c)=>T(this,void 0,void 0,function*(){var l;if(!MT())throw Ut()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===G.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(G.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Cl(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new xl(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(p=>{var v;(v=this.regionUrlProvider)===null||v===void 0||v.setServerReportedRegions(p)}).catch(p=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:p}))}));const d=(p,v,m)=>T(this,void 0,void 0,function*(){var b,f;this.abortController&&this.abortController.abort();const g=new AbortController;this.abortController=g,u==null||u();try{yield this.attemptConnection(m??o,a,c,g),this.abortController=void 0,p()}catch(k){if(this.regionUrlProvider&&k instanceof X&&k.reason!==q.Cancelled&&k.reason!==q.NotAllowed){let S=null;try{S=yield this.regionUrlProvider.getNextBestRegionUrl((b=this.abortController)===null||b===void 0?void 0:b.signal)}catch(y){if(y instanceof X&&(y.status===401||y.reason===q.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),v(y);return}}S&&!(!((f=this.abortController)===null||f===void 0)&&f.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(k.message,". Retrying with another region: ").concat(S),this.logContext),this.recreateEngine(),yield d(p,v,S)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Kh(k)),v(k))}else{let S=Ct.UNKNOWN_REASON;k instanceof X&&(S=Kh(k)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,S),v(k)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new rv((p,v)=>{d(p,v,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,d)=>T(this,void 0,void 0,function*(){var h,p,v;const m=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},d.signal);let b=m.serverInfo;if(b||(b={version:m.serverVersion,region:m.serverRegion}),this.serverInfo=b,this.log.debug("connected to Livekit Server ".concat(Object.entries(b).map(f=>{let[g,k]=f;return"".concat(g,": ").concat(k)}).join(", ")),{room:(h=m.room)===null||h===void 0?void 0:h.name,roomSid:(p=m.room)===null||p===void 0?void 0:p.sid,identity:(v=m.participant)===null||v===void 0?void 0:v.identity}),!b.version)throw new yT("unknown server version");return b.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),m}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>T(this,void 0,void 0,function*(){var u,d;this.state===G.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Hu),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(w.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const p=new X("could not establish signal connection",q.ServerUnreachable);throw h instanceof Error&&(p.message="".concat(p.message,": ").concat(h.message)),h instanceof X&&(p.reason=h.reason,p.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),p}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new X("Connection attempt aborted",q.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}Ke()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ke()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(G.Connected),this.emit(w.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return T(n,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,p,v;const m=yield l.disconnectLock.lock();try{if(l.state===G.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===G.Connecting||l.state===G.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(d=l.abortController)===null||d===void 0||d.abort(),(p=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||p===void 0||p.call(h,new X("Client initiated disconnect",q.Cancelled)),l.connectFuture=void 0),!((v=l.engine)===null||v===void 0)&&v.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(u,Ct.CLIENT_INITIATED),l.engine=void 0}finally{m()}}()})},this.onPageLeave=()=>T(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>T(this,void 0,void 0,function*(){const o=[],a=Rt();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=Ka();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(w.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>T(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(G.Reconnecting)&&this.emit(w.Reconnecting)},this.handleSignalRestarted=o=>T(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(G.Connected),this.emit(w.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===el.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(w.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(w.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=_.streamStateFromProto(a.state);u!==l.track.streamState&&(l.track.streamState=u,c.emit(x.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(w.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const a=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(a,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(a,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(a,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(a,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,a);else if(o.value.case==="streamHeader")this.handleStreamHeader(o.value.value,o.participantIdentity);else if(o.value.case==="streamChunk")this.handleStreamChunk(o.value.value);else if(o.value.case==="streamTrailer")this.handleStreamTrailer(o.value.value);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,c)=>{this.emit(w.DataReceived,a.payload,o,c,a.topic),o==null||o.emit(x.DataReceived,a.payload,c)},this.handleSipDtmf=(o,a)=>{this.emit(w.SipDTMFReceived,a,o),o==null||o.emit(x.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=VT(a,this.transcriptionReceivedTimes);l==null||l.emit(M.TranscriptionReceived,u),c==null||c.emit(x.TranscriptionReceived,u,l),this.emit(w.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=zT(a);this.emit(w.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(w.MetricsReceived,o,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(w.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(w.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(w.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(w.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>T(this,void 0,void 0,function*(){var o,a,c;const l=Pe.getInstance().previousDevices,u=yield Pe.getInstance().getDevices(void 0,!1),d=Rt();if((d==null?void 0:d.name)==="Chrome"&&d.os!=="iOS")for(let p of u){const v=l.find(m=>m.deviceId===p.deviceId);v&&v.label!==""&&v.kind===p.kind&&v.label!==p.label&&this.getActiveDevice(p.kind)==="default"&&this.emit(w.ActiveDeviceChanged,p.kind,p.deviceId)}const h=["audiooutput","audioinput","videoinput"];for(let p of h){const v=HT(p),m=this.localParticipant.getTrackPublication(v);if(m&&(!((o=m.track)===null||o===void 0)&&o.isUserProvided))continue;const b=u.filter(g=>g.kind===p),f=this.getActiveDevice(p);if(f===((a=l.filter(g=>g.kind===p)[0])===null||a===void 0?void 0:a.deviceId)&&b.length>0&&((c=b[0])===null||c===void 0?void 0:c.deviceId)!==f){yield this.switchActiveDevice(p,b[0].deviceId);continue}p==="audioinput"&&!On()||p==="videoinput"||b.length>0&&!b.find(g=>g.deviceId===this.getActiveDevice(p))&&(yield this.switchActiveDevice(p,b[0].deviceId))}this.emit(w.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(w.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(w.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(w.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(w.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(w.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(w.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(w.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>T(this,void 0,void 0,function*(){var a,c,l,u,d,h;(a=o.track)===null||a===void 0||a.on(M.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(M.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(w.LocalTrackPublished,o,this.localParticipant),zn(o.track)&&(yield o.track.checkForSilence())&&this.emit(w.LocalAudioSilenceDetected,o);const p=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),v=Gh(o.source);v&&p&&p!==this.localParticipant.activeDeviceMap.get(v)&&(this.localParticipant.activeDeviceMap.set(v,p),this.emit(w.ActiveDeviceChanged,v,p))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(M.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(M.Restarted,this.onLocalTrackRestarted),this.emit(w.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>T(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=Gh(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(w.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(w.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=o=>{this.emit(w.MediaDevicesError,o)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(w.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(w.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},fb),e),this.log=Zt((i=this.options.loggerName)!==null&&i!==void 0?i:_t.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},uv),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},dv),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},hb),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new He,this.localParticipant=new $b("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",_n(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",_n(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",_n(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),Ke()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Gi.cleanupRegistry&&Gi.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,i,r,s,o){return T(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,ge.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,ge.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});Ku(u)>hv?(c=ge.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=u}catch(u){u instanceof ge?c=u:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=ge.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}setE2EEEnabled(e){return T(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new XT(this.options.e2ee),this.e2eeManager.on(vn.ParticipantEncryptionStatusChanged,(n,i)=>{WT(i)&&(this.isE2EEEnabled=n),this.emit(w.ParticipantEncryptionStatusChanged,n,i)}),this.e2eeManager.on(vn.EncryptionError,n=>this.emit(w.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return T(this,void 0,void 0,function*(){return this.state===G.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(L.RoomUpdate,i),e(r.sid))};this.engine.on(L.RoomUpdate,i),this.once(w.Disconnected,()=>{this.engine.off(L.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Ib(this.options),this.engine.on(L.ParticipantUpdate,this.handleParticipantUpdates).on(L.RoomUpdate,this.handleRoomUpdate).on(L.SpeakersChanged,this.handleSpeakersChanged).on(L.StreamStateChanged,this.handleStreamStateUpdate).on(L.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(L.SubscriptionError,this.handleSubscriptionError).on(L.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(L.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(L.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(L.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(L.DataPacketReceived,this.handleDataPacket).on(L.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(G.SignalReconnecting)&&this.emit(w.SignalReconnecting)}).on(L.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(G.Connected)&&this.emit(w.Reconnected)}).on(L.SignalResumed,()=>{this.bufferedEvents=[],(this.state===G.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(L.Restarting,this.handleRestarting).on(L.SignalRestarted,this.handleSignalRestarted).on(L.Offline,()=>{this.setAndEmitConnectionState(G.Reconnecting)&&this.emit(w.Reconnecting)}).on(L.DCBufferStatusChanged,(e,n)=>{this.emit(w.DCBufferStatusChanged,e,n)}).on(L.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(x.LocalTrackSubscribed,n),this.emitWhenConnected(w.LocalTrackSubscribed,n,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Pe.getInstance().getDevices(e,n)}prepareConnection(e,n){return T(this,void 0,void 0,function*(){if(this.state===G.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Cl(new URL(e))&&n){this.regionUrlProvider=new xl(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===G.Disconnected&&(this.regionUrl=i,yield fetch(wl(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(wl(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return T(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new xt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new xt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new xt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new xt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new xt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new xt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new xt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>T(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new oa({reason:Ct.CLIENT_INITIATED,action:Mi.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new xt({scenario:{case:"subscriberBandwidth",value:Vn(n)}});break;case"leave-full-reconnect":r=new xt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,u,d,h,p,v;let m=!0,b=!1;const f=o?{exact:r}:r;if(i==="audioinput"){b=s.localParticipant.audioTrackPublications.size===0;const g=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=f;const k=Array.from(s.localParticipant.audioTrackPublications.values()).filter(S=>S.source===_.Source.Microphone);try{m=(yield Promise.all(k.map(S=>{var y;return(y=S.audioTrack)===null||y===void 0?void 0:y.setDeviceId(f)}))).every(S=>S===!0)}catch(S){throw s.options.audioCaptureDefaults.deviceId=g,S}}else if(i==="videoinput"){b=s.localParticipant.videoTrackPublications.size===0;const g=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=f;const k=Array.from(s.localParticipant.videoTrackPublications.values()).filter(S=>S.source===_.Source.Camera);try{m=(yield Promise.all(k.map(S=>{var y;return(y=S.videoTrack)===null||y===void 0?void 0:y.setDeviceId(f)}))).every(S=>S===!0)}catch(S){throw s.options.videoCaptureDefaults.deviceId=g,S}}else if(i==="audiooutput"){if(!bl()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(r=(l=yield Pe.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(u=(v=s.options).audioOutput)!==null&&u!==void 0||(v.audioOutput={});const g=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(k=>k.setAudioOutput({deviceId:r})))}catch(k){throw s.options.audioOutput.deviceId=g,k}}return(b||i==="audiooutput")&&(s.localParticipant.activeDeviceMap.set(i,i==="audiooutput"&&((p=s.options.audioOutput)===null||p===void 0?void 0:p.deviceId)||r),s.emit(w.ActiveDeviceChanged,i,r)),m}()})}setupLocalParticipantEvents(){this.localParticipant.on(x.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(x.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(x.AttributesChanged,this.onLocalAttributesChanged).on(x.TrackMuted,this.onLocalTrackMuted).on(x.TrackUnmuted,this.onLocalTrackUnmuted).on(x.LocalTrackPublished,this.onLocalTrackPublished).on(x.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(x.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(x.MediaDevicesError,this.onMediaDevicesError).on(x.AudioStreamAcquired,this.startAudio).on(x.ChatMessage,this.onLocalChatMessageSent).on(x.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===G.Connecting||this.state===G.Reconnecting){const u=()=>{this.onTrackAdded(e,n,i),d()},d=()=>{this.off(w.Reconnected,u),this.off(w.Connected,u),this.off(w.Disconnected,d)};this.once(w.Reconnected,u),this.once(w.Connected,u),this.once(w.Disconnected,d);return}if(this.state===G.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=xT(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(u=>u.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==G.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(x.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(x.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(x.AttributesChanged,this.onLocalAttributesChanged).off(x.TrackMuted,this.onLocalTrackMuted).off(x.TrackUnmuted,this.onLocalTrackUnmuted).off(x.LocalTrackPublished,this.onLocalTrackPublished).off(x.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(x.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(x.MediaDevicesError,this.onMediaDevicesError).off(x.AudioStreamAcquired,this.startAudio).off(x.ChatMessage,this.onLocalChatMessageSent).off(x.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ke()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(G.Disconnected),this.emit(w.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(w.ParticipantDisconnected,n),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return T(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:to(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.byteStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new Mb(o,a,to(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.textStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new Nb(o,a,to(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}acquireAudioContext(){return T(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=av())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ye(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(w.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Uo.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Uo(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(w.ParticipantConnected,i),i.on(x.TrackPublished,r=>{this.emitWhenConnected(w.TrackPublished,r,i)}).on(x.TrackSubscribed,(r,s)=>{r.kind===_.Kind.Audio?(r.on(M.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(M.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===_.Kind.Video&&(r.on(M.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(M.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(w.TrackSubscribed,r,s,i)}).on(x.TrackUnpublished,r=>{this.emit(w.TrackUnpublished,r,i)}).on(x.TrackUnsubscribed,(r,s)=>{this.emit(w.TrackUnsubscribed,r,s,i)}).on(x.TrackMuted,r=>{this.emitWhenConnected(w.TrackMuted,r,i)}).on(x.TrackUnmuted,r=>{this.emitWhenConnected(w.TrackUnmuted,r,i)}).on(x.ParticipantMetadataChanged,r=>{this.emitWhenConnected(w.ParticipantMetadataChanged,r,i)}).on(x.ParticipantNameChanged,r=>{this.emitWhenConnected(w.ParticipantNameChanged,r,i)}).on(x.AttributesChanged,r=>{this.emitWhenConnected(w.ParticipantAttributesChanged,r,i)}).on(x.ConnectionQualityChanged,r=>{this.emitWhenConnected(w.ConnectionQualityChanged,r,i)}).on(x.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(w.ParticipantPermissionsChanged,r,i)}).on(x.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(w.TrackSubscriptionStatusChanged,r,s,i)}).on(x.TrackSubscriptionFailed,(r,s)=>{this.emit(w.TrackSubscriptionFailed,r,i,s)}).on(x.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(w.TrackSubscriptionPermissionChanged,r,s,i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&$T(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ie.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ct.STATE_MISMATCH))):e=0},Wb)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ie.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(w.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===G.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===G.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return T(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Mu({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ae.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Yr({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(w.SignalConnected),this.emit(w.Connected),this.setAndEmitConnectionState(G.Connected),r.video){const o=new Dl(_.Kind.Video,new wi({source:ke.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Tt.AUDIO,name:"video-dummy"}),new Ao(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Hh(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(x.LocalTrackPublished,o)}if(r.audio){const o=new Dl(_.Kind.Audio,new wi({source:ke.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Tt.AUDIO}),new No(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Ka(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(x.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new Yr({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:el.ACTIVE,tracks:[],joinedAt:ae.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=Hh(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new wi({source:ke.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Tt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=Ka(),u=new wi({source:ke.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Tt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==w.ActiveSpeakersChanged&&e!==w.TranscriptionReceived){const s=Tv(i).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Gi.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Tv(t){return t.map(e=>{if(e)return Array.isArray(e)?Tv(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var kt;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(kt||(kt={}));class An extends Ft.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=kt.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Gi(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return T(this,void 0,void 0,function*(){if(this.status!==kt.IDLE)throw Error("check is running already");this.setStatus(kt.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==kt.SKIPPED&&this.setStatus(this.isSuccess()?kt.SUCCESS:kt.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return T(this,void 0,void 0,function*(){return this.room.state===G.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return T(this,void 0,void 0,function*(){this.room&&this.room.state!==G.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(kt.SKIPPED)}switchProtocol(e){return T(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(w.Reconnecting,()=>{n=!0}),this.room.once(w.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Ye(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class qb extends An{get description(){return"Cloud regions"}perform(){return T(this,void 0,void 0,function*(){const e=new xl(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return T(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let v=0;v<c;v++)yield s.write(l);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),p={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(v=>{v.type==="candidate-pair"&&v.nominated&&(p.rtt=v.currentRoundTripTime*1e3)}),yield this.disconnect(),p})}}const nc=1e4;class Hb extends An{get description(){return"Connection via UDP vs TCP"}perform(){return T(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(nc/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(nc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return T(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>T(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(p=>{p.type==="outbound-rtp"?(u.packetsSent=p.packetsSent,u.qualityLimitationDurations=p.qualityLimitationDurations,u.bitrateTotal+=p.targetBitrate,u.count++):p.type==="remote-inbound-rtp"&&(u.packetsLost=p.packetsLost,u.rttTotal+=p.roundTripTime,u.jitterTotal+=p.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,nc)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class Kb extends An{get description(){return"Can publish audio"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield Bb();if(yield ov(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class Gb extends An{get description(){return"Can publish video"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield jb();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return T(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=h;const p=l.getContext("2d");p.drawImage(i,0,0);const m=p.getImageData(0,0,l.width,l.height).data;let b=!0;for(let f=0;f<m.length;f+=4)if(m[f]!==0||m[f+1]!==0||m[f+2]!==0){b=!1;break}b?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),i.remove()})}}class Qb extends An{get description(){return"Resuming connection after interruption"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(w.SignalReconnecting,a).on(w.Reconnecting,a).on(w.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==G.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class Jb extends An{get description(){return"Can connect via TURN"}perform(){return T(this,void 0,void 0,function*(){var e,n;const i=new $u,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class Yb extends An{get description(){return"Establishing WebRTC connection"}perform(){return T(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(w.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const o=new RTCIceCandidate(r);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(Xb(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),W.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function Xb(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class Zb extends An{get description(){return"Connecting to signal connection via WebSocket"}perform(){return T(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new $u;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===ag.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class Rw extends Ft.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:kt.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==kt.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return T(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Zb)})}checkWebRTC(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Yb)})}checkTURN(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Jb)})}checkReconnect(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Qb)})}checkPublishAudio(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Kb)})}checkPublishVideo(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Gb)})}checkConnectionProtocol(){return T(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(Hb);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(qb)})}}var Rs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eC(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ml={exports:{}},tC=Ml.exports,hf;function nC(){return hf||(hf=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(tC,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(m,b){var f=m[b];if(typeof f.bind=="function")return f.bind(m);try{return Function.prototype.bind.call(f,m)}catch{return function(){return Function.prototype.apply.apply(f,[m,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(m){return m==="debug"&&(m="log"),typeof console===n?!1:m==="trace"&&i?c:console[m]!==void 0?a(console,m):console.log!==void 0?a(console,"log"):e}function u(){for(var m=this.getLevel(),b=0;b<r.length;b++){var f=r[b];this[f]=b<m?e:this.methodFactory(f,m,this.name)}if(this.log=this.debug,typeof console===n&&m<this.levels.SILENT)return"No console available for logging"}function d(m){return function(){typeof console!==n&&(u.call(this),this[m].apply(this,arguments))}}function h(m,b,f){return l(m)||d.apply(this,arguments)}function p(m,b){var f=this,g,k,S,y="loglevel";typeof m=="string"?y+=":"+m:typeof m=="symbol"&&(y=void 0);function C(N){var B=(r[N]||"silent").toUpperCase();if(!(typeof window===n||!y)){try{window.localStorage[y]=B;return}catch{}try{window.document.cookie=encodeURIComponent(y)+"="+B+";"}catch{}}}function P(){var N;if(!(typeof window===n||!y)){try{N=window.localStorage[y]}catch{}if(typeof N===n)try{var B=window.document.cookie,ie=encodeURIComponent(y),De=B.indexOf(ie+"=");De!==-1&&(N=/^([^;]+)/.exec(B.slice(De+ie.length+1))[1])}catch{}return f.levels[N]===void 0&&(N=void 0),N}}function R(){if(!(typeof window===n||!y)){try{window.localStorage.removeItem(y)}catch{}try{window.document.cookie=encodeURIComponent(y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function A(N){var B=N;if(typeof B=="string"&&f.levels[B.toUpperCase()]!==void 0&&(B=f.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=f.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+N)}f.name=m,f.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},f.methodFactory=b||h,f.getLevel=function(){return S??k??g},f.setLevel=function(N,B){return S=A(N),B!==!1&&C(S),u.call(f)},f.setDefaultLevel=function(N){k=A(N),P()||f.setLevel(N,!1)},f.resetLevel=function(){S=null,R(),u.call(f)},f.enableAll=function(N){f.setLevel(f.levels.TRACE,N)},f.disableAll=function(N){f.setLevel(f.levels.SILENT,N)},f.rebuild=function(){if(o!==f&&(g=A(o.getLevel())),u.call(f),o===f)for(var N in s)s[N].rebuild()},g=A(o?o.getLevel():"WARN");var D=P();D!=null&&(S=A(D)),u.call(f)}o=new p,o.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var b=s[m];return b||(b=s[m]=new p(m,o.methodFactory)),b};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(Ml)),Ml.exports}var iC=nC();const rC=eC(iC);var Nl=function(t,e){return Nl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},Nl(t,e)};function nn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Nl(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function sC(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,[])).next())})}function bv(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(i=1,r&&(s=l[0]&2?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],r=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Qi(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fo(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function jo(t,e,n){if(arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function Fi(t){return this instanceof Fi?(this.v=t,this):new Fi(t)}function oC(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(p){return function(v){return Promise.resolve(v).then(p,d)}}function a(p,v){i[p]&&(r[p]=function(m){return new Promise(function(b,f){s.push([p,m,b,f])>1||c(p,m)})},v&&(r[p]=v(r[p])))}function c(p,v){try{l(i[p](v))}catch(m){h(s[0][3],m)}}function l(p){p.value instanceof Fi?Promise.resolve(p.value.v).then(u,d):h(s[0][2],p)}function u(p){c("next",p)}function d(p){c("throw",p)}function h(p,v){p(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function aC(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Qi=="function"?Qi(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function we(t){return typeof t=="function"}function Qu(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var ic=Qu(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Bo(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var ss=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,r,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Qi(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(m){e={error:m}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(we(u))try{u()}catch(m){s=m instanceof ic?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=Qi(d),p=h.next();!p.done;p=h.next()){var v=p.value;try{ff(v)}catch(m){s=s??[],m instanceof ic?s=jo(jo([],Fo(s)),Fo(m.errors)):s.push(m)}}}catch(m){i={error:m}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}}if(s)throw new ic(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)ff(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Bo(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Bo(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),Cv=ss.EMPTY;function wv(t){return t instanceof ss||t&&"closed"in t&&we(t.remove)&&we(t.add)&&we(t.unsubscribe)}function ff(t){we(t)?t():t.unsubscribe()}var cC={Promise:void 0},lC={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,jo([t,e],Fo(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Ev(t){lC.setTimeout(function(){throw t})}function pf(){}function io(t){t()}var Ju=function(t){nn(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,wv(n)&&n.add(i)):i.destination=hC,i}return e.create=function(n,i,r){return new Ll(n,i,r)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ss),uC=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){Is(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){Is(i)}else Is(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Is(n)}},t}(),Ll=function(t){nn(e,t);function e(n,i,r){var s=t.call(this)||this,o;return we(n)||!n?o={next:n??void 0,error:i??void 0,complete:r??void 0}:o=n,s.destination=new uC(o),s}return e}(Ju);function Is(t){Ev(t)}function dC(t){throw t}var hC={closed:!0,next:pf,error:dC,complete:pf},Yu=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Pv(t){return t}function fC(t){return t.length===0?Pv:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var it=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var r=this,s=mC(e)?e:new Ll(e,n,i);return io(function(){var o=r,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=mf(n),new n(function(r,s){var o=new Ll({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});i.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Yu]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return fC(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=mf(e),new e(function(i,r){var s;n.subscribe(function(o){return s=o},function(o){return r(o)},function(){return i(s)})})},t.create=function(e){return new t(e)},t}();function mf(t){var e;return(e=t??cC.Promise)!==null&&e!==void 0?e:Promise}function pC(t){return t&&we(t.next)&&we(t.error)&&we(t.complete)}function mC(t){return t&&t instanceof Ju||pC(t)&&wv(t)}function gC(t){return we(t==null?void 0:t.lift)}function os(t){return function(e){if(gC(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Vo(t,e,n,i,r){return new vC(t,e,n,i,r)}var vC=function(t){nn(e,t);function e(n,i,r,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=i?function(l){try{i(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=r?function(){try{r()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Ju),yC=Qu(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),_v=function(t){nn(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new gf(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new yC},e.prototype.next=function(n){var i=this;io(function(){var r,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=Qi(i.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(r)throw r.error}}}})},e.prototype.error=function(n){var i=this;io(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var r=i.observers;r.length;)r.shift().error(n)}})},e.prototype.complete=function(){var n=this;io(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,r=this,s=r.hasError,o=r.isStopped,a=r.observers;return s||o?Cv:(this.currentObservers=null,a.push(n),new ss(function(){i.currentObservers=null,Bo(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,r=i.hasError,s=i.thrownError,o=i.isStopped;r?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new it;return n.source=this,n},e.create=function(n,i){return new gf(n,i)},e}(it),gf=function(t){nn(e,t);function e(n,i){var r=t.call(this)||this;return r.destination=n,r.source=i,r}return e.prototype.next=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,n)},e.prototype.error=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&r!==void 0?r:Cv},e}(_v);(function(t){nn(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,r=n.thrownError,s=n._value;if(i)throw r;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(_v);var kC={now:function(){return Date.now()}},SC=function(t){nn(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(ss),vf={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,jo([t,e],Fo(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},TC=function(t){nn(e,t);function e(n,i){var r=t.call(this,n,i)||this;return r.scheduler=n,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(n,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(n,i,r){return r===void 0&&(r=0),vf.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&vf.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var r=!1,s;try{this.work(n)}catch(o){r=!0,s=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,r=n.scheduler,s=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Bo(s,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(SC),yf=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=kC.now,t}(),bC=function(t){nn(e,t);function e(n,i){i===void 0&&(i=yf.now);var r=t.call(this,n,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,r){for(;n=i.shift();)n.unsubscribe();throw r}},e}(yf);new bC(TC);function CC(t){return t&&we(t.schedule)}function wC(t){return t[t.length-1]}function Rv(t){return CC(wC(t))?t.pop():void 0}var Iv=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function xv(t){return we(t==null?void 0:t.then)}function Ov(t){return we(t[Yu])}function Dv(t){return Symbol.asyncIterator&&we(t==null?void 0:t[Symbol.asyncIterator])}function Mv(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function EC(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Nv=EC();function Lv(t){return we(t==null?void 0:t[Nv])}function Av(t){return oC(this,arguments,function(){var e,n,i,r;return bv(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Fi(e.read())];case 3:return n=s.sent(),i=n.value,r=n.done,r?[4,Fi(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Fi(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Uv(t){return we(t==null?void 0:t.getReader)}function as(t){if(t instanceof it)return t;if(t!=null){if(Ov(t))return PC(t);if(Iv(t))return _C(t);if(xv(t))return RC(t);if(Dv(t))return Fv(t);if(Lv(t))return IC(t);if(Uv(t))return xC(t)}throw Mv(t)}function PC(t){return new it(function(e){var n=t[Yu]();if(we(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function _C(t){return new it(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function RC(t){return new it(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Ev)})}function IC(t){return new it(function(e){var n,i;try{for(var r=Qi(t),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()})}function Fv(t){return new it(function(e){OC(t,e).catch(function(n){return e.error(n)})})}function xC(t){return Fv(Av(t))}function OC(t,e){var n,i,r,s;return sC(this,void 0,void 0,function(){var o,a;return bv(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=aC(t),c.label=1;case 1:return[4,n.next()];case 2:if(i=c.sent(),!!i.done)return[3,4];if(o=i.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),r={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Jn(t,e,n,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var s=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function jv(t,e){return e===void 0&&(e=0),os(function(n,i){n.subscribe(Vo(i,function(r){return Jn(i,t,function(){return i.next(r)},e)},function(){return Jn(i,t,function(){return i.complete()},e)},function(r){return Jn(i,t,function(){return i.error(r)},e)}))})}function Bv(t,e){return e===void 0&&(e=0),os(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function DC(t,e){return as(t).pipe(Bv(e),jv(e))}function MC(t,e){return as(t).pipe(Bv(e),jv(e))}function NC(t,e){return new it(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function LC(t,e){return new it(function(n){var i;return Jn(n,e,function(){i=t[Nv](),Jn(n,e,function(){var r,s,o;try{r=i.next(),s=r.value,o=r.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return we(i==null?void 0:i.return)&&i.return()}})}function Vv(t,e){if(!t)throw new Error("Iterable cannot be null");return new it(function(n){Jn(n,e,function(){var i=t[Symbol.asyncIterator]();Jn(n,e,function(){i.next().then(function(r){r.done?n.complete():n.next(r.value)})},0,!0)})})}function AC(t,e){return Vv(Av(t),e)}function UC(t,e){if(t!=null){if(Ov(t))return DC(t,e);if(Iv(t))return NC(t,e);if(xv(t))return MC(t,e);if(Dv(t))return Vv(t,e);if(Lv(t))return LC(t,e);if(Uv(t))return AC(t,e)}throw Mv(t)}function FC(t,e){return e?UC(t,e):as(t)}Qu(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function ua(t,e){return os(function(n,i){var r=0;n.subscribe(Vo(i,function(s){i.next(t.call(e,s,r++))}))})}function jC(t,e,n,i,r,s,o,a){var c=[],l=0,u=0,d=!1,h=function(){d&&!c.length&&!l&&e.complete()},p=function(m){return l<i?v(m):c.push(m)},v=function(m){l++;var b=!1;as(n(m,u++)).subscribe(Vo(e,function(f){e.next(f)},function(){b=!0},void 0,function(){if(b)try{l--;for(var f=function(){var g=c.shift();o||v(g)};c.length&&l<i;)f();h()}catch(g){e.error(g)}}))};return t.subscribe(Vo(e,p,function(){d=!0,h()})),function(){}}function zv(t,e,n){return n===void 0&&(n=1/0),we(e)?zv(function(i,r){return ua(function(s,o){return e(i,s,r,o)})(as(t(i,r)))},n):(typeof e=="number"&&(n=e),os(function(i,r){return jC(i,r,t,n)}))}function BC(t){return zv(Pv,t)}function VC(){return BC(1)}function kf(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return VC()(FC(t,Rv(t)))}function da(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Rv(t);return os(function(i,r){(n?kf(t,i,n):kf(t,i)).subscribe(r)})}var zC="lk";function Xu(t){return typeof t>"u"?!1:$C(t)||WC(t)}function $C(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function WC(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function qC(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function HC(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(qC(t))return`${t.participant.identity}_${t.source}_placeholder`;if(Xu(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}var KC=[w.ConnectionStateChanged,w.RoomMetadataChanged,w.ActiveSpeakersChanged,w.ConnectionQualityChanged,w.ParticipantConnected,w.ParticipantDisconnected,w.ParticipantPermissionsChanged,w.ParticipantMetadataChanged,w.ParticipantNameChanged,w.ParticipantAttributesChanged,w.TrackMuted,w.TrackUnmuted,w.TrackPublished,w.TrackUnpublished,w.TrackStreamStateChanged,w.TrackSubscriptionFailed,w.TrackSubscriptionPermissionChanged,w.TrackSubscriptionStatusChanged],GC=[...KC,w.LocalTrackPublished,w.LocalTrackUnpublished];x.TrackPublished,x.TrackUnpublished,x.TrackMuted,x.TrackUnmuted,x.TrackStreamStateChanged,x.TrackSubscribed,x.TrackUnsubscribed,x.TrackSubscriptionPermissionChanged,x.TrackSubscriptionFailed,x.LocalTrackPublished,x.LocalTrackUnpublished;var QC=[x.ConnectionQualityChanged,x.IsSpeakingChanged,x.ParticipantMetadataChanged,x.ParticipantPermissionsChanged,x.TrackMuted,x.TrackUnmuted,x.TrackPublished,x.TrackUnpublished,x.TrackStreamStateChanged,x.TrackSubscriptionFailed,x.TrackSubscriptionPermissionChanged,x.TrackSubscriptionStatusChanged];[...QC,x.LocalTrackPublished,x.LocalTrackUnpublished];var Le=rC.getLogger("lk-components-js");Le.setDefaultLevel("WARN");function $v(t){return typeof t=="object"}function Wv(t){return Array.isArray(t)&&t.filter($v).length>0}function JC(t){return`${zC}-${t}`}function YC(t){const e=Al(t),n=qv(t.participant).pipe(ua(()=>Al(t)),da(e));return{className:JC(t.source===_.Source.Camera||t.source===_.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function Al(t){if(Xu(t))return t.publication;{const{source:e,name:n,participant:i}=t;if(e&&n)return i.getTrackPublications().find(r=>r.source===e&&r.trackName===n);if(n)return i.getTrackPublicationByName(n);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function XC(t,...e){return new it(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(da(t))}function ZC(t,...e){return new it(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(da(t))}function qv(t){return ZC(t,x.TrackMuted,x.TrackUnmuted,x.ParticipantPermissionsChanged,x.TrackPublished,x.TrackUnpublished,x.LocalTrackPublished,x.LocalTrackUnpublished,x.MediaDevicesError,x.TrackSubscriptionStatusChanged).pipe(ua(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:i,isScreenShareEnabled:r}=e,s=e.getTrackPublication(_.Source.Microphone),o=e.getTrackPublication(_.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:n,isScreenShareEnabled:r,cameraTrack:o,microphoneTrack:s,participant:e}}))}function ew(){return{className:"lk-room-container"}}function Sf(t,e,n=!0){const i=[t.localParticipant,...Array.from(t.remoteParticipants.values())],r=[];return i.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(c=>c.source===o&&(!n||c.track)).map(c=>({participant:s,publication:c,source:c.source}));r.push(...a)})}),{trackReferences:r,participants:i}}function tw(t,e,n){var i,r;const s=(i=n.additionalRoomEvents)!=null?i:GC,o=(r=n.onlySubscribed)!=null?r:!0,a=Array.from(new Set([w.ParticipantConnected,w.ParticipantDisconnected,w.ConnectionStateChanged,w.LocalTrackPublished,w.LocalTrackUnpublished,w.TrackPublished,w.TrackUnpublished,w.TrackSubscriptionStatusChanged,...s]).values());return XC(t,...a).pipe(ua(c=>{const l=Sf(c,e,o);return Le.debug(`TrackReference[] was updated. (length ${l.trackReferences.length})`,l),l}),da(Sf(t,e,o)))}F.createContext(void 0);const nw=F.createContext(void 0);function iw(){return F.useContext(nw)}function rw(t){const e=iw(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}F.createContext(void 0);const Zu=F.createContext(void 0);function sw(){const t=F.useContext(Zu);if(!t)throw Error("tried to access room context outside of livekit room component");return t}function ow(){return F.useContext(Zu)}function Hv(t){const e=ow(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}const aw=F.createContext(void 0);function Kv(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=Kv(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function cw(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=Kv(t))&&(i&&(i+=" "),i+=e);return i}function lw(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(i){console.error(i)}}}function Gv(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const i=t[n];for(const r in i){const s=e[r],o=i[r];typeof s=="function"&&typeof o=="function"&&r[0]==="o"&&r[1]==="n"&&r.charCodeAt(2)>=65&&r.charCodeAt(2)<=90?e[r]=lw(s,o):(r==="className"||r==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[r]=cw(s,o):e[r]=o!==void 0?o:s}}return e}function uw(t){return t!==void 0}function dw(...t){return Gv(...t.filter(uw))}function hw(t,e){return t==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:t==="e2ee"&&e?"e2ee-enabled":e}const fw={connect:!0,audio:!1,video:!1};function pw(t){const{token:e,serverUrl:n,options:i,room:r,connectOptions:s,connect:o,audio:a,video:c,screen:l,onConnected:u,onDisconnected:d,onError:h,onMediaDeviceFailure:p,onEncryptionError:v,simulateParticipants:m,...b}={...fw,...t};i&&r&&Le.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[f,g]=F.useState(),k=F.useRef(o);F.useEffect(()=>{g(r??new Gi(i))},[r,JSON.stringify(i,hw)]);const S=F.useMemo(()=>{const{className:y}=ew();return Gv(b,{className:y})},[b]);return F.useEffect(()=>{if(!f)return;const y=()=>{const D=f.localParticipant;Le.debug("trying to publish local tracks"),Promise.all([D.setMicrophoneEnabled(!!a,typeof a!="boolean"?a:void 0),D.setCameraEnabled(!!c,typeof c!="boolean"?c:void 0),D.setScreenShareEnabled(!!l,typeof l!="boolean"?l:void 0)]).catch(N=>{Le.warn(N),h==null||h(N)})},C=D=>{const N=Xr.getFailure(D);p==null||p(N)},P=D=>{v==null||v(D)},R=D=>{d==null||d(D)},A=()=>{u==null||u()};return f.on(w.SignalConnected,y).on(w.MediaDevicesError,C).on(w.EncryptionError,P).on(w.Disconnected,R).on(w.Connected,A),()=>{f.off(w.SignalConnected,y).off(w.MediaDevicesError,C).off(w.EncryptionError,P).off(w.Disconnected,R).off(w.Connected,A)}},[f,a,c,l,h,v,p,u,d]),F.useEffect(()=>{if(f){if(m){f.simulateParticipants({participants:{count:m},publish:{audio:!0,useRealTracks:!0}});return}if(o){if(k.current=!0,Le.debug("connecting"),!e){Le.debug("no token yet");return}if(!n){Le.warn("no livekit url provided"),h==null||h(Error("no livekit url provided"));return}f.connect(n,e,s).catch(y=>{Le.warn(y),k.current===!0&&(h==null||h(y))})}else Le.debug("disconnecting because connect is false"),k.current=!1,f.disconnect()}},[o,e,JSON.stringify(s),f,h,n,m]),F.useEffect(()=>{if(f)return()=>{Le.info("disconnecting on onmount"),f.disconnect()}},[f]),{room:f,htmlProps:S}}const mw=F.forwardRef(function(t,e){const{room:n,htmlProps:i}=pw(t);return F.createElement("div",{ref:e,...i},n&&F.createElement(Zu.Provider,{value:n},F.createElement(aw.Provider,{value:t.featureFlags},t.children)))});function gw(t={}){const e=Hv(t.room),[n,i]=F.useState(e.localParticipant),[r,s]=F.useState(n.isMicrophoneEnabled),[o,a]=F.useState(n.isMicrophoneEnabled),[c,l]=F.useState(n.lastMicrophoneError),[u,d]=F.useState(n.lastCameraError),[h,p]=F.useState(n.isMicrophoneEnabled),[v,m]=F.useState(void 0),[b,f]=F.useState(void 0),g=k=>{a(k.isCameraEnabled),s(k.isMicrophoneEnabled),p(k.isScreenShareEnabled),f(k.cameraTrack),m(k.microphoneTrack),l(k.participant.lastMicrophoneError),d(k.participant.lastCameraError),i(k.participant)};return F.useEffect(()=>{const k=qv(e.localParticipant).subscribe(g);return()=>k.unsubscribe()},[e]),{isMicrophoneEnabled:r,isScreenShareEnabled:h,isCameraEnabled:o,microphoneTrack:v,cameraTrack:b,lastMicrophoneError:c,lastCameraError:u,localParticipant:n}}function vw(t=[_.Source.Camera,_.Source.Microphone,_.Source.ScreenShare,_.Source.ScreenShareAudio,_.Source.Unknown],e={}){const n=Hv(e.room),[i,r]=F.useState([]),[s,o]=F.useState([]),a=F.useMemo(()=>t.map(c=>$v(c)?c.source:c),[JSON.stringify(t)]);return F.useEffect(()=>{const c=tw(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:l,participants:u})=>{Le.debug("setting track bundles",l,u),r(l),o(u)});return()=>c.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),F.useMemo(()=>{if(Wv(t)){const c=kw(t,s),l=Array.from(i);return s.forEach(u=>{c.has(u.identity)&&(c.get(u.identity)??[]).forEach(d=>{if(i.find(({participant:p,publication:v})=>u.identity===p.identity&&v.source===d))return;Le.debug(`Add ${d} placeholder for participant ${u.identity}.`);const h={participant:u,source:d};l.push(h)})}),l}else return i},[i,s,t])}function yw(t,e){const n=new Set(t);for(const i of e)n.delete(i);return n}function kw(t,e){const n=new Map;if(Wv(t)){const i=t.filter(r=>r.withPlaceholder).map(r=>r.source);e.forEach(r=>{const s=r.getTrackPublications().map(a=>{var c;return(c=a.track)==null?void 0:c.source}).filter(a=>a!==void 0),o=Array.from(yw(new Set(i),new Set(s)));o.length>0&&n.set(r.identity,o)})}return n}function Sw(t,e={}){const[n,i]=F.useState(Al(t)),[r,s]=F.useState(n==null?void 0:n.isMuted),[o,a]=F.useState(n==null?void 0:n.isSubscribed),[c,l]=F.useState(n==null?void 0:n.track),[u,d]=F.useState("landscape"),h=F.useRef(),{className:p,trackObserver:v}=F.useMemo(()=>YC(t),[t.participant.sid??t.participant.identity,t.source,Xu(t)&&t.publication.trackSid]);return F.useEffect(()=>{const m=v.subscribe(b=>{Le.debug("update track",b),i(b),s(b==null?void 0:b.isMuted),a(b==null?void 0:b.isSubscribed),l(b==null?void 0:b.track)});return()=>m==null?void 0:m.unsubscribe()},[v]),F.useEffect(()=>{var m,b;return c&&(h.current&&c.detach(h.current),(m=e.element)!=null&&m.current&&!(t.participant.isLocal&&(c==null?void 0:c.kind)==="audio")&&c.attach(e.element.current)),h.current=(b=e.element)==null?void 0:b.current,()=>{h.current&&(c==null||c.detach(h.current))}},[c,e.element]),F.useEffect(()=>{var m,b;if(typeof((m=n==null?void 0:n.dimensions)==null?void 0:m.width)=="number"&&typeof((b=n==null?void 0:n.dimensions)==null?void 0:b.height)=="number"){const f=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(f)}},[n]),{publication:n,isMuted:r,isSubscribed:o,track:c,elementProps:dw(e.props,{className:p,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":u}})}}var rc,Tf;function Tw(){if(Tf)return rc;Tf=1;var t="Expected a function",e=NaN,n="[object Symbol]",i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof Rs=="object"&&Rs&&Rs.Object===Object&&Rs,l=typeof self=="object"&&self&&self.Object===Object&&self,u=c||l||Function("return this")(),d=Object.prototype,h=d.toString,p=Math.max,v=Math.min,m=function(){return u.Date.now()};function b(y,C,P){var R,A,D,N,B,ie,De=0,ai=!1,jt=!1,Un=!0;if(typeof y!="function")throw new TypeError(t);C=S(C)||0,f(P)&&(ai=!!P.leading,jt="maxWait"in P,D=jt?p(S(P.maxWait)||0,C):D,Un="trailing"in P?!!P.trailing:Un);function U(se){var rn=R,tr=A;return R=A=void 0,De=se,N=y.apply(tr,rn),N}function V(se){return De=se,B=setTimeout(ce,C),ai?U(se):N}function z(se){var rn=se-ie,tr=se-De,ed=C-rn;return jt?v(ed,D-tr):ed}function re(se){var rn=se-ie,tr=se-De;return ie===void 0||rn>=C||rn<0||jt&&tr>=D}function ce(){var se=m();if(re(se))return Fn(se);B=setTimeout(ce,z(se))}function Fn(se){return B=void 0,Un&&R?U(se):(R=A=void 0,N)}function Bt(){B!==void 0&&clearTimeout(B),De=0,R=ie=A=B=void 0}function er(){return B===void 0?N:Fn(m())}function ft(){var se=m(),rn=re(se);if(R=arguments,A=this,ie=se,rn){if(B===void 0)return V(ie);if(jt)return B=setTimeout(ce,C),U(ie)}return B===void 0&&(B=setTimeout(ce,C)),N}return ft.cancel=Bt,ft.flush=er,ft}function f(y){var C=typeof y;return!!y&&(C=="object"||C=="function")}function g(y){return!!y&&typeof y=="object"}function k(y){return typeof y=="symbol"||g(y)&&h.call(y)==n}function S(y){if(typeof y=="number")return y;if(k(y))return e;if(f(y)){var C=typeof y.valueOf=="function"?y.valueOf():y;y=f(C)?C+"":C}if(typeof y!="string")return y===0?y:+y;y=y.replace(i,"");var P=s.test(y);return P||o.test(y)?a(y.slice(2),P?2:8):r.test(y)?e:+y}return rc=b,rc}Tw();const bw=F.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...i},r){const s=rw(t),o=F.useRef(null);F.useImperativeHandle(r,()=>o.current);const{elementProps:a,isSubscribed:c,track:l,publication:u}=Sw(s,{element:o,props:i});return F.useEffect(()=>{e==null||e(!!c)},[c,e]),F.useEffect(()=>{l===void 0||n===void 0||(l instanceof yv?l.setVolume(n):Le.warn("Volume can only be set on remote audio tracks."))},[n,l]),F.useEffect(()=>{u===void 0||i.muted===void 0||(u instanceof Sv?u.setEnabled(!i.muted):Le.warn("Can only call setEnabled on remote track publications."))},[i.muted,u,l]),F.createElement("audio",{ref:o,...a})});function Cw({volume:t,muted:e}){const n=vw([_.Source.Microphone,_.Source.ScreenShareAudio,_.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(i=>!i.participant.isLocal&&i.publication.kind===_.Kind.Audio);return F.createElement("div",{style:{display:"none"}},n.map(i=>F.createElement(bw,{key:HC(i),trackRef:i,volume:t,muted:e})))}function sc(t){return t&&typeof t.isMicrophoneEnabled=="boolean"&&typeof t.setMicrophoneEnabled=="function"}function ww(){const[t,e]=F.useState(!1),[n,i]=F.useState(""),[r,s]=F.useState(""),[o,a]=F.useState(!1),[c,l]=F.useState("Initializing..."),{localParticipant:u}=gw(),d=sw(),h=async()=>{if(console.log("[AppInner:toggleMic] Attempting to toggle microphone."),!sc(u)||!d){console.warn("[AppInner:toggleMic] Local participant/room not ready or mic controls invalid."),l("Cannot toggle mic: participant/room not ready or controls invalid.");return}if(d.audioContext&&d.audioContext.state==="suspended")try{await d.audioContext.resume(),console.log("[AppInner:toggleMic] LiveKit Room.audioContext resumed."),l("AudioContext Resumed.")}catch(m){console.error("[AppInner:toggleMic] Error resuming AudioContext:",m)}if(d.canPlaybackAudio===!1)try{await d.startAudio(),console.log("[AppInner:toggleMic] room.startAudio() called.")}catch(m){console.error("[AppInner:toggleMic] Error calling room.startAudio():",m)}const v=!o;try{console.log(`[AppInner:toggleMic] Requesting microphone ${v?"enable":"disable"}.`),l(`Microphone turning ${v?"On":"Off"}...`),await u.setMicrophoneEnabled(v,d.audioContext?{audioContext:d.audioContext}:void 0),console.log(`[AppInner:toggleMic] setMicrophoneEnabled(${v}) called successfully.`)}catch(m){console.error(`[AppInner:toggleMic] Error calling setMicrophoneEnabled(${v}):`,m),l(`Error ${v?"enabling":"disabling"} mic.`)}};return F.useEffect(()=>{if(!d){l("Waiting for room context..."),console.log("[AppInner:RoomEffect] Room context not yet available.");return}console.log("[AppInner:RoomEffect] Room available. Setting up listeners. Initial state:",d.state),l(`Room: ${d.state}`);const p=f=>{console.log("[AppInner:Event] ConnectionStateChanged:",f),l(`Connection: ${f}`),f==="connected"?(e(!0),console.log("[AppInner:Connected] Successfully connected to room (via ConnectionStateChanged).")):(f==="disconnected"||f==="failed")&&(e(!1),a(!1),i(""),s(""),console.log(`[AppInner:Disconnected] Disconnected/Failed. State: ${f}`))},v=f=>{console.log("[AppInner:Event] ParticipantConnected:",{identity:f.identity,sid:f.sid,isAgent:f.isAgent}),l(`Participant ${f.identity} joined.`)},m=f=>{console.log("[AppInner:Event] ParticipantDisconnected:",{identity:f.identity,sid:f.sid}),l(`Participant ${f.identity} left.`)},b=(f,g,k,S)=>{const y=new TextDecoder().decode(f);console.log(`[AppInner:Event] DataReceived: Topic "${S}", From "${g==null?void 0:g.identity}", Payload "${y}"`),S==="transcription"&&y.startsWith("transcript:")?i(y.replace("transcript:","")):S==="response"&&y.startsWith("response:")&&s(y.replace("response:",""))};return d.on(w.ConnectionStateChanged,p),d.on(w.DataReceived,b),d.on(w.ParticipantConnected,v),d.on(w.ParticipantDisconnected,m),p(d.state),()=>{console.log("[AppInner:RoomEffectCleanup] Cleaning up room listeners."),d.off(w.ConnectionStateChanged,p),d.off(w.DataReceived,b),d.off(w.ParticipantConnected,v),d.off(w.ParticipantDisconnected,m)}},[d]),F.useEffect(()=>{if(u){console.log("[AppInner:LocalParticipantEffect] localParticipant updated:",u);let p=!1;if(typeof u.isMicrophoneEnabled=="boolean"?(p=u.isMicrophoneEnabled,console.log(`[AppInner:LocalParticipantEffect] Mic state read from property: ${p}`),t&&l(p?"Microphone On.":"Microphone Off."),a(p)):(console.warn("[AppInner:LocalParticipantEffect] localParticipant.isMicrophoneEnabled IS NOT a boolean property."),l("Mic status unavailable (type error).")),u.audioTracks&&typeof u.audioTracks.values=="function"){const m=Array.from(u.audioTracks.values());console.log("[AppInner:LocalParticipantEffect] Local participant audioTracks:",m.map(b=>({sid:b.trackSid,kind:b.kind,source:b.source,muted:b.isMuted?b.isMuted():"N/A"})))}else console.warn("[AppInner:LocalParticipantEffect] localParticipant.audioTracks not available or not a Map.");const v=m=>{if(m.source===_.Source.Microphone){console.log(`[AppInner:LocalParticipantEvent] Mic Track ${m.isMuted?"Muted":"Unmuted"} event.`);let b=!1;typeof u.isMicrophoneEnabled=="boolean"?(b=u.isMicrophoneEnabled,a(b),t&&l(b?"Microphone On.":"Microphone Off."),console.log(`[AppInner:LocalParticipantEvent] Mic state updated via event to: ${b}`)):console.warn("[AppInner:LocalParticipantEvent] isMicrophoneEnabled not boolean on mute/unmute event.")}};return u.on(w.TrackMuted,v),u.on(w.TrackUnmuted,v),()=>{console.log("[AppInner:LocalParticipantEffectCleanup] Cleaning up participant listeners."),u&&(u.off(w.TrackMuted,v),u.off(w.TrackUnmuted,v))}}else console.log("[AppInner:LocalParticipantEffect] localParticipant is null/undefined."),a(!1)},[u,t]),F.useEffect(()=>{if(!d){console.log("[AppInner:RemoteTracksEffect] Room is null.");return}const p=(f="Update")=>{const g=Array.from(d.remoteParticipants.values());console.log(`[AppInner:RemoteTracksEffect:${f}] Remote participants count: ${g.length}`),g.forEach(S=>{if(S.audioTracks&&typeof S.audioTracks.values=="function"){const y=Array.from(S.audioTracks.values());console.log(`  [RemoteTracks] For ${S.identity} (isAgent: ${S.isAgent}): ${y.length} audio track pubs. SIDs: ${y.map(C=>C.trackSid).join(", ")} Muted: ${y.map(C=>C.isMuted?C.isMuted():"N/A").join(", ")}`)}else console.warn(`  [RemoteTracks] For ${S.identity}: p.audioTracks not available or not a Map.`)});const k=g.some(S=>S.audioTracks&&S.audioTracks.size>0);console.log(`[AppInner:RemoteTracksEffect:${f}] Has Remote Audio Tracks? ${k}`)},v=(f,g,k)=>{console.log(`[AppInner:Event] TrackSubscribed: ${f.kind} SID ${f.sid} for ${k.identity}`),p("TrackSubscribed")},m=(f,g,k)=>{console.log(`[AppInner:Event] TrackUnsubscribed: ${f.kind} SID ${f.sid} for ${k.identity}`),p("TrackUnsubscribed")},b=(f,g)=>{g.isLocal||(console.log(`[AppInner:Event] Remote TrackPublished by ${g.identity}: ${f.kind} source ${f.source}`),p("TrackPublished"))};return p("Initial"),d.on(w.TrackSubscribed,v),d.on(w.TrackUnsubscribed,m),d.on(w.TrackPublished,b),()=>{console.log("[AppInner:RemoteTracksEffectCleanup] Cleaning up track listeners."),d.off(w.TrackSubscribed,v),d.off(w.TrackUnsubscribed,m),d.off(w.TrackPublished,b)}},[d]),he.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col items-center justify-center p-4",children:[he.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Voice Assistant"}),he.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md w-full max-w-md",children:[he.jsxs("div",{className:"mb-4",children:[he.jsxs("p",{className:"text-lg",children:["Status: ",c]}),he.jsxs("p",{className:"text-sm",children:["LiveKit Connected: ",t?"Yes":"No"," | Mic Active: ",o?"On":"Off"]}),(d==null?void 0:d.audioContext)&&he.jsxs("p",{className:"text-sm",children:["Browser AudioContext: ",d.audioContext.state]})]}),he.jsx("button",{onClick:h,disabled:!t||!sc(u),className:`w-full py-2 px-4 rounded-md text-white font-semibold ${o?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"} ${!t||!sc(u)?"opacity-50 cursor-not-allowed":""}`,children:o?"Stop Microphone":"Start Microphone"}),he.jsxs("div",{className:"mt-6",children:[he.jsx("h2",{className:"text-lg font-semibold",children:"Transcript"}),he.jsx("p",{className:"mt-2 p-2 bg-gray-100 rounded min-h-[2em]",children:n||"Waiting for input..."})]}),he.jsxs("div",{className:"mt-4",children:[he.jsx("h2",{className:"text-lg font-semibold",children:"Response"}),he.jsx("p",{className:"mt-2 p-2 bg-gray-100 rounded min-h-[2em]",children:r||"Waiting for response..."})]})]}),he.jsx(Cw,{})]})}function Ew(){const[t,e]=F.useState(""),[n,i]=F.useState(""),[r,s]=F.useState("Loading configuration...");return F.useEffect(()=>{console.log("[AppWrapper:useEffect] Fetching token..."),s("Fetching token from backend..."),fetch("http://localhost:8000/token").then(o=>o.ok?o.json():o.text().then(a=>{throw new Error(`HTTP error! status: ${o.status}, body: ${a}`)})).then(o=>{o.token&&o.url?(e(o.token),i(o.url),console.log("[AppWrapper:useEffect] Token and URL fetched successfully."),s("Configuration loaded. Connecting to LiveKit...")):(console.error("[AppWrapper:useEffect] Error: Token or URL missing in response",o),s("Error: Token or URL missing in server response."))}).catch(o=>{console.error("[AppWrapper:useEffect] Error fetching token:",o),s(`Error fetching token: ${o.message}. Is backend running?`)})},[]),!t||!n?he.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col items-center justify-center p-4",children:[he.jsx("p",{className:"text-xl mb-4",children:r}),he.jsx("p",{className:"text-sm",children:"Ensure backend server is running on port 8000."})]}):he.jsx(mw,{token:t,serverUrl:n,connect:!0,audio:!0,video:!1,onConnected:()=>{console.log("[AppWrapper:LiveKitRoomEvent] Connected")},onDisconnected:o=>{console.log(`[AppWrapper:LiveKitRoomEvent] Disconnected. Reason: ${o}`),s(`Disconnected from LiveKit: ${o||"No reason provided"}`)},onError:o=>{console.error("[AppWrapper:LiveKitRoomEvent] Connection error:",o),s(`LiveKit connection error: ${o.message}. Check console.`)},onParticipantConnected:o=>console.log(`[AppWrapper:LiveKitRoomEvent] Participant connected: ${o.identity}`),onParticipantDisconnected:o=>console.log(`[AppWrapper:LiveKitRoomEvent] Participant disconnected: ${o.identity}`),onMediaDeviceFailure:o=>console.error("[AppWrapper:LiveKitRoomEvent] Media device failure:",o),children:he.jsx(ww,{})})}oc.createRoot(document.getElementById("root")).render(he.jsx(dy.StrictMode,{children:he.jsx(Ew,{})}));
//# sourceMappingURL=index-Cppo7jW5.js.map
